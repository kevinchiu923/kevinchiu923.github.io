{"meta":{"version":1,"warehouse":"5.0.1"},"models":{"Asset":[{"_id":"themes/cupertino/source/css/about.css","path":"css/about.css","modified":1,"renderable":1},{"_id":"themes/cupertino/source/css/archive.css","path":"css/archive.css","modified":1,"renderable":1},{"_id":"themes/cupertino/source/css/categories.css","path":"css/categories.css","modified":1,"renderable":1},{"_id":"themes/cupertino/source/css/code-highlighting.css","path":"css/code-highlighting.css","modified":1,"renderable":1},{"_id":"themes/cupertino/source/css/components.css","path":"css/components.css","modified":1,"renderable":1},{"_id":"themes/cupertino/source/css/connections.css","path":"css/connections.css","modified":1,"renderable":1},{"_id":"themes/cupertino/source/css/footer.css","path":"css/footer.css","modified":1,"renderable":1},{"_id":"themes/cupertino/source/css/giscus.css","path":"css/giscus.css","modified":1,"renderable":1},{"_id":"themes/cupertino/source/css/index.css","path":"css/index.css","modified":1,"renderable":1},{"_id":"themes/cupertino/source/css/main.css","path":"css/main.css","modified":1,"renderable":1},{"_id":"themes/cupertino/source/css/nav.css","path":"css/nav.css","modified":1,"renderable":1},{"_id":"themes/cupertino/source/css/paginator.css","path":"css/paginator.css","modified":1,"renderable":1},{"_id":"themes/cupertino/source/css/post-list.css","path":"css/post-list.css","modified":1,"renderable":1},{"_id":"themes/cupertino/source/css/post.css","path":"css/post.css","modified":1,"renderable":1},{"_id":"themes/cupertino/source/css/rainbow-banner.css","path":"css/rainbow-banner.css","modified":1,"renderable":1},{"_id":"themes/cupertino/source/css/search.css","path":"css/search.css","modified":1,"renderable":1},{"_id":"themes/cupertino/source/css/tags.css","path":"css/tags.css","modified":1,"renderable":1},{"_id":"themes/cupertino/source/css/toc.css","path":"css/toc.css","modified":1,"renderable":1},{"_id":"themes/cupertino/source/css/typography.css","path":"css/typography.css","modified":1,"renderable":1},{"_id":"themes/cupertino/source/css/var.css","path":"css/var.css","modified":1,"renderable":1},{"_id":"themes/cupertino/source/js/main.js","path":"js/main.js","modified":1,"renderable":1},{"_id":"themes/cupertino/source/js/search.js","path":"js/search.js","modified":1,"renderable":1},{"_id":"themes/cupertino/source/js/tidio.js","path":"js/tidio.js","modified":1,"renderable":1},{"_id":"themes/cupertino/source/theme-img/discord-mark-dark.svg","path":"theme-img/discord-mark-dark.svg","modified":1,"renderable":1},{"_id":"themes/cupertino/source/theme-img/discord-mark-light.svg","path":"theme-img/discord-mark-light.svg","modified":1,"renderable":1},{"_id":"themes/cupertino/source/theme-img/github-mark-dark.png","path":"theme-img/github-mark-dark.png","modified":1,"renderable":1},{"_id":"themes/cupertino/source/theme-img/github-mark-light.png","path":"theme-img/github-mark-light.png","modified":1,"renderable":1},{"_id":"themes/cupertino/source/theme-img/icons8-linkedin-ios-17-filled (1).zip","path":"theme-img/icons8-linkedin-ios-17-filled (1).zip","modified":1,"renderable":1},{"_id":"themes/cupertino/source/theme-img/icons8-linkedin-ios-17-filled.zip","path":"theme-img/icons8-linkedin-ios-17-filled.zip","modified":1,"renderable":1},{"_id":"themes/cupertino/source/theme-img/linkedin-logo-dark.png","path":"theme-img/linkedin-logo-dark.png","modified":1,"renderable":1},{"_id":"themes/cupertino/source/theme-img/linkedin-logo-light.png","path":"theme-img/linkedin-logo-light.png","modified":1,"renderable":1},{"_id":"themes/cupertino/source/theme-img/mastodon-logo-black.svg","path":"theme-img/mastodon-logo-black.svg","modified":1,"renderable":1},{"_id":"themes/cupertino/source/theme-img/mastodon-logo-white.svg","path":"theme-img/mastodon-logo-white.svg","modified":1,"renderable":1},{"_id":"themes/cupertino/source/theme-img/patreon-logo-black.png","path":"theme-img/patreon-logo-black.png","modified":1,"renderable":1},{"_id":"themes/cupertino/source/theme-img/patreon-logo-white.png","path":"theme-img/patreon-logo-white.png","modified":1,"renderable":1},{"_id":"themes/cupertino/source/theme-img/search-dark.svg","path":"theme-img/search-dark.svg","modified":1,"renderable":1},{"_id":"themes/cupertino/source/theme-img/search-light.svg","path":"theme-img/search-light.svg","modified":1,"renderable":1},{"_id":"themes/cupertino/source/theme-img/tags-dark.svg","path":"theme-img/tags-dark.svg","modified":1,"renderable":1},{"_id":"themes/cupertino/source/theme-img/tags-light.svg","path":"theme-img/tags-light.svg","modified":1,"renderable":1},{"_id":"source/icon_img/8616AE59-28B1-4758-9FD8-F07AC8122F7D.png","path":"icon_img/8616AE59-28B1-4758-9FD8-F07AC8122F7D.png","modified":1,"renderable":0},{"_id":"source/icon_img/Kevins_Insight_Transparent.png","path":"icon_img/Kevins_Insight_Transparent.png","modified":1,"renderable":0},{"_id":"source/icon_img/Kevins_Insight_Vector.svg","path":"icon_img/Kevins_Insight_Vector.svg","modified":1,"renderable":0},{"_id":"source/icon_img/blog_browser_logo.jpg","path":"icon_img/blog_browser_logo.jpg","modified":1,"renderable":0}],"Cache":[{"_id":"source/.DS_Store","hash":"d12ad58a747442028abd6321127cb67932fdcff0","modified":1744129158249},{"_id":"source/_posts/An-Overview-of-IEC-60870-5-104-Practical-and-Security-Applications-of-the-SCADA-Communication-Protocol.md","hash":"0e6ae392422b1ec285fd1aa67c6960ef1d5d5e47","modified":1743662460242},{"_id":"source/_posts/.DS_Store","hash":"ff1179d07dd9e9e702421af3e4a2a090e30eb5f8","modified":1744229941105},{"_id":"source/_posts/深入解析-Shim：Windows-相容性修正與-Linux-Secure-Boot-信任鏈核心.md","hash":"c61820510f55ff3a9810824517451cfde8fe9854","modified":1744234773504},{"_id":"source/_posts/The-Hidden-Power-of-Shim-How-Windows-and-Linux-Use-It—and-Why-You-Should-Care.md","hash":"9fca1989ca217f1a01f7d541905195068613f753","modified":1744234770654},{"_id":"source/_posts/Secure-by-Demand-Driving-OT-Security-Transformation-Through-Strategic-Procurement.md","hash":"bc7aa73151bfd57339c3ed7ab8d9c52b5adaa9fe","modified":1743645134110},{"_id":"source/_posts/Secure-by-Demand：以採購驅動-OT-系統安全轉型.md","hash":"0ad110a3dd5750646d01fc3a7b39275b18023b77","modified":1743645056001},{"_id":"source/_posts/淺談-IEC-60870-5-104：SCADA-通訊協定的實務與安全應用.md","hash":"f5c0958bc83d0348fb2b76f687f05b798fdc14d7","modified":1743662496337},{"_id":"source/categories/index.md","hash":"9ba416790ff64093a2fe55c9a696f5221bd4c74e","modified":1743877640788},{"_id":"source/about/index.md","hash":"fbb04e793c7962113d5ae8bd0bebfd18b20b2c1f","modified":1744131268880},{"_id":"source/connections/index.md","hash":"171321a7c54cf213cdbcef708945ed20b22ef56f","modified":1744126834245},{"_id":"source/icon_img/Kevins_Insight_Vector.svg","hash":"b16bbe78b13e64497166ee0095eebff1d2067f46","modified":1743873297233},{"_id":"source/icon_img/.DS_Store","hash":"df2fbeb1400acda0909a32c1cf6bf492f1121e07","modified":1743873621874},{"_id":"source/search/index.md","hash":"7418483102ece2b94a7ea0a883a93451705cb202","modified":1743628739858},{"_id":"source/tags/index.md","hash":"54dcfe6ed2dd20907a3367bc3ce4a27941fb1c8d","modified":1743627792608},{"_id":"source/icon_img/blog_browser_logo.jpg","hash":"d5b571bee9a6f9b5817962ca5fc04e91fb64319e","modified":1743836723254},{"_id":"source/_posts/The-Hidden-Power-of-Shim-How-Windows-and-Linux-Use-It—and-Why-You-Should-Care/.DS_Store","hash":"df2fbeb1400acda0909a32c1cf6bf492f1121e07","modified":1744231056878},{"_id":"source/_posts/Secure-by-Demand-Driving-OT-Security-Transformation-Through-Strategic-Procurement/cover_img.jpeg","hash":"527aaf4cfbe991a2352d01a2dec554ddfcbdda47","modified":1743617674010},{"_id":"source/_posts/Secure-by-Demand：以採購驅動-OT-系統安全轉型/cover_img.jpeg","hash":"527aaf4cfbe991a2352d01a2dec554ddfcbdda47","modified":1743617674010},{"_id":"source/_posts/The-Hidden-Power-of-Shim-How-Windows-and-Linux-Use-It—and-Why-You-Should-Care/Three-stage-Trust-Chain.jpeg","hash":"3f24fafdfade9dfb9d8b3a4316ec8bb1596b5957","modified":1744229841326},{"_id":"source/_posts/深入解析-Shim：Windows-相容性修正與-Linux-Secure-Boot-信任鏈核心/Three-stage-Trust-Chain.jpeg","hash":"3f24fafdfade9dfb9d8b3a4316ec8bb1596b5957","modified":1744229841326},{"_id":"source/_posts/深入解析-Shim：Windows-相容性修正與-Linux-Secure-Boot-信任鏈核心/.DS_Store","hash":"df2fbeb1400acda0909a32c1cf6bf492f1121e07","modified":1744230839647},{"_id":"themes/cupertino/docs/features/about.md","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1743634466199},{"_id":"themes/cupertino/.gitignore","hash":"4175f842062537171ef551d5b38237d1116db202","modified":1743518313641},{"_id":"themes/cupertino/_config.yml","hash":"87ce81e9adc7b3d73f7d9514c10609c3b1e0432a","modified":1744038203715},{"_id":"themes/cupertino/README.md","hash":"88e4950ce6ec2dbe5069b0c124d7851824b49504","modified":1743518313641},{"_id":"themes/cupertino/docs/README.md","hash":"0ff83266624c5483b3c1841efd5805ab53ea66fc","modified":1743518313642},{"_id":"themes/cupertino/languages/zh-cn.yml","hash":"b0cffd311963016466ac999737a53697a93e9945","modified":1743518313643},{"_id":"themes/cupertino/LICENSE","hash":"4272e3f540966f57f6ec6680111dd336139e1444","modified":1743518313641},{"_id":"themes/cupertino/docs/configuration.md","hash":"bf0e2372849b219ccd50f10541c07a3815b0852d","modified":1743518313642},{"_id":"themes/cupertino/layout/about.ejs","hash":"c2d25b8b6f9b16eb84fbad8937f53fe8c69b3499","modified":1744131163647},{"_id":"themes/cupertino/layout/archive.ejs","hash":"00f72cdf82ca6ad10433771892399bf9cc413c27","modified":1743644535250},{"_id":"themes/cupertino/languages/default.yml","hash":"12e652e422766adc838ef726b73890da41af2752","modified":1743634563392},{"_id":"themes/cupertino/layout/.DS_Store","hash":"df2fbeb1400acda0909a32c1cf6bf492f1121e07","modified":1744129163260},{"_id":"themes/cupertino/scripts/merge-config.js","hash":"8eecd6d501e068b252d2b1244b0a83244daca635","modified":1743518313644},{"_id":"themes/cupertino/layout/layout.ejs","hash":"8ec8f96ebbb54684fd5a010ad6f7b2fd2659f971","modified":1743518313644},{"_id":"themes/cupertino/layout/index.ejs","hash":"8a78328eea3ed0229f6f196956560de6fef1aaad","modified":1743518313644},{"_id":"themes/cupertino/layout/post.ejs","hash":"a7a07cd5025df6aaf39bd47e5e7ffe1a34f4841e","modified":1743518313644},{"_id":"themes/cupertino/docs/features/latex.md","hash":"11afd372b644b684476083c4bc14c12e351796b7","modified":1743518313642},{"_id":"themes/cupertino/docs/features/search.md","hash":"b379258e2c5159d837f7c562a44664ec2a8e2f39","modified":1743518313642},{"_id":"themes/cupertino/docs/features/tags-and-categories.md","hash":"31e8ec6f6d34ec6f40a48bdfee5e7b486f0f6205","modified":1743518313642},{"_id":"themes/cupertino/docs/features/rainbow-banner.md","hash":"8ac10ad6c4f1554aca34e10bbf1a6767a6551965","modified":1743518313642},{"_id":"themes/cupertino/docs/integrations/ackee.md","hash":"7e77142f9b5fa5335969bdcbb28e688f7936fde3","modified":1743518313642},{"_id":"themes/cupertino/layout/connections.ejs","hash":"8e4634d5c74695b6f2d800d631579928ff36182e","modified":1744128345604},{"_id":"themes/cupertino/docs/integrations/giscus.md","hash":"571466f6c258d7d7db7ae33e7ec645f4211c3c05","modified":1743518313642},{"_id":"themes/cupertino/docs/integrations/tidio.md","hash":"b49c1d2c88bc12ccff31e375c36a43746f306cf4","modified":1743518313643},{"_id":"themes/cupertino/.DS_Store","hash":"e1503a5d46a138f6dea76caf980661dc3a96123c","modified":1743519581929},{"_id":"themes/cupertino/layout/_partial/categories.ejs","hash":"e96746ec2cdd423b5cff0e546bb6d3561c5ff0aa","modified":1743518313643},{"_id":"themes/cupertino/layout/_partial/head.ejs","hash":"789df74ba20f858f7c76c4843748d2ec7e929ee0","modified":1743518313643},{"_id":"themes/cupertino/layout/_partial/paginator.ejs","hash":"c3adac66b9edc114e0287866da1117d92c614bb6","modified":1743518313644},{"_id":"themes/cupertino/docs/integrations/waline.md","hash":"80c2449ac32bc7f05a73cd6dba24d4eb3e0ccd97","modified":1743518313643},{"_id":"themes/cupertino/layout/_partial/footer.ejs","hash":"e80ff304eaa15367b080c46342dbec27c4d0069f","modified":1743518313643},{"_id":"themes/cupertino/layout/_partial/nav.ejs","hash":"d7f4b61c08b5ebfe123a0d1c5460851c1fccdbd4","modified":1743624503302},{"_id":"themes/cupertino/layout/_partial/tags.ejs","hash":"6db9eed3ba9f5976edfdc145827bfd08018b69a9","modified":1743518313644},{"_id":"themes/cupertino/layout/_partial/search.ejs","hash":"d7f6a3b496caeaa9f49d5d9f23493750d4039910","modified":1743518313644},{"_id":"themes/cupertino/source/css/code-highlighting.css","hash":"855d95a2b2f4781c15a0cfbab961c5b9a8b7df4f","modified":1743518313645},{"_id":"themes/cupertino/source/css/categories.css","hash":"138affb94d38b90f15c1ca9942262b2d564ea206","modified":1743518313644},{"_id":"themes/cupertino/source/css/.DS_Store","hash":"df2fbeb1400acda0909a32c1cf6bf492f1121e07","modified":1744126209096},{"_id":"themes/cupertino/source/css/components.css","hash":"04c5144db27324b9abb018ee1525efb056e88409","modified":1743518313645},{"_id":"themes/cupertino/source/css/footer.css","hash":"6be787bafc89ce95cdf6ba6dca1f8fbb3af187e9","modified":1743518313645},{"_id":"themes/cupertino/source/css/giscus.css","hash":"044ad9bf9a068e5990396132ef645b6bfb3f447c","modified":1743518313645},{"_id":"themes/cupertino/source/css/main.css","hash":"51ce8cde056c0e7c0870a102f1a297562aedbef4","modified":1743518313645},{"_id":"themes/cupertino/source/css/archive.css","hash":"65e63f80c79c81d0bd99ae7075c00d908b4a1853","modified":1744124782440},{"_id":"themes/cupertino/source/css/nav.css","hash":"08a3951337b408757324a66883eae9c55b794ab8","modified":1743625365242},{"_id":"themes/cupertino/source/css/about.css","hash":"61e5a1e17c0d6dbbe47596a4ac27feacd935a1c7","modified":1744128619118},{"_id":"themes/cupertino/source/css/paginator.css","hash":"d8b805b003e6358ec591f1d40a230611ac95ccb3","modified":1743518313645},{"_id":"themes/cupertino/source/css/index.css","hash":"ed0b4b98eaafe64283bc8f4b106190bf223fce9d","modified":1743878167259},{"_id":"themes/cupertino/source/css/connections.css","hash":"61e5a1e17c0d6dbbe47596a4ac27feacd935a1c7","modified":1744128619118},{"_id":"themes/cupertino/source/css/post-list.css","hash":"ce5c290716447f46a40534e91c6a63213005b5a5","modified":1743518313645},{"_id":"themes/cupertino/source/css/rainbow-banner.css","hash":"c53c313f9c443b36d95175ef863169351516b436","modified":1743518313646},{"_id":"themes/cupertino/source/css/post.css","hash":"618db2bdd79aca32baa1524a355b8ffec9ac0242","modified":1743518313645},{"_id":"themes/cupertino/source/css/tags.css","hash":"6ae2c446d40001ab514b78ea1da8ebfb9f557dad","modified":1743518313646},{"_id":"themes/cupertino/source/css/toc.css","hash":"90330893699a4055bd2147a2a8cf8736293ee05b","modified":1743518313646},{"_id":"themes/cupertino/source/css/var.css","hash":"29870066a9f33b6577331ff332c859daa108147e","modified":1743518313646},{"_id":"themes/cupertino/source/css/search.css","hash":"2308a2e8011a69ea2dba36fe6188928fd442d9cf","modified":1743518313646},{"_id":"themes/cupertino/source/js/search.js","hash":"6384ed6eeebce38bff27510500a2482e1b2a7df2","modified":1743518313646},{"_id":"themes/cupertino/source/js/tidio.js","hash":"5f1aa864bb91acebc2c0bf220ddcc42a262e538f","modified":1743518313646},{"_id":"themes/cupertino/source/theme-img/discord-mark-dark.svg","hash":"59364eb123c8fdb347a243952d3770e70b6a2ae2","modified":1743518313646},{"_id":"themes/cupertino/source/theme-img/discord-mark-light.svg","hash":"3a002f10c7cfea08f0a84c28bd8ca497981f537e","modified":1743518313646},{"_id":"themes/cupertino/source/css/typography.css","hash":"0fd5425f9290ec2975d7bdb5edadff95a046a4a4","modified":1744232072917},{"_id":"themes/cupertino/source/js/main.js","hash":"de64726061d74161875848f720a98089e44a5d10","modified":1743518313646},{"_id":"themes/cupertino/source/theme-img/github-mark-light.png","hash":"5740f0d2ea93806516b9c646e6e166aa5c0b44d9","modified":1743518313647},{"_id":"themes/cupertino/source/theme-img/github-mark-dark.png","hash":"8e4af8e0da1da6fb685e86c19afb5322d559a8ca","modified":1743518313647},{"_id":"themes/cupertino/source/theme-img/mastodon-logo-black.svg","hash":"09857f854c29c894e5a46ceffbf2b104e4261a49","modified":1743518313647},{"_id":"themes/cupertino/source/theme-img/linkedin-logo-light.png","hash":"91894ecb551598df62557927b5110951fd57917d","modified":1743597940000},{"_id":"themes/cupertino/source/theme-img/mastodon-logo-white.svg","hash":"5918a2c2f8727fc65506f905e1297b117f3ac816","modified":1743518313647},{"_id":"themes/cupertino/source/theme-img/linkedin-logo-dark.png","hash":"bea1787586e3c526f81b010d45794f2ead83691f","modified":1743597566000},{"_id":"themes/cupertino/source/theme-img/icons8-linkedin-ios-17-filled.zip","hash":"151514b6da7e599f09a68470933621a3d48f2dd1","modified":1743626367085},{"_id":"themes/cupertino/source/theme-img/search-dark.svg","hash":"2bc6cd712101239dc30f5ac884c968e0adfc639d","modified":1743518313647},{"_id":"themes/cupertino/source/theme-img/icons8-linkedin-ios-17-filled (1).zip","hash":"bde390f7c2944483e17aa7c194a054792d9cb29f","modified":1743626741409},{"_id":"themes/cupertino/source/theme-img/search-light.svg","hash":"dc192ca43a80772410870e2204e129331344fbab","modified":1743518313648},{"_id":"themes/cupertino/source/theme-img/tags-dark.svg","hash":"0afb6f76f0604f3b56324cc62f72daa717c0288c","modified":1743518313648},{"_id":"themes/cupertino/source/theme-img/patreon-logo-black.png","hash":"49ec544d938b13cc3ec519e157a40eaa432eee80","modified":1743518313647},{"_id":"themes/cupertino/source/theme-img/tags-light.svg","hash":"5e2caa93904df6c8f6c87c6ae239606a584674af","modified":1743518313648},{"_id":"themes/cupertino/source/theme-img/patreon-logo-white.png","hash":"a977d6017f976d18626c832bd2a91e9dbdc9c9a8","modified":1743518313647},{"_id":"source/_posts/淺談-IEC-60870-5-104：SCADA-通訊協定的實務與安全應用/cover_img.jpeg","hash":"e3d26d3bb9c93ddebf3fec13d7dbe5f4f278f123","modified":1743656726418},{"_id":"source/_posts/An-Overview-of-IEC-60870-5-104-Practical-and-Security-Applications-of-the-SCADA-Communication-Protocol/cover_img.jpeg","hash":"e3d26d3bb9c93ddebf3fec13d7dbe5f4f278f123","modified":1743656726418},{"_id":"themes/cupertino/source/theme-img/.DS_Store","hash":"ba339920e75b2218d578fbd0011071b97d0ae6e6","modified":1744126232425},{"_id":"themes/cupertino/docs/features/img/rainbow-banner.png","hash":"8a33a9216e305a55c87ee67562a6cc77f8cd6e90","modified":1743518313642},{"_id":"source/icon_img/8616AE59-28B1-4758-9FD8-F07AC8122F7D.png","hash":"5247e350e8cb6a6b7c645efaafcf67c792da09d1","modified":1743872705497},{"_id":"source/icon_img/Kevins_Insight_Transparent.png","hash":"95021feab9504141842562d5bbc7c248df0a838a","modified":1743873124444},{"_id":"themes/cupertino/docs/integrations/img/tidio-integration-url.png","hash":"73f1b81cc87b84df501bdb696789a32c93cc5a20","modified":1743518313643},{"_id":"source/_posts/深入解析-Shim：Windows-相容性修正與-Linux-Secure-Boot-信任鏈核心/zhtw_cover_img.png","hash":"217877260b99a68bcd4a0c37075c4c03cff16f34","modified":1744229977212},{"_id":"source/_posts/The-Hidden-Power-of-Shim-How-Windows-and-Linux-Use-It—and-Why-You-Should-Care/en_cover_img.png","hash":"ed3451713bbbbf8f01256a931e4b02fa40418b20","modified":1744229925417},{"_id":"public/atom.xml","hash":"720678fbc941989ed16ce0760045e6277a87844c","modified":1744234785765},{"_id":"public/search.xml","hash":"d5817bdf00fa04bdd66a1fa35988ebeb116a8994","modified":1744234785765},{"_id":"public/categories/index.html","hash":"8fc80f8ae7191a4f9cfa2f249f949df260c6bcc9","modified":1744234785765},{"_id":"public/about/index.html","hash":"15b9cd061dfa074700dc655c823585a39e08ff0d","modified":1744234785765},{"_id":"public/connections/index.html","hash":"338e47d7f0f8d7d7a797d381d55ef6e40b436ae6","modified":1744234785765},{"_id":"public/tags/index.html","hash":"5a43de4ee7d76ccb9e9fea5f05c544c6f1d46a8a","modified":1744234785765},{"_id":"public/search/index.html","hash":"5266f1a50253abe3a405987c9cf3cd3e6a77aa47","modified":1744234785765},{"_id":"public/post/The-Hidden-Power-of-Shim-How-Windows-and-Linux-Use-It—and-Why-You-Should-Care.html","hash":"7346df0127be99cbcb0bb76c6bef01a40accbe5e","modified":1744234785765},{"_id":"public/post/深入解析-Shim：Windows-相容性修正與-Linux-Secure-Boot-信任鏈核心.html","hash":"f7c92f7d3dcf040c60b708630c6b7d8e3cafeff6","modified":1744234785765},{"_id":"public/post/An-Overview-of-IEC-60870-5-104-Practical-and-Security-Applications-of-the-SCADA-Communication-Protocol.html","hash":"6ede10c34dd533fc0ed940be1b38420cec6fdea7","modified":1744234785765},{"_id":"public/post/淺談-IEC-60870-5-104：SCADA-通訊協定的實務與安全應用.html","hash":"d73b795c70ae5ebbe0069ca8ae809b2aaafd221d","modified":1744234785765},{"_id":"public/post/Secure-by-Demand-Driving-OT-Security-Transformation-Through-Strategic-Procurement.html","hash":"d1330a99e3744f9c4382a575b38ca3456e2bd061","modified":1744234785765},{"_id":"public/post/Secure-by-Demand：以採購驅動-OT-系統安全轉型.html","hash":"83745292e699728663f434c069a136a85f642a27","modified":1744234785765},{"_id":"public/archives/index.html","hash":"c861eba2a7e7886452673303ad93d148ee35582b","modified":1744234785765},{"_id":"public/archives/2025/index.html","hash":"2d417fc363f36be5d1da10503b7414f4769f9b7a","modified":1744234785765},{"_id":"public/archives/2025/03/index.html","hash":"d919af65b044ca8875e09ccc69f8a44b7d5ade7f","modified":1744234785765},{"_id":"public/archives/2025/04/index.html","hash":"801832e2c30dad260a46a2f6898e1f94fef3dc2a","modified":1744234785765},{"_id":"public/categories/Knowledge-base/index.html","hash":"bc9c788073accea3c1dab1ef561392758a8d3761","modified":1744234785765},{"_id":"public/index.html","hash":"93c5367cf70aebdc9c1a2fd93e28a056448a81ab","modified":1744234785765},{"_id":"public/tags/English/index.html","hash":"721d1d129cf04990229403909d7d9b75053fbb33","modified":1744234785765},{"_id":"public/tags/Industrial-Control-System/index.html","hash":"425a1c03b1551e1aa8096e3586f3bd7b7cfe2486","modified":1744234785765},{"_id":"public/tags/Cyber-security/index.html","hash":"dcc085519b06573f7385832b262cf9974154d0a7","modified":1744234785765},{"_id":"public/tags/Operational-technology/index.html","hash":"09ccc383be8c6c47710914244fe0d8a235833604","modified":1744234785765},{"_id":"public/tags/Critical-Infrastructure-Security-and-Resilience/index.html","hash":"ba599ad1bf117a34a95c79b00a634454e0db3ce9","modified":1744234785765},{"_id":"public/tags/Cybersecurity-Best-Practices/index.html","hash":"763edf8b0169d3723f6accd34eeb85399e9c5cdf","modified":1744234785765},{"_id":"public/tags/Traditional-Chinese/index.html","hash":"5387cd66ea4df9f626351d36dc3f92ec4d8d128d","modified":1744234785765},{"_id":"public/tags/運營技術/index.html","hash":"1caffb27e1f21f22360061f406d48919bcef83c4","modified":1744234785765},{"_id":"public/tags/關鍵基礎設施安全與韌性/index.html","hash":"b4b0de6662860213ffb14a69cebb66b88220f3f0","modified":1744234785765},{"_id":"public/tags/網路安全最佳實踐/index.html","hash":"c0e7a5ed5ec7f954e07953e5c2eb8f4b3e2fc8be","modified":1744234785765},{"_id":"public/tags/Windows/index.html","hash":"042202148eee9c2b9a073bbe63d0b1097edf1a9f","modified":1744234785765},{"_id":"public/tags/Linux/index.html","hash":"b9fd281bba4d9fefaa52660c97b47101b00d7d01","modified":1744234785765},{"_id":"public/tags/資訊安全/index.html","hash":"c4da689986a0ae5878132ab2699117f7f9feb32a","modified":1744234785765},{"_id":"public/tags/工業控制系統/index.html","hash":"6961f564bf8d5c105041e074135108ab4309bf7f","modified":1744234785765},{"_id":"public/theme-img/discord-mark-dark.svg","hash":"59364eb123c8fdb347a243952d3770e70b6a2ae2","modified":1744234785765},{"_id":"public/theme-img/discord-mark-light.svg","hash":"3a002f10c7cfea08f0a84c28bd8ca497981f537e","modified":1744234785765},{"_id":"public/theme-img/icons8-linkedin-ios-17-filled (1).zip","hash":"bde390f7c2944483e17aa7c194a054792d9cb29f","modified":1744234785765},{"_id":"public/theme-img/github-mark-dark.png","hash":"8e4af8e0da1da6fb685e86c19afb5322d559a8ca","modified":1744234785765},{"_id":"public/theme-img/icons8-linkedin-ios-17-filled.zip","hash":"151514b6da7e599f09a68470933621a3d48f2dd1","modified":1744234785765},{"_id":"public/theme-img/github-mark-light.png","hash":"5740f0d2ea93806516b9c646e6e166aa5c0b44d9","modified":1744234785765},{"_id":"public/theme-img/linkedin-logo-dark.png","hash":"bea1787586e3c526f81b010d45794f2ead83691f","modified":1744234785765},{"_id":"public/theme-img/linkedin-logo-light.png","hash":"91894ecb551598df62557927b5110951fd57917d","modified":1744234785765},{"_id":"public/theme-img/mastodon-logo-black.svg","hash":"09857f854c29c894e5a46ceffbf2b104e4261a49","modified":1744234785765},{"_id":"public/theme-img/mastodon-logo-white.svg","hash":"5918a2c2f8727fc65506f905e1297b117f3ac816","modified":1744234785765},{"_id":"public/theme-img/search-dark.svg","hash":"2bc6cd712101239dc30f5ac884c968e0adfc639d","modified":1744234785765},{"_id":"public/theme-img/patreon-logo-black.png","hash":"49ec544d938b13cc3ec519e157a40eaa432eee80","modified":1744234785765},{"_id":"public/theme-img/search-light.svg","hash":"dc192ca43a80772410870e2204e129331344fbab","modified":1744234785765},{"_id":"public/theme-img/patreon-logo-white.png","hash":"a977d6017f976d18626c832bd2a91e9dbdc9c9a8","modified":1744234785765},{"_id":"public/theme-img/tags-dark.svg","hash":"0afb6f76f0604f3b56324cc62f72daa717c0288c","modified":1744234785765},{"_id":"public/theme-img/tags-light.svg","hash":"5e2caa93904df6c8f6c87c6ae239606a584674af","modified":1744234785765},{"_id":"public/icon_img/Kevins_Insight_Vector.svg","hash":"b16bbe78b13e64497166ee0095eebff1d2067f46","modified":1744234785765},{"_id":"public/icon_img/blog_browser_logo.jpg","hash":"d5b571bee9a6f9b5817962ca5fc04e91fb64319e","modified":1744234785765},{"_id":"public/post/Secure-by-Demand-Driving-OT-Security-Transformation-Through-Strategic-Procurement/cover_img.jpeg","hash":"527aaf4cfbe991a2352d01a2dec554ddfcbdda47","modified":1744234785765},{"_id":"public/post/Secure-by-Demand：以採購驅動-OT-系統安全轉型/cover_img.jpeg","hash":"527aaf4cfbe991a2352d01a2dec554ddfcbdda47","modified":1744234785765},{"_id":"public/post/The-Hidden-Power-of-Shim-How-Windows-and-Linux-Use-It—and-Why-You-Should-Care/Three-stage-Trust-Chain.jpeg","hash":"3f24fafdfade9dfb9d8b3a4316ec8bb1596b5957","modified":1744234785765},{"_id":"public/post/深入解析-Shim：Windows-相容性修正與-Linux-Secure-Boot-信任鏈核心/Three-stage-Trust-Chain.jpeg","hash":"3f24fafdfade9dfb9d8b3a4316ec8bb1596b5957","modified":1744234785765},{"_id":"public/css/about.css","hash":"61e5a1e17c0d6dbbe47596a4ac27feacd935a1c7","modified":1744234785765},{"_id":"public/css/archive.css","hash":"65e63f80c79c81d0bd99ae7075c00d908b4a1853","modified":1744234785765},{"_id":"public/css/categories.css","hash":"138affb94d38b90f15c1ca9942262b2d564ea206","modified":1744234785765},{"_id":"public/css/components.css","hash":"04c5144db27324b9abb018ee1525efb056e88409","modified":1744234785765},{"_id":"public/css/code-highlighting.css","hash":"855d95a2b2f4781c15a0cfbab961c5b9a8b7df4f","modified":1744234785765},{"_id":"public/css/connections.css","hash":"61e5a1e17c0d6dbbe47596a4ac27feacd935a1c7","modified":1744234785765},{"_id":"public/css/footer.css","hash":"6be787bafc89ce95cdf6ba6dca1f8fbb3af187e9","modified":1744234785765},{"_id":"public/css/index.css","hash":"ed0b4b98eaafe64283bc8f4b106190bf223fce9d","modified":1744234785765},{"_id":"public/css/giscus.css","hash":"044ad9bf9a068e5990396132ef645b6bfb3f447c","modified":1744234785765},{"_id":"public/css/main.css","hash":"51ce8cde056c0e7c0870a102f1a297562aedbef4","modified":1744234785765},{"_id":"public/css/nav.css","hash":"08a3951337b408757324a66883eae9c55b794ab8","modified":1744234785765},{"_id":"public/css/paginator.css","hash":"d8b805b003e6358ec591f1d40a230611ac95ccb3","modified":1744234785765},{"_id":"public/css/post-list.css","hash":"ce5c290716447f46a40534e91c6a63213005b5a5","modified":1744234785765},{"_id":"public/css/rainbow-banner.css","hash":"c53c313f9c443b36d95175ef863169351516b436","modified":1744234785765},{"_id":"public/css/post.css","hash":"9ae95bde5a970828b40a1beed065493e0f5ee6bf","modified":1744234785765},{"_id":"public/css/search.css","hash":"2308a2e8011a69ea2dba36fe6188928fd442d9cf","modified":1744234785765},{"_id":"public/css/tags.css","hash":"6ae2c446d40001ab514b78ea1da8ebfb9f557dad","modified":1744234785765},{"_id":"public/css/toc.css","hash":"90330893699a4055bd2147a2a8cf8736293ee05b","modified":1744234785765},{"_id":"public/css/typography.css","hash":"0fd5425f9290ec2975d7bdb5edadff95a046a4a4","modified":1744234785765},{"_id":"public/css/var.css","hash":"b78b0978947d357cd67633704939707802bd4e11","modified":1744234785765},{"_id":"public/js/main.js","hash":"de64726061d74161875848f720a98089e44a5d10","modified":1744234785765},{"_id":"public/js/search.js","hash":"6384ed6eeebce38bff27510500a2482e1b2a7df2","modified":1744234785765},{"_id":"public/js/tidio.js","hash":"5f1aa864bb91acebc2c0bf220ddcc42a262e538f","modified":1744234785765},{"_id":"public/post/An-Overview-of-IEC-60870-5-104-Practical-and-Security-Applications-of-the-SCADA-Communication-Protocol/cover_img.jpeg","hash":"e3d26d3bb9c93ddebf3fec13d7dbe5f4f278f123","modified":1744234785765},{"_id":"public/post/淺談-IEC-60870-5-104：SCADA-通訊協定的實務與安全應用/cover_img.jpeg","hash":"e3d26d3bb9c93ddebf3fec13d7dbe5f4f278f123","modified":1744234785765},{"_id":"public/icon_img/8616AE59-28B1-4758-9FD8-F07AC8122F7D.png","hash":"5247e350e8cb6a6b7c645efaafcf67c792da09d1","modified":1744234785765},{"_id":"public/icon_img/Kevins_Insight_Transparent.png","hash":"95021feab9504141842562d5bbc7c248df0a838a","modified":1744234785765},{"_id":"public/post/深入解析-Shim：Windows-相容性修正與-Linux-Secure-Boot-信任鏈核心/zhtw_cover_img.png","hash":"217877260b99a68bcd4a0c37075c4c03cff16f34","modified":1744234785765},{"_id":"public/post/The-Hidden-Power-of-Shim-How-Windows-and-Linux-Use-It—and-Why-You-Should-Care/en_cover_img.png","hash":"ed3451713bbbbf8f01256a931e4b02fa40418b20","modified":1744234785765}],"Category":[{"name":"Knowledge base","_id":"cm9agcuc40004nc8251851o6y"}],"Data":[],"Page":[{"type":"categories","_content":"","source":"categories/index.md","raw":"---\ntype: categories\n---","date":"2025-04-05T18:27:20.788Z","updated":"2025-04-05T18:27:20.788Z","path":"categories/index.html","title":"","comments":1,"layout":"page","_id":"cm9agcuc10000nc82f4ixej9m","content":"","excerpt":"","more":""},{"title":"About","layout":"about","_content":"","source":"about/index.md","raw":"---\ntitle: About\nlayout: about\n---\n","date":"2025-04-08T16:54:28.880Z","updated":"2025-04-08T16:54:28.880Z","path":"about/index.html","comments":1,"_id":"cm9agcuc30002nc825m0r1sp0","content":"","excerpt":"","more":""},{"title":"Connections","layout":"connections","connections":[{"name":"Dr. Awesome Doge","link":"https://doge.tg/","avatar":"https://doge.tg/assets/img/prof_pic-480.webp","description":"TONX Co-founder"},{"name":"Cypherpunks Taiwan","link":"https://cypherpunks-core.github.io/markdown/about/","avatar":"https://avatars.githubusercontent.com/u/49090977?s=200&v=4","description":"Make Privacy Great Again!"}],"_content":"","source":"connections/index.md","raw":"---\ntitle: Connections\nlayout: connections\nconnections:\n  - name: Dr. Awesome Doge\n    link: https://doge.tg/\n    avatar: https://doge.tg/assets/img/prof_pic-480.webp\n    description: TONX Co-founder\n  - name: Cypherpunks Taiwan\n    link: https://cypherpunks-core.github.io/markdown/about/\n    avatar: https://avatars.githubusercontent.com/u/49090977?s=200&v=4\n    description: Make Privacy Great Again!\n---","date":"2025-04-08T15:40:34.245Z","updated":"2025-04-08T15:40:34.245Z","path":"connections/index.html","comments":1,"_id":"cm9agcuc40006nc82bg9c108n","content":"","excerpt":"","more":""},{"type":"tags","_content":"","source":"tags/index.md","raw":"---\ntype: tags\n---","date":"2025-04-02T21:03:12.608Z","updated":"2025-04-02T21:03:12.608Z","path":"tags/index.html","title":"","comments":1,"layout":"page","_id":"cm9agcuc50008nc823bcw8xhf","content":"","excerpt":"","more":""},{"type":"search","_content":"","source":"search/index.md","raw":"---\ntype: search\n---\n","date":"2025-04-02T21:18:59.858Z","updated":"2025-04-02T21:18:59.858Z","path":"search/index.html","title":"","comments":1,"layout":"page","_id":"cm9agcuc50009nc8286zv1k4z","content":"","excerpt":"","more":""}],"Post":[{"title":"An Overview of IEC 60870-5-104: Practical and Security Applications of the SCADA Communication Protocol","date":"2025-03-27T12:00:00.000Z","cover_image":"https://kevinchiu923.github.io/post/An-Overview-of-IEC-60870-5-104-Practical-and-Security-Applications-of-the-SCADA-Communication-Protocol/cover_img.jpeg","_content":"\n![](An-Overview-of-IEC-60870-5-104-Practical-and-Security-Applications-of-the-SCADA-Communication-Protocol/cover_img.jpeg)\n<center>Source: https://www.dreamstime.com/</center>\n\n## 1. Glossary of Technical Terms\n- **Telemetry**\n    *Definition：* The technology for collecting data from remote devices or systems and transmitting it back to a central control system. The data is typically gathered from sensors or monitoring equipment, such as temperature, pressure, or location.\n    *Example：* A space probe transmitting its velocity, temperature, and position data back to Earth is an example of telemetry.\n\n- **Tele-signaling / Remote Signaling**\n    *Definition：* Transmission of status or alarm signals from remote equipment, generally as discrete data (e.g., ON/OFF, Normal/Failure).\n    *Example：* A power plant control center receiving a “breaker closed” signal from a substation is an instance of remote signaling.\n\n- **Telecontrol / Remote Control**\n    *Definition：* Remote operation or control of devices, such as switching equipment on/off, configuring settings, or initiating processes.\n    *Example：* Remotely starting a factory machine or turning on an air conditioner is a form of telecontrol.\n\n- **DSP → Digital signal processor**\n    *Definition：* A specialized microprocessor designed for high-speed numeric processing, widely used in telecommunications, audio, digital image processing, radar, sonar, and consumer electronics.\n\n- **RTU → Remote terminal unit**\n    *Definition：* A microprocessor-based electronic device that acts as an interface to field devices and transmits telemetry data to the SCADA system while also receiving control commands.\n\n- **IED → Intelligent Electronic Device**\n    *Definition：* An advanced electronic device capable of data processing and communication, used in power systems and industrial control for monitoring, control, protection, and communication. It goes beyond simple sensors or relays by incorporating microprocessors and communication interfaces.\n\n- **COT → Cause of Transmission**\n    *Definition：* A critical field within the ASDU (Application Service Data Unit) in IEC 60870-5, indicating the reason for data transmission (e.g., cyclic, spontaneous, test).\n\n- **IOA → Information Object Address**\n    *Definition：* Identifies the internal address of a specific point within a device. Each RTU or IED typically has a point list, and the IOA is used to reference those points.\n\n- **Frame**\n    *Definition：* A basic unit of data encapsulation in industrial communication protocols, consisting of a header (Start of Frame, address, function code), payload, and CRC (error check).\n\n- **SCADA → Supervisory Control And Data Acquisition**\n    *Definition：* A system architecture used for remote monitoring and control of large-scale industrial systems. SCADA systems enable centralized operators to oversee field devices, send control commands, and visualize/analyze real-time data.\n\n---\n\n## 2. Introduction to the IEC 60870-5 Protocol Series\nIEC 60870 is a set of international communication standards developed by the [International Electrotechnical Commission (IEC)](https://www.iec.ch/homepage) for reliable data transmission between industrial control centers (SCADA) and remote devices such as RTUs and IEDs. These standards are widely adopted in **power systems, smart grids, and industrial automation**.\n\nIEC 60870-5 is Part 5 of the standard family and includes over 13 sub-standards focusing on protocols for **remote control, protection, and communication** in power systems.\n\nTwo commonly used sub-standards include:\n- **IEC 60870-5-101 (IEC 101)**: Designed for serial communication (RS-232/RS-485), suitable for point-to-point local transmission.\n- **IEC 60870-5-104 (IEC 104)**: Designed for modern network environments using TCP/IP, enabling wide-area communication via Ethernet or VPN.\n\nIn essence, IEC 104 extends the IEC 101 data structure to IP networks, allowing continuous bidirectional connections for real-time data exchange, rather than relying on traditional polling.\n\n---\n\n## 3. Mapping IEC 104 to the OSI Model\nIEC 104 functions as an application-layer protocol and uses TCP for transport, typically operating over **Port 2404**.\n\nThe mapping to the OSI model is as follows:\n- **Application Layer**: IEC 104\n- **Transport Layer**: TCP\n- **Network Layer**: IP\n- **Data Link / Physical Layer**: Ethernet\n\nSCADA systems typically use a **Master-Slave architecture** [1] where **the control center (Master) acts as the Client, and the field devices (RTUs/IEDs) act as Servers**. A persistent TCP connection is established for data exchange and control.\n\nAfter connection, the client initiates communication with the **StartDT** command. If the server is unresponsive for too long, the **TestFR** command is used to verify the connection.\n\n###### [1] Since 2020, the terms “Master” and “Slave” have come under scrutiny in the tech industry due to their historical association with slavery. Companies like Oracle and GitHub have advocated replacing them with alternatives like **Primary-Replica, Conductor-Member, or Primary-Secondary** to promote more inclusive language.<br>However, as the **IEC standards** were defined before this shift and still reference these terms, we use them here strictly for consistency and clarity in reference to the original documentation.\n\n---\n\n## 4. Communication Format and Data Structure\nIEC 104 uses **ASDU (Application Service Data Unit)** as the primary data encapsulation format. Each ASDU contains:\n- **Type ID**: Identifies the data type (e.g., telemetry, tele-signaling, telecontrol).\n- **Cause of Transmission (COT)**: Indicates the reason for transmission (cyclic, spontaneous, test, command).\n- **Common Address / Information Object Address (IOA)**: Identifies the device and data point.\n- **Data Content**: The actual transmitted value (e.g., ON/OFF, voltage reading).\n\nIEC 104 frames are categorized into three types:\n- **I-frame**: Carries actual data.\n- **S-frame**: Acknowledges received data.\n- **U-frame**: Manages connection control (StartDT, StopDT, TestFR).\n\nEach message includes sequence numbers for flow control and error detection to ensure reliable delivery.\n\n---\n\n## 5. Real-World Use Case: Integrating with SCADA Systems\nIEC 104 is a widely used protocol in modern SCADA systems.\n**Examples**:\n- Siemens RTUs and WinCC SCADA systems communicate via IEC 104.\n- Schneider Electric’s ClearSCADA (Geo SCADA) supports IEC 104.\n- ABB’s MicroSCADA and RTU560 include built-in IEC 104 communication modules.\n\nThese devices typically interface with IEDs (e.g., smart meters, protection relays) to receive telemetry such as:\n- Voltage/current fluctuations\n- Protection trip events\n- Remote control execution statuses\n\nSCADA systems are configured with matching Type IDs, COTs, and IOAs for each data point.\n\nIn cases where legacy field equipment only supports IEC 101 (serial), **protocol converters** or **gateways** (e.g., Advantech [ESRP-PCS-ICR3231](https://www.advantech.com/zh-tw/products/ac0bd5cd-093a-4f88-87f5-13edc68a5616/esrp-pcs-icr3231/mod_803b3db4-bd02-472c-8ad3-624aaaab2433) or [ECU-1051](https://www.advantech.com/zh-tw/products/7332cf9e-bf70-4a79-b0b6-fd8a2182cd72/ecu-1051/mod_0ea5f440-e270-436f-afa3-077df3acce5d)) can be used to convert IEC 101 to IEC 104, enabling integration into modern Ethernet-based systems.\n\n---\n\n## 6. Security Challenges and Protections under IEC 62351\nIEC 104 was not originally designed with modern cybersecurity threats in mind, leading to the following issues:\n- **Plaintext transmission**, vulnerable to eavesdropping.\n- **Lack of authentication**, allowing attackers to impersonate the master station.\n- **No encryption or integrity checks**, making it prone to man-in-the-middle attacks.\n\nTo address these risks, IEC introduced the [**IEC 62351 series**](https://www.iec.ch/blog/cyber-security-understanding-iec-62351):\n- [**IEC 62351-3**](https://webstore.iec.ch/en/publication/68410): Recommends using TLS over TCP (similar to HTTPS) to encrypt data.\n- [**IEC 62351-5**](https://webstore.iec.ch/en/publication/65511): Adds signatures and sequence protection at the application layer to prevent spoofing and replay attacks.\n- [**IEC 62351-8**](https://webstore.iec.ch/en/publication/61822) & [**IEC 62351-9**](https://webstore.iec.ch/en/publication/66864): Define device authentication and key management methods.\n\nIf devices do not support IEC 62351, **VPNs** or **secure gateways** can be used for encrypted communication or packet forwarding.\n\n---\n\n## 7. Practical Recommendations for Secure and Stable Deployment\nEven with IEC 62351 in place, the following best practices are recommended:\n- **Network Segmentation**: Isolate SCADA and control networks from corporate IT networks.\n- **Firewall Port Control**: Restrict access to Port 2404 to authorized IP addresses only.\n- **Intrusion Detection Systems (IDS)**: Monitor abnormal IEC 104 traffic and command patterns.\n- **Secure Gateways**: Enforce data and command restrictions based on IOA and Type ID.\n- **VPN Encryption**: Use secure channels for remote access.\n- **Firmware Updates**: Regularly patch known vulnerabilities in devices.\nThese strategies form a **defense-in-depth** approach, significantly reducing the risk of successful cyberattacks.","source":"_posts/An-Overview-of-IEC-60870-5-104-Practical-and-Security-Applications-of-the-SCADA-Communication-Protocol.md","raw":"---\ntitle: >-\n  An Overview of IEC 60870-5-104: Practical and Security Applications of the\n  SCADA Communication Protocol\ndate: 2025-03-27 20:00:00\ntags:\n  - English\n  - Industrial Control System\n  - Cyber security\ncategories:\n  - Knowledge base\ncover_image: 'https://kevinchiu923.github.io/post/An-Overview-of-IEC-60870-5-104-Practical-and-Security-Applications-of-the-SCADA-Communication-Protocol/cover_img.jpeg'\n---\n\n![](An-Overview-of-IEC-60870-5-104-Practical-and-Security-Applications-of-the-SCADA-Communication-Protocol/cover_img.jpeg)\n<center>Source: https://www.dreamstime.com/</center>\n\n## 1. Glossary of Technical Terms\n- **Telemetry**\n    *Definition：* The technology for collecting data from remote devices or systems and transmitting it back to a central control system. The data is typically gathered from sensors or monitoring equipment, such as temperature, pressure, or location.\n    *Example：* A space probe transmitting its velocity, temperature, and position data back to Earth is an example of telemetry.\n\n- **Tele-signaling / Remote Signaling**\n    *Definition：* Transmission of status or alarm signals from remote equipment, generally as discrete data (e.g., ON/OFF, Normal/Failure).\n    *Example：* A power plant control center receiving a “breaker closed” signal from a substation is an instance of remote signaling.\n\n- **Telecontrol / Remote Control**\n    *Definition：* Remote operation or control of devices, such as switching equipment on/off, configuring settings, or initiating processes.\n    *Example：* Remotely starting a factory machine or turning on an air conditioner is a form of telecontrol.\n\n- **DSP → Digital signal processor**\n    *Definition：* A specialized microprocessor designed for high-speed numeric processing, widely used in telecommunications, audio, digital image processing, radar, sonar, and consumer electronics.\n\n- **RTU → Remote terminal unit**\n    *Definition：* A microprocessor-based electronic device that acts as an interface to field devices and transmits telemetry data to the SCADA system while also receiving control commands.\n\n- **IED → Intelligent Electronic Device**\n    *Definition：* An advanced electronic device capable of data processing and communication, used in power systems and industrial control for monitoring, control, protection, and communication. It goes beyond simple sensors or relays by incorporating microprocessors and communication interfaces.\n\n- **COT → Cause of Transmission**\n    *Definition：* A critical field within the ASDU (Application Service Data Unit) in IEC 60870-5, indicating the reason for data transmission (e.g., cyclic, spontaneous, test).\n\n- **IOA → Information Object Address**\n    *Definition：* Identifies the internal address of a specific point within a device. Each RTU or IED typically has a point list, and the IOA is used to reference those points.\n\n- **Frame**\n    *Definition：* A basic unit of data encapsulation in industrial communication protocols, consisting of a header (Start of Frame, address, function code), payload, and CRC (error check).\n\n- **SCADA → Supervisory Control And Data Acquisition**\n    *Definition：* A system architecture used for remote monitoring and control of large-scale industrial systems. SCADA systems enable centralized operators to oversee field devices, send control commands, and visualize/analyze real-time data.\n\n---\n\n## 2. Introduction to the IEC 60870-5 Protocol Series\nIEC 60870 is a set of international communication standards developed by the [International Electrotechnical Commission (IEC)](https://www.iec.ch/homepage) for reliable data transmission between industrial control centers (SCADA) and remote devices such as RTUs and IEDs. These standards are widely adopted in **power systems, smart grids, and industrial automation**.\n\nIEC 60870-5 is Part 5 of the standard family and includes over 13 sub-standards focusing on protocols for **remote control, protection, and communication** in power systems.\n\nTwo commonly used sub-standards include:\n- **IEC 60870-5-101 (IEC 101)**: Designed for serial communication (RS-232/RS-485), suitable for point-to-point local transmission.\n- **IEC 60870-5-104 (IEC 104)**: Designed for modern network environments using TCP/IP, enabling wide-area communication via Ethernet or VPN.\n\nIn essence, IEC 104 extends the IEC 101 data structure to IP networks, allowing continuous bidirectional connections for real-time data exchange, rather than relying on traditional polling.\n\n---\n\n## 3. Mapping IEC 104 to the OSI Model\nIEC 104 functions as an application-layer protocol and uses TCP for transport, typically operating over **Port 2404**.\n\nThe mapping to the OSI model is as follows:\n- **Application Layer**: IEC 104\n- **Transport Layer**: TCP\n- **Network Layer**: IP\n- **Data Link / Physical Layer**: Ethernet\n\nSCADA systems typically use a **Master-Slave architecture** [1] where **the control center (Master) acts as the Client, and the field devices (RTUs/IEDs) act as Servers**. A persistent TCP connection is established for data exchange and control.\n\nAfter connection, the client initiates communication with the **StartDT** command. If the server is unresponsive for too long, the **TestFR** command is used to verify the connection.\n\n###### [1] Since 2020, the terms “Master” and “Slave” have come under scrutiny in the tech industry due to their historical association with slavery. Companies like Oracle and GitHub have advocated replacing them with alternatives like **Primary-Replica, Conductor-Member, or Primary-Secondary** to promote more inclusive language.<br>However, as the **IEC standards** were defined before this shift and still reference these terms, we use them here strictly for consistency and clarity in reference to the original documentation.\n\n---\n\n## 4. Communication Format and Data Structure\nIEC 104 uses **ASDU (Application Service Data Unit)** as the primary data encapsulation format. Each ASDU contains:\n- **Type ID**: Identifies the data type (e.g., telemetry, tele-signaling, telecontrol).\n- **Cause of Transmission (COT)**: Indicates the reason for transmission (cyclic, spontaneous, test, command).\n- **Common Address / Information Object Address (IOA)**: Identifies the device and data point.\n- **Data Content**: The actual transmitted value (e.g., ON/OFF, voltage reading).\n\nIEC 104 frames are categorized into three types:\n- **I-frame**: Carries actual data.\n- **S-frame**: Acknowledges received data.\n- **U-frame**: Manages connection control (StartDT, StopDT, TestFR).\n\nEach message includes sequence numbers for flow control and error detection to ensure reliable delivery.\n\n---\n\n## 5. Real-World Use Case: Integrating with SCADA Systems\nIEC 104 is a widely used protocol in modern SCADA systems.\n**Examples**:\n- Siemens RTUs and WinCC SCADA systems communicate via IEC 104.\n- Schneider Electric’s ClearSCADA (Geo SCADA) supports IEC 104.\n- ABB’s MicroSCADA and RTU560 include built-in IEC 104 communication modules.\n\nThese devices typically interface with IEDs (e.g., smart meters, protection relays) to receive telemetry such as:\n- Voltage/current fluctuations\n- Protection trip events\n- Remote control execution statuses\n\nSCADA systems are configured with matching Type IDs, COTs, and IOAs for each data point.\n\nIn cases where legacy field equipment only supports IEC 101 (serial), **protocol converters** or **gateways** (e.g., Advantech [ESRP-PCS-ICR3231](https://www.advantech.com/zh-tw/products/ac0bd5cd-093a-4f88-87f5-13edc68a5616/esrp-pcs-icr3231/mod_803b3db4-bd02-472c-8ad3-624aaaab2433) or [ECU-1051](https://www.advantech.com/zh-tw/products/7332cf9e-bf70-4a79-b0b6-fd8a2182cd72/ecu-1051/mod_0ea5f440-e270-436f-afa3-077df3acce5d)) can be used to convert IEC 101 to IEC 104, enabling integration into modern Ethernet-based systems.\n\n---\n\n## 6. Security Challenges and Protections under IEC 62351\nIEC 104 was not originally designed with modern cybersecurity threats in mind, leading to the following issues:\n- **Plaintext transmission**, vulnerable to eavesdropping.\n- **Lack of authentication**, allowing attackers to impersonate the master station.\n- **No encryption or integrity checks**, making it prone to man-in-the-middle attacks.\n\nTo address these risks, IEC introduced the [**IEC 62351 series**](https://www.iec.ch/blog/cyber-security-understanding-iec-62351):\n- [**IEC 62351-3**](https://webstore.iec.ch/en/publication/68410): Recommends using TLS over TCP (similar to HTTPS) to encrypt data.\n- [**IEC 62351-5**](https://webstore.iec.ch/en/publication/65511): Adds signatures and sequence protection at the application layer to prevent spoofing and replay attacks.\n- [**IEC 62351-8**](https://webstore.iec.ch/en/publication/61822) & [**IEC 62351-9**](https://webstore.iec.ch/en/publication/66864): Define device authentication and key management methods.\n\nIf devices do not support IEC 62351, **VPNs** or **secure gateways** can be used for encrypted communication or packet forwarding.\n\n---\n\n## 7. Practical Recommendations for Secure and Stable Deployment\nEven with IEC 62351 in place, the following best practices are recommended:\n- **Network Segmentation**: Isolate SCADA and control networks from corporate IT networks.\n- **Firewall Port Control**: Restrict access to Port 2404 to authorized IP addresses only.\n- **Intrusion Detection Systems (IDS)**: Monitor abnormal IEC 104 traffic and command patterns.\n- **Secure Gateways**: Enforce data and command restrictions based on IOA and Type ID.\n- **VPN Encryption**: Use secure channels for remote access.\n- **Firmware Updates**: Regularly patch known vulnerabilities in devices.\nThese strategies form a **defense-in-depth** approach, significantly reducing the risk of successful cyberattacks.","slug":"An-Overview-of-IEC-60870-5-104-Practical-and-Security-Applications-of-the-SCADA-Communication-Protocol","published":1,"updated":"2025-04-03T06:41:00.242Z","comments":1,"layout":"post","photos":[],"_id":"cm9agcuc20001nc82hzfnalab","content":"<p><img src=\"/post/An-Overview-of-IEC-60870-5-104-Practical-and-Security-Applications-of-the-SCADA-Communication-Protocol/cover_img.jpeg\"></p>\n<center>Source: https://www.dreamstime.com/</center>\n\n<h2 id=\"1-Glossary-of-Technical-Terms\"><a href=\"#1-Glossary-of-Technical-Terms\" class=\"headerlink\" title=\"1. Glossary of Technical Terms\"></a>1. Glossary of Technical Terms</h2><ul>\n<li><p><strong>Telemetry</strong><br>  <em>Definition：</em> The technology for collecting data from remote devices or systems and transmitting it back to a central control system. The data is typically gathered from sensors or monitoring equipment, such as temperature, pressure, or location.<br>  <em>Example：</em> A space probe transmitting its velocity, temperature, and position data back to Earth is an example of telemetry.</p>\n</li>\n<li><p><strong>Tele-signaling &#x2F; Remote Signaling</strong><br>  <em>Definition：</em> Transmission of status or alarm signals from remote equipment, generally as discrete data (e.g., ON&#x2F;OFF, Normal&#x2F;Failure).<br>  <em>Example：</em> A power plant control center receiving a “breaker closed” signal from a substation is an instance of remote signaling.</p>\n</li>\n<li><p><strong>Telecontrol &#x2F; Remote Control</strong><br>  <em>Definition：</em> Remote operation or control of devices, such as switching equipment on&#x2F;off, configuring settings, or initiating processes.<br>  <em>Example：</em> Remotely starting a factory machine or turning on an air conditioner is a form of telecontrol.</p>\n</li>\n<li><p><strong>DSP → Digital signal processor</strong><br>  <em>Definition：</em> A specialized microprocessor designed for high-speed numeric processing, widely used in telecommunications, audio, digital image processing, radar, sonar, and consumer electronics.</p>\n</li>\n<li><p><strong>RTU → Remote terminal unit</strong><br>  <em>Definition：</em> A microprocessor-based electronic device that acts as an interface to field devices and transmits telemetry data to the SCADA system while also receiving control commands.</p>\n</li>\n<li><p><strong>IED → Intelligent Electronic Device</strong><br>  <em>Definition：</em> An advanced electronic device capable of data processing and communication, used in power systems and industrial control for monitoring, control, protection, and communication. It goes beyond simple sensors or relays by incorporating microprocessors and communication interfaces.</p>\n</li>\n<li><p><strong>COT → Cause of Transmission</strong><br>  <em>Definition：</em> A critical field within the ASDU (Application Service Data Unit) in IEC 60870-5, indicating the reason for data transmission (e.g., cyclic, spontaneous, test).</p>\n</li>\n<li><p><strong>IOA → Information Object Address</strong><br>  <em>Definition：</em> Identifies the internal address of a specific point within a device. Each RTU or IED typically has a point list, and the IOA is used to reference those points.</p>\n</li>\n<li><p><strong>Frame</strong><br>  <em>Definition：</em> A basic unit of data encapsulation in industrial communication protocols, consisting of a header (Start of Frame, address, function code), payload, and CRC (error check).</p>\n</li>\n<li><p><strong>SCADA → Supervisory Control And Data Acquisition</strong><br>  <em>Definition：</em> A system architecture used for remote monitoring and control of large-scale industrial systems. SCADA systems enable centralized operators to oversee field devices, send control commands, and visualize&#x2F;analyze real-time data.</p>\n</li>\n</ul>\n<hr>\n<h2 id=\"2-Introduction-to-the-IEC-60870-5-Protocol-Series\"><a href=\"#2-Introduction-to-the-IEC-60870-5-Protocol-Series\" class=\"headerlink\" title=\"2. Introduction to the IEC 60870-5 Protocol Series\"></a>2. Introduction to the IEC 60870-5 Protocol Series</h2><p>IEC 60870 is a set of international communication standards developed by the <a href=\"https://www.iec.ch/homepage\">International Electrotechnical Commission (IEC)</a> for reliable data transmission between industrial control centers (SCADA) and remote devices such as RTUs and IEDs. These standards are widely adopted in <strong>power systems, smart grids, and industrial automation</strong>.</p>\n<p>IEC 60870-5 is Part 5 of the standard family and includes over 13 sub-standards focusing on protocols for <strong>remote control, protection, and communication</strong> in power systems.</p>\n<p>Two commonly used sub-standards include:</p>\n<ul>\n<li><strong>IEC 60870-5-101 (IEC 101)</strong>: Designed for serial communication (RS-232&#x2F;RS-485), suitable for point-to-point local transmission.</li>\n<li><strong>IEC 60870-5-104 (IEC 104)</strong>: Designed for modern network environments using TCP&#x2F;IP, enabling wide-area communication via Ethernet or VPN.</li>\n</ul>\n<p>In essence, IEC 104 extends the IEC 101 data structure to IP networks, allowing continuous bidirectional connections for real-time data exchange, rather than relying on traditional polling.</p>\n<hr>\n<h2 id=\"3-Mapping-IEC-104-to-the-OSI-Model\"><a href=\"#3-Mapping-IEC-104-to-the-OSI-Model\" class=\"headerlink\" title=\"3. Mapping IEC 104 to the OSI Model\"></a>3. Mapping IEC 104 to the OSI Model</h2><p>IEC 104 functions as an application-layer protocol and uses TCP for transport, typically operating over <strong>Port 2404</strong>.</p>\n<p>The mapping to the OSI model is as follows:</p>\n<ul>\n<li><strong>Application Layer</strong>: IEC 104</li>\n<li><strong>Transport Layer</strong>: TCP</li>\n<li><strong>Network Layer</strong>: IP</li>\n<li><strong>Data Link &#x2F; Physical Layer</strong>: Ethernet</li>\n</ul>\n<p>SCADA systems typically use a <strong>Master-Slave architecture</strong> [1] where <strong>the control center (Master) acts as the Client, and the field devices (RTUs&#x2F;IEDs) act as Servers</strong>. A persistent TCP connection is established for data exchange and control.</p>\n<p>After connection, the client initiates communication with the <strong>StartDT</strong> command. If the server is unresponsive for too long, the <strong>TestFR</strong> command is used to verify the connection.</p>\n<h6 id=\"1-Since-2020-the-terms-“Master”-and-“Slave”-have-come-under-scrutiny-in-the-tech-industry-due-to-their-historical-association-with-slavery-Companies-like-Oracle-and-GitHub-have-advocated-replacing-them-with-alternatives-like-Primary-Replica-Conductor-Member-or-Primary-Secondary-to-promote-more-inclusive-language-However-as-the-IEC-standards-were-defined-before-this-shift-and-still-reference-these-terms-we-use-them-here-strictly-for-consistency-and-clarity-in-reference-to-the-original-documentation\"><a href=\"#1-Since-2020-the-terms-“Master”-and-“Slave”-have-come-under-scrutiny-in-the-tech-industry-due-to-their-historical-association-with-slavery-Companies-like-Oracle-and-GitHub-have-advocated-replacing-them-with-alternatives-like-Primary-Replica-Conductor-Member-or-Primary-Secondary-to-promote-more-inclusive-language-However-as-the-IEC-standards-were-defined-before-this-shift-and-still-reference-these-terms-we-use-them-here-strictly-for-consistency-and-clarity-in-reference-to-the-original-documentation\" class=\"headerlink\" title=\"[1] Since 2020, the terms “Master” and “Slave” have come under scrutiny in the tech industry due to their historical association with slavery. Companies like Oracle and GitHub have advocated replacing them with alternatives like Primary-Replica, Conductor-Member, or Primary-Secondary to promote more inclusive language.However, as the IEC standards were defined before this shift and still reference these terms, we use them here strictly for consistency and clarity in reference to the original documentation.\"></a>[1] Since 2020, the terms “Master” and “Slave” have come under scrutiny in the tech industry due to their historical association with slavery. Companies like Oracle and GitHub have advocated replacing them with alternatives like <strong>Primary-Replica, Conductor-Member, or Primary-Secondary</strong> to promote more inclusive language.<br>However, as the <strong>IEC standards</strong> were defined before this shift and still reference these terms, we use them here strictly for consistency and clarity in reference to the original documentation.</h6><hr>\n<h2 id=\"4-Communication-Format-and-Data-Structure\"><a href=\"#4-Communication-Format-and-Data-Structure\" class=\"headerlink\" title=\"4. Communication Format and Data Structure\"></a>4. Communication Format and Data Structure</h2><p>IEC 104 uses <strong>ASDU (Application Service Data Unit)</strong> as the primary data encapsulation format. Each ASDU contains:</p>\n<ul>\n<li><strong>Type ID</strong>: Identifies the data type (e.g., telemetry, tele-signaling, telecontrol).</li>\n<li><strong>Cause of Transmission (COT)</strong>: Indicates the reason for transmission (cyclic, spontaneous, test, command).</li>\n<li><strong>Common Address &#x2F; Information Object Address (IOA)</strong>: Identifies the device and data point.</li>\n<li><strong>Data Content</strong>: The actual transmitted value (e.g., ON&#x2F;OFF, voltage reading).</li>\n</ul>\n<p>IEC 104 frames are categorized into three types:</p>\n<ul>\n<li><strong>I-frame</strong>: Carries actual data.</li>\n<li><strong>S-frame</strong>: Acknowledges received data.</li>\n<li><strong>U-frame</strong>: Manages connection control (StartDT, StopDT, TestFR).</li>\n</ul>\n<p>Each message includes sequence numbers for flow control and error detection to ensure reliable delivery.</p>\n<hr>\n<h2 id=\"5-Real-World-Use-Case-Integrating-with-SCADA-Systems\"><a href=\"#5-Real-World-Use-Case-Integrating-with-SCADA-Systems\" class=\"headerlink\" title=\"5. Real-World Use Case: Integrating with SCADA Systems\"></a>5. Real-World Use Case: Integrating with SCADA Systems</h2><p>IEC 104 is a widely used protocol in modern SCADA systems.<br><strong>Examples</strong>:</p>\n<ul>\n<li>Siemens RTUs and WinCC SCADA systems communicate via IEC 104.</li>\n<li>Schneider Electric’s ClearSCADA (Geo SCADA) supports IEC 104.</li>\n<li>ABB’s MicroSCADA and RTU560 include built-in IEC 104 communication modules.</li>\n</ul>\n<p>These devices typically interface with IEDs (e.g., smart meters, protection relays) to receive telemetry such as:</p>\n<ul>\n<li>Voltage&#x2F;current fluctuations</li>\n<li>Protection trip events</li>\n<li>Remote control execution statuses</li>\n</ul>\n<p>SCADA systems are configured with matching Type IDs, COTs, and IOAs for each data point.</p>\n<p>In cases where legacy field equipment only supports IEC 101 (serial), <strong>protocol converters</strong> or <strong>gateways</strong> (e.g., Advantech <a href=\"https://www.advantech.com/zh-tw/products/ac0bd5cd-093a-4f88-87f5-13edc68a5616/esrp-pcs-icr3231/mod_803b3db4-bd02-472c-8ad3-624aaaab2433\">ESRP-PCS-ICR3231</a> or <a href=\"https://www.advantech.com/zh-tw/products/7332cf9e-bf70-4a79-b0b6-fd8a2182cd72/ecu-1051/mod_0ea5f440-e270-436f-afa3-077df3acce5d\">ECU-1051</a>) can be used to convert IEC 101 to IEC 104, enabling integration into modern Ethernet-based systems.</p>\n<hr>\n<h2 id=\"6-Security-Challenges-and-Protections-under-IEC-62351\"><a href=\"#6-Security-Challenges-and-Protections-under-IEC-62351\" class=\"headerlink\" title=\"6. Security Challenges and Protections under IEC 62351\"></a>6. Security Challenges and Protections under IEC 62351</h2><p>IEC 104 was not originally designed with modern cybersecurity threats in mind, leading to the following issues:</p>\n<ul>\n<li><strong>Plaintext transmission</strong>, vulnerable to eavesdropping.</li>\n<li><strong>Lack of authentication</strong>, allowing attackers to impersonate the master station.</li>\n<li><strong>No encryption or integrity checks</strong>, making it prone to man-in-the-middle attacks.</li>\n</ul>\n<p>To address these risks, IEC introduced the <a href=\"https://www.iec.ch/blog/cyber-security-understanding-iec-62351\"><strong>IEC 62351 series</strong></a>:</p>\n<ul>\n<li><a href=\"https://webstore.iec.ch/en/publication/68410\"><strong>IEC 62351-3</strong></a>: Recommends using TLS over TCP (similar to HTTPS) to encrypt data.</li>\n<li><a href=\"https://webstore.iec.ch/en/publication/65511\"><strong>IEC 62351-5</strong></a>: Adds signatures and sequence protection at the application layer to prevent spoofing and replay attacks.</li>\n<li><a href=\"https://webstore.iec.ch/en/publication/61822\"><strong>IEC 62351-8</strong></a> &amp; <a href=\"https://webstore.iec.ch/en/publication/66864\"><strong>IEC 62351-9</strong></a>: Define device authentication and key management methods.</li>\n</ul>\n<p>If devices do not support IEC 62351, <strong>VPNs</strong> or <strong>secure gateways</strong> can be used for encrypted communication or packet forwarding.</p>\n<hr>\n<h2 id=\"7-Practical-Recommendations-for-Secure-and-Stable-Deployment\"><a href=\"#7-Practical-Recommendations-for-Secure-and-Stable-Deployment\" class=\"headerlink\" title=\"7. Practical Recommendations for Secure and Stable Deployment\"></a>7. Practical Recommendations for Secure and Stable Deployment</h2><p>Even with IEC 62351 in place, the following best practices are recommended:</p>\n<ul>\n<li><strong>Network Segmentation</strong>: Isolate SCADA and control networks from corporate IT networks.</li>\n<li><strong>Firewall Port Control</strong>: Restrict access to Port 2404 to authorized IP addresses only.</li>\n<li><strong>Intrusion Detection Systems (IDS)</strong>: Monitor abnormal IEC 104 traffic and command patterns.</li>\n<li><strong>Secure Gateways</strong>: Enforce data and command restrictions based on IOA and Type ID.</li>\n<li><strong>VPN Encryption</strong>: Use secure channels for remote access.</li>\n<li><strong>Firmware Updates</strong>: Regularly patch known vulnerabilities in devices.<br>These strategies form a <strong>defense-in-depth</strong> approach, significantly reducing the risk of successful cyberattacks.</li>\n</ul>\n","excerpt":"","more":"<p><img src=\"/post/An-Overview-of-IEC-60870-5-104-Practical-and-Security-Applications-of-the-SCADA-Communication-Protocol/cover_img.jpeg\"></p>\n<center>Source: https://www.dreamstime.com/</center>\n\n<h2 id=\"1-Glossary-of-Technical-Terms\"><a href=\"#1-Glossary-of-Technical-Terms\" class=\"headerlink\" title=\"1. Glossary of Technical Terms\"></a>1. Glossary of Technical Terms</h2><ul>\n<li><p><strong>Telemetry</strong><br>  <em>Definition：</em> The technology for collecting data from remote devices or systems and transmitting it back to a central control system. The data is typically gathered from sensors or monitoring equipment, such as temperature, pressure, or location.<br>  <em>Example：</em> A space probe transmitting its velocity, temperature, and position data back to Earth is an example of telemetry.</p>\n</li>\n<li><p><strong>Tele-signaling &#x2F; Remote Signaling</strong><br>  <em>Definition：</em> Transmission of status or alarm signals from remote equipment, generally as discrete data (e.g., ON&#x2F;OFF, Normal&#x2F;Failure).<br>  <em>Example：</em> A power plant control center receiving a “breaker closed” signal from a substation is an instance of remote signaling.</p>\n</li>\n<li><p><strong>Telecontrol &#x2F; Remote Control</strong><br>  <em>Definition：</em> Remote operation or control of devices, such as switching equipment on&#x2F;off, configuring settings, or initiating processes.<br>  <em>Example：</em> Remotely starting a factory machine or turning on an air conditioner is a form of telecontrol.</p>\n</li>\n<li><p><strong>DSP → Digital signal processor</strong><br>  <em>Definition：</em> A specialized microprocessor designed for high-speed numeric processing, widely used in telecommunications, audio, digital image processing, radar, sonar, and consumer electronics.</p>\n</li>\n<li><p><strong>RTU → Remote terminal unit</strong><br>  <em>Definition：</em> A microprocessor-based electronic device that acts as an interface to field devices and transmits telemetry data to the SCADA system while also receiving control commands.</p>\n</li>\n<li><p><strong>IED → Intelligent Electronic Device</strong><br>  <em>Definition：</em> An advanced electronic device capable of data processing and communication, used in power systems and industrial control for monitoring, control, protection, and communication. It goes beyond simple sensors or relays by incorporating microprocessors and communication interfaces.</p>\n</li>\n<li><p><strong>COT → Cause of Transmission</strong><br>  <em>Definition：</em> A critical field within the ASDU (Application Service Data Unit) in IEC 60870-5, indicating the reason for data transmission (e.g., cyclic, spontaneous, test).</p>\n</li>\n<li><p><strong>IOA → Information Object Address</strong><br>  <em>Definition：</em> Identifies the internal address of a specific point within a device. Each RTU or IED typically has a point list, and the IOA is used to reference those points.</p>\n</li>\n<li><p><strong>Frame</strong><br>  <em>Definition：</em> A basic unit of data encapsulation in industrial communication protocols, consisting of a header (Start of Frame, address, function code), payload, and CRC (error check).</p>\n</li>\n<li><p><strong>SCADA → Supervisory Control And Data Acquisition</strong><br>  <em>Definition：</em> A system architecture used for remote monitoring and control of large-scale industrial systems. SCADA systems enable centralized operators to oversee field devices, send control commands, and visualize&#x2F;analyze real-time data.</p>\n</li>\n</ul>\n<hr>\n<h2 id=\"2-Introduction-to-the-IEC-60870-5-Protocol-Series\"><a href=\"#2-Introduction-to-the-IEC-60870-5-Protocol-Series\" class=\"headerlink\" title=\"2. Introduction to the IEC 60870-5 Protocol Series\"></a>2. Introduction to the IEC 60870-5 Protocol Series</h2><p>IEC 60870 is a set of international communication standards developed by the <a href=\"https://www.iec.ch/homepage\">International Electrotechnical Commission (IEC)</a> for reliable data transmission between industrial control centers (SCADA) and remote devices such as RTUs and IEDs. These standards are widely adopted in <strong>power systems, smart grids, and industrial automation</strong>.</p>\n<p>IEC 60870-5 is Part 5 of the standard family and includes over 13 sub-standards focusing on protocols for <strong>remote control, protection, and communication</strong> in power systems.</p>\n<p>Two commonly used sub-standards include:</p>\n<ul>\n<li><strong>IEC 60870-5-101 (IEC 101)</strong>: Designed for serial communication (RS-232&#x2F;RS-485), suitable for point-to-point local transmission.</li>\n<li><strong>IEC 60870-5-104 (IEC 104)</strong>: Designed for modern network environments using TCP&#x2F;IP, enabling wide-area communication via Ethernet or VPN.</li>\n</ul>\n<p>In essence, IEC 104 extends the IEC 101 data structure to IP networks, allowing continuous bidirectional connections for real-time data exchange, rather than relying on traditional polling.</p>\n<hr>\n<h2 id=\"3-Mapping-IEC-104-to-the-OSI-Model\"><a href=\"#3-Mapping-IEC-104-to-the-OSI-Model\" class=\"headerlink\" title=\"3. Mapping IEC 104 to the OSI Model\"></a>3. Mapping IEC 104 to the OSI Model</h2><p>IEC 104 functions as an application-layer protocol and uses TCP for transport, typically operating over <strong>Port 2404</strong>.</p>\n<p>The mapping to the OSI model is as follows:</p>\n<ul>\n<li><strong>Application Layer</strong>: IEC 104</li>\n<li><strong>Transport Layer</strong>: TCP</li>\n<li><strong>Network Layer</strong>: IP</li>\n<li><strong>Data Link &#x2F; Physical Layer</strong>: Ethernet</li>\n</ul>\n<p>SCADA systems typically use a <strong>Master-Slave architecture</strong> [1] where <strong>the control center (Master) acts as the Client, and the field devices (RTUs&#x2F;IEDs) act as Servers</strong>. A persistent TCP connection is established for data exchange and control.</p>\n<p>After connection, the client initiates communication with the <strong>StartDT</strong> command. If the server is unresponsive for too long, the <strong>TestFR</strong> command is used to verify the connection.</p>\n<h6 id=\"1-Since-2020-the-terms-“Master”-and-“Slave”-have-come-under-scrutiny-in-the-tech-industry-due-to-their-historical-association-with-slavery-Companies-like-Oracle-and-GitHub-have-advocated-replacing-them-with-alternatives-like-Primary-Replica-Conductor-Member-or-Primary-Secondary-to-promote-more-inclusive-language-However-as-the-IEC-standards-were-defined-before-this-shift-and-still-reference-these-terms-we-use-them-here-strictly-for-consistency-and-clarity-in-reference-to-the-original-documentation\"><a href=\"#1-Since-2020-the-terms-“Master”-and-“Slave”-have-come-under-scrutiny-in-the-tech-industry-due-to-their-historical-association-with-slavery-Companies-like-Oracle-and-GitHub-have-advocated-replacing-them-with-alternatives-like-Primary-Replica-Conductor-Member-or-Primary-Secondary-to-promote-more-inclusive-language-However-as-the-IEC-standards-were-defined-before-this-shift-and-still-reference-these-terms-we-use-them-here-strictly-for-consistency-and-clarity-in-reference-to-the-original-documentation\" class=\"headerlink\" title=\"[1] Since 2020, the terms “Master” and “Slave” have come under scrutiny in the tech industry due to their historical association with slavery. Companies like Oracle and GitHub have advocated replacing them with alternatives like Primary-Replica, Conductor-Member, or Primary-Secondary to promote more inclusive language.However, as the IEC standards were defined before this shift and still reference these terms, we use them here strictly for consistency and clarity in reference to the original documentation.\"></a>[1] Since 2020, the terms “Master” and “Slave” have come under scrutiny in the tech industry due to their historical association with slavery. Companies like Oracle and GitHub have advocated replacing them with alternatives like <strong>Primary-Replica, Conductor-Member, or Primary-Secondary</strong> to promote more inclusive language.<br>However, as the <strong>IEC standards</strong> were defined before this shift and still reference these terms, we use them here strictly for consistency and clarity in reference to the original documentation.</h6><hr>\n<h2 id=\"4-Communication-Format-and-Data-Structure\"><a href=\"#4-Communication-Format-and-Data-Structure\" class=\"headerlink\" title=\"4. Communication Format and Data Structure\"></a>4. Communication Format and Data Structure</h2><p>IEC 104 uses <strong>ASDU (Application Service Data Unit)</strong> as the primary data encapsulation format. Each ASDU contains:</p>\n<ul>\n<li><strong>Type ID</strong>: Identifies the data type (e.g., telemetry, tele-signaling, telecontrol).</li>\n<li><strong>Cause of Transmission (COT)</strong>: Indicates the reason for transmission (cyclic, spontaneous, test, command).</li>\n<li><strong>Common Address &#x2F; Information Object Address (IOA)</strong>: Identifies the device and data point.</li>\n<li><strong>Data Content</strong>: The actual transmitted value (e.g., ON&#x2F;OFF, voltage reading).</li>\n</ul>\n<p>IEC 104 frames are categorized into three types:</p>\n<ul>\n<li><strong>I-frame</strong>: Carries actual data.</li>\n<li><strong>S-frame</strong>: Acknowledges received data.</li>\n<li><strong>U-frame</strong>: Manages connection control (StartDT, StopDT, TestFR).</li>\n</ul>\n<p>Each message includes sequence numbers for flow control and error detection to ensure reliable delivery.</p>\n<hr>\n<h2 id=\"5-Real-World-Use-Case-Integrating-with-SCADA-Systems\"><a href=\"#5-Real-World-Use-Case-Integrating-with-SCADA-Systems\" class=\"headerlink\" title=\"5. Real-World Use Case: Integrating with SCADA Systems\"></a>5. Real-World Use Case: Integrating with SCADA Systems</h2><p>IEC 104 is a widely used protocol in modern SCADA systems.<br><strong>Examples</strong>:</p>\n<ul>\n<li>Siemens RTUs and WinCC SCADA systems communicate via IEC 104.</li>\n<li>Schneider Electric’s ClearSCADA (Geo SCADA) supports IEC 104.</li>\n<li>ABB’s MicroSCADA and RTU560 include built-in IEC 104 communication modules.</li>\n</ul>\n<p>These devices typically interface with IEDs (e.g., smart meters, protection relays) to receive telemetry such as:</p>\n<ul>\n<li>Voltage&#x2F;current fluctuations</li>\n<li>Protection trip events</li>\n<li>Remote control execution statuses</li>\n</ul>\n<p>SCADA systems are configured with matching Type IDs, COTs, and IOAs for each data point.</p>\n<p>In cases where legacy field equipment only supports IEC 101 (serial), <strong>protocol converters</strong> or <strong>gateways</strong> (e.g., Advantech <a href=\"https://www.advantech.com/zh-tw/products/ac0bd5cd-093a-4f88-87f5-13edc68a5616/esrp-pcs-icr3231/mod_803b3db4-bd02-472c-8ad3-624aaaab2433\">ESRP-PCS-ICR3231</a> or <a href=\"https://www.advantech.com/zh-tw/products/7332cf9e-bf70-4a79-b0b6-fd8a2182cd72/ecu-1051/mod_0ea5f440-e270-436f-afa3-077df3acce5d\">ECU-1051</a>) can be used to convert IEC 101 to IEC 104, enabling integration into modern Ethernet-based systems.</p>\n<hr>\n<h2 id=\"6-Security-Challenges-and-Protections-under-IEC-62351\"><a href=\"#6-Security-Challenges-and-Protections-under-IEC-62351\" class=\"headerlink\" title=\"6. Security Challenges and Protections under IEC 62351\"></a>6. Security Challenges and Protections under IEC 62351</h2><p>IEC 104 was not originally designed with modern cybersecurity threats in mind, leading to the following issues:</p>\n<ul>\n<li><strong>Plaintext transmission</strong>, vulnerable to eavesdropping.</li>\n<li><strong>Lack of authentication</strong>, allowing attackers to impersonate the master station.</li>\n<li><strong>No encryption or integrity checks</strong>, making it prone to man-in-the-middle attacks.</li>\n</ul>\n<p>To address these risks, IEC introduced the <a href=\"https://www.iec.ch/blog/cyber-security-understanding-iec-62351\"><strong>IEC 62351 series</strong></a>:</p>\n<ul>\n<li><a href=\"https://webstore.iec.ch/en/publication/68410\"><strong>IEC 62351-3</strong></a>: Recommends using TLS over TCP (similar to HTTPS) to encrypt data.</li>\n<li><a href=\"https://webstore.iec.ch/en/publication/65511\"><strong>IEC 62351-5</strong></a>: Adds signatures and sequence protection at the application layer to prevent spoofing and replay attacks.</li>\n<li><a href=\"https://webstore.iec.ch/en/publication/61822\"><strong>IEC 62351-8</strong></a> &amp; <a href=\"https://webstore.iec.ch/en/publication/66864\"><strong>IEC 62351-9</strong></a>: Define device authentication and key management methods.</li>\n</ul>\n<p>If devices do not support IEC 62351, <strong>VPNs</strong> or <strong>secure gateways</strong> can be used for encrypted communication or packet forwarding.</p>\n<hr>\n<h2 id=\"7-Practical-Recommendations-for-Secure-and-Stable-Deployment\"><a href=\"#7-Practical-Recommendations-for-Secure-and-Stable-Deployment\" class=\"headerlink\" title=\"7. Practical Recommendations for Secure and Stable Deployment\"></a>7. Practical Recommendations for Secure and Stable Deployment</h2><p>Even with IEC 62351 in place, the following best practices are recommended:</p>\n<ul>\n<li><strong>Network Segmentation</strong>: Isolate SCADA and control networks from corporate IT networks.</li>\n<li><strong>Firewall Port Control</strong>: Restrict access to Port 2404 to authorized IP addresses only.</li>\n<li><strong>Intrusion Detection Systems (IDS)</strong>: Monitor abnormal IEC 104 traffic and command patterns.</li>\n<li><strong>Secure Gateways</strong>: Enforce data and command restrictions based on IOA and Type ID.</li>\n<li><strong>VPN Encryption</strong>: Use secure channels for remote access.</li>\n<li><strong>Firmware Updates</strong>: Regularly patch known vulnerabilities in devices.<br>These strategies form a <strong>defense-in-depth</strong> approach, significantly reducing the risk of successful cyberattacks.</li>\n</ul>\n"},{"title":"Secure by Demand: Driving OT Security Transformation Through Strategic Procurement","date":"2025-03-26T14:00:00.000Z","cover_image":"https://kevinchiu923.github.io/post/Secure-by-Demand-Driving-OT-Security-Transformation-Through-Strategic-Procurement/cover_img.jpeg","_content":"\n![](Secure-by-Demand-Driving-OT-Security-Transformation-Through-Strategic-Procurement/cover_img.jpeg)\n<center>Source: Cybersecurity and Infrastructure Security Agency </center>\n\nIn response to the growing cybersecurity threats facing today’s Industrial Control Systems (ICS) and Operational Technology (OT), the U.S. Cybersecurity and Infrastructure Security Agency (CISA), the National Security Agency (NSA), the Federal Bureau of Investigation (FBI), along with several international government partners, jointly released the “[Secure by Demand – Priority Considerations for Operational Technology Owners and Operators When Selecting Digital Products](https://www.cisa.gov/resources-tools/resources/secure-demand-priority-considerations-operational-technology-owners-and-operators-when-selecting)” on January 13, 2025.\n\nThis guide provides OT asset owners and operators with a set of **security-centric procurement priorities**, aimed at accelerating the shift from “***Secure by Design***” to “***Secure by Default***” across the digital product supply chain.\n\n---\n\n## Why Should OT Security Start with Procurement?\nHistorically, OT systems have emphasized availability and stability, often at the cost of integrated cybersecurity.\n\nToday, attackers no longer target a single organization—they exploit **common vulnerabilities** in OT products such as weak passwords, default credentials, insecure protocols, and lack of logging mechanisms. A successful intrusion can lead to **widespread compromise** across industries and infrastructure sectors.\n\n**Secure by Demand** represents a mindset shift:\n\n> **Rather than relying on buyers to patch security gaps post-deployment, it calls for vendors to deliver secure-by-default products from the outset.**\n\n---\n\n## 12 Security Priorities for Selecting OT Products\n**1. Configuration Management**\nMust include change tracking, authorization verification, and secure backup mechanisms to prevent persistent malicious configurations.\n\n**2. Baseline Logging Support**\nLogging of logins, configuration changes, and anomalies should be enabled by default, using open standard formats.\n\n**3. Open Standards Compliance**\nAdoption of interoperable protocols (e.g., [OPC UA](https://en.wikipedia.org/wiki/OPC_Unified_Architecture), [TLS](https://en.wikipedia.org/wiki/Transport_Layer_Security)) to enhance portability and prevent vendor lock-in.\n\n**4. Operational Autonomy**\nBuyers must retain full control over system maintenance and not be dependent on vendor-exclusive services or restricted from deploying their security tools.\n\n**5. Data Protection**\nEnsure the confidentiality and integrity of engineering logic, configuration files, and operational data to prevent theft or tampering.\n\n**6. Secure by Default**\nDevices should ship with hardened settings, **disable default passwords and insecure services**, and include all security features out of the box.\n\n**7. Secure Communications**\nMust support certificate-based authentication and provide a **simple deployment process**, even for non-cybersecurity professionals.\n\n**8. Resilience Against Malicious Commands**\nCapable of detecting and rejecting unauthorized or unexpected commands to prevent safety incidents or system disruption.\n\n**9. Strong Authentication**\nMust support phishing-resistant **Multi-Factor Authentication (MFA)** and role-based access control to avoid shared credentials and identity abuse.\n\n**10. Threat Modeling Capability**\nVendors must provide up-to-date threat models and mitigation strategies to assist buyers in security risk assessments.\n\n**11. Vulnerability Management**\nIt should follow comprehensive CVE processes, support coordinated vulnerability disclosure (CVD), and include **Software Bill of Materials (SBOM)** — all while offering free security updates.\n\n**12. Upgrade and Patch Tooling**\nMust support secure update verification, well-documented upgrade procedures, and **seamless OS migration** without additional cost.\n\n---\n\n## Cultivating a Culture of Secure Procurement: The Buyer’s Role\n> **At the core of Secure by Demand is a powerful message: Buyers are the first line of defense in OT cybersecurity.**\n\nBy demanding products that meet the above security priorities, buyers can:\n\n- **Incentivize vendors** to integrate cybersecurity into product design\n- **Avoid high costs** associated with late-stage remediation\n- **Proactively address compliance** with emerging regulations like the EU’s [NIS2](https://digital-strategy.ec.europa.eu/en/policies/nis2-directive) and [Cyber Resilience Act](https://digital-strategy.ec.europa.eu/en/policies/cyber-resilience-act)\n\nAt the same time, this approach facilitates the **gradual replacement of aging, hard-to-update systems**, paving the way for sustainable digital transformation.\n\n---\n\n## Practical Tips for Secure Procurement\n- Explicitly define security features and certification standards (e.g.,[ ISA/IEC 62443](https://www.isa.org/standards-and-publications/isa-standards/isa-iec-62443-series-of-standards)) in procurement documents\n- Evaluate whether vendors provide **free vulnerability remediation** and long-term security support\n- Require **threat models, SBOMs, and secure design documentation** as part of vendor deliverables\n- Prioritize products that support **MFA, zero-trust architecture**, and **open standards**\n\n---\n\n## Conclusion: Cybersecurity is Not Just a Technical Concern - It’s a Procurement Decision\n**Secure by Demand** reinforces a critical truth:\n>**If security is not built-in by default, the ultimate cost will be much higher.**\n\nFor OT asset owners, procurement marks the beginning of the security journey.\n\nFor vendors, embedding security into products is no longer optional—it’s a competitive differentiator.","source":"_posts/Secure-by-Demand-Driving-OT-Security-Transformation-Through-Strategic-Procurement.md","raw":"---\ntitle: >-\n  Secure by Demand: Driving OT Security Transformation Through Strategic Procurement\ndate: 2025-03-26 22:00:00\ntags:\n  - English\n  - Operational technology\n  - Critical Infrastructure Security and Resilience\n  - Cybersecurity Best Practices\ncategories:\n  - Knowledge base\ncover_image: 'https://kevinchiu923.github.io/post/Secure-by-Demand-Driving-OT-Security-Transformation-Through-Strategic-Procurement/cover_img.jpeg'\n---\n\n![](Secure-by-Demand-Driving-OT-Security-Transformation-Through-Strategic-Procurement/cover_img.jpeg)\n<center>Source: Cybersecurity and Infrastructure Security Agency </center>\n\nIn response to the growing cybersecurity threats facing today’s Industrial Control Systems (ICS) and Operational Technology (OT), the U.S. Cybersecurity and Infrastructure Security Agency (CISA), the National Security Agency (NSA), the Federal Bureau of Investigation (FBI), along with several international government partners, jointly released the “[Secure by Demand – Priority Considerations for Operational Technology Owners and Operators When Selecting Digital Products](https://www.cisa.gov/resources-tools/resources/secure-demand-priority-considerations-operational-technology-owners-and-operators-when-selecting)” on January 13, 2025.\n\nThis guide provides OT asset owners and operators with a set of **security-centric procurement priorities**, aimed at accelerating the shift from “***Secure by Design***” to “***Secure by Default***” across the digital product supply chain.\n\n---\n\n## Why Should OT Security Start with Procurement?\nHistorically, OT systems have emphasized availability and stability, often at the cost of integrated cybersecurity.\n\nToday, attackers no longer target a single organization—they exploit **common vulnerabilities** in OT products such as weak passwords, default credentials, insecure protocols, and lack of logging mechanisms. A successful intrusion can lead to **widespread compromise** across industries and infrastructure sectors.\n\n**Secure by Demand** represents a mindset shift:\n\n> **Rather than relying on buyers to patch security gaps post-deployment, it calls for vendors to deliver secure-by-default products from the outset.**\n\n---\n\n## 12 Security Priorities for Selecting OT Products\n**1. Configuration Management**\nMust include change tracking, authorization verification, and secure backup mechanisms to prevent persistent malicious configurations.\n\n**2. Baseline Logging Support**\nLogging of logins, configuration changes, and anomalies should be enabled by default, using open standard formats.\n\n**3. Open Standards Compliance**\nAdoption of interoperable protocols (e.g., [OPC UA](https://en.wikipedia.org/wiki/OPC_Unified_Architecture), [TLS](https://en.wikipedia.org/wiki/Transport_Layer_Security)) to enhance portability and prevent vendor lock-in.\n\n**4. Operational Autonomy**\nBuyers must retain full control over system maintenance and not be dependent on vendor-exclusive services or restricted from deploying their security tools.\n\n**5. Data Protection**\nEnsure the confidentiality and integrity of engineering logic, configuration files, and operational data to prevent theft or tampering.\n\n**6. Secure by Default**\nDevices should ship with hardened settings, **disable default passwords and insecure services**, and include all security features out of the box.\n\n**7. Secure Communications**\nMust support certificate-based authentication and provide a **simple deployment process**, even for non-cybersecurity professionals.\n\n**8. Resilience Against Malicious Commands**\nCapable of detecting and rejecting unauthorized or unexpected commands to prevent safety incidents or system disruption.\n\n**9. Strong Authentication**\nMust support phishing-resistant **Multi-Factor Authentication (MFA)** and role-based access control to avoid shared credentials and identity abuse.\n\n**10. Threat Modeling Capability**\nVendors must provide up-to-date threat models and mitigation strategies to assist buyers in security risk assessments.\n\n**11. Vulnerability Management**\nIt should follow comprehensive CVE processes, support coordinated vulnerability disclosure (CVD), and include **Software Bill of Materials (SBOM)** — all while offering free security updates.\n\n**12. Upgrade and Patch Tooling**\nMust support secure update verification, well-documented upgrade procedures, and **seamless OS migration** without additional cost.\n\n---\n\n## Cultivating a Culture of Secure Procurement: The Buyer’s Role\n> **At the core of Secure by Demand is a powerful message: Buyers are the first line of defense in OT cybersecurity.**\n\nBy demanding products that meet the above security priorities, buyers can:\n\n- **Incentivize vendors** to integrate cybersecurity into product design\n- **Avoid high costs** associated with late-stage remediation\n- **Proactively address compliance** with emerging regulations like the EU’s [NIS2](https://digital-strategy.ec.europa.eu/en/policies/nis2-directive) and [Cyber Resilience Act](https://digital-strategy.ec.europa.eu/en/policies/cyber-resilience-act)\n\nAt the same time, this approach facilitates the **gradual replacement of aging, hard-to-update systems**, paving the way for sustainable digital transformation.\n\n---\n\n## Practical Tips for Secure Procurement\n- Explicitly define security features and certification standards (e.g.,[ ISA/IEC 62443](https://www.isa.org/standards-and-publications/isa-standards/isa-iec-62443-series-of-standards)) in procurement documents\n- Evaluate whether vendors provide **free vulnerability remediation** and long-term security support\n- Require **threat models, SBOMs, and secure design documentation** as part of vendor deliverables\n- Prioritize products that support **MFA, zero-trust architecture**, and **open standards**\n\n---\n\n## Conclusion: Cybersecurity is Not Just a Technical Concern - It’s a Procurement Decision\n**Secure by Demand** reinforces a critical truth:\n>**If security is not built-in by default, the ultimate cost will be much higher.**\n\nFor OT asset owners, procurement marks the beginning of the security journey.\n\nFor vendors, embedding security into products is no longer optional—it’s a competitive differentiator.","slug":"Secure-by-Demand-Driving-OT-Security-Transformation-Through-Strategic-Procurement","published":1,"updated":"2025-04-03T01:52:14.110Z","comments":1,"layout":"post","photos":[],"_id":"cm9agcuc30003nc829si42dva","content":"<p><img src=\"/post/Secure-by-Demand-Driving-OT-Security-Transformation-Through-Strategic-Procurement/cover_img.jpeg\"></p>\n<center>Source: Cybersecurity and Infrastructure Security Agency </center>\n\n<p>In response to the growing cybersecurity threats facing today’s Industrial Control Systems (ICS) and Operational Technology (OT), the U.S. Cybersecurity and Infrastructure Security Agency (CISA), the National Security Agency (NSA), the Federal Bureau of Investigation (FBI), along with several international government partners, jointly released the “<a href=\"https://www.cisa.gov/resources-tools/resources/secure-demand-priority-considerations-operational-technology-owners-and-operators-when-selecting\">Secure by Demand – Priority Considerations for Operational Technology Owners and Operators When Selecting Digital Products</a>” on January 13, 2025.</p>\n<p>This guide provides OT asset owners and operators with a set of <strong>security-centric procurement priorities</strong>, aimed at accelerating the shift from “<em><strong>Secure by Design</strong></em>” to “<em><strong>Secure by Default</strong></em>” across the digital product supply chain.</p>\n<hr>\n<h2 id=\"Why-Should-OT-Security-Start-with-Procurement\"><a href=\"#Why-Should-OT-Security-Start-with-Procurement\" class=\"headerlink\" title=\"Why Should OT Security Start with Procurement?\"></a>Why Should OT Security Start with Procurement?</h2><p>Historically, OT systems have emphasized availability and stability, often at the cost of integrated cybersecurity.</p>\n<p>Today, attackers no longer target a single organization—they exploit <strong>common vulnerabilities</strong> in OT products such as weak passwords, default credentials, insecure protocols, and lack of logging mechanisms. A successful intrusion can lead to <strong>widespread compromise</strong> across industries and infrastructure sectors.</p>\n<p><strong>Secure by Demand</strong> represents a mindset shift:</p>\n<blockquote>\n<p><strong>Rather than relying on buyers to patch security gaps post-deployment, it calls for vendors to deliver secure-by-default products from the outset.</strong></p>\n</blockquote>\n<hr>\n<h2 id=\"12-Security-Priorities-for-Selecting-OT-Products\"><a href=\"#12-Security-Priorities-for-Selecting-OT-Products\" class=\"headerlink\" title=\"12 Security Priorities for Selecting OT Products\"></a>12 Security Priorities for Selecting OT Products</h2><p><strong>1. Configuration Management</strong><br>Must include change tracking, authorization verification, and secure backup mechanisms to prevent persistent malicious configurations.</p>\n<p><strong>2. Baseline Logging Support</strong><br>Logging of logins, configuration changes, and anomalies should be enabled by default, using open standard formats.</p>\n<p><strong>3. Open Standards Compliance</strong><br>Adoption of interoperable protocols (e.g., <a href=\"https://en.wikipedia.org/wiki/OPC_Unified_Architecture\">OPC UA</a>, <a href=\"https://en.wikipedia.org/wiki/Transport_Layer_Security\">TLS</a>) to enhance portability and prevent vendor lock-in.</p>\n<p><strong>4. Operational Autonomy</strong><br>Buyers must retain full control over system maintenance and not be dependent on vendor-exclusive services or restricted from deploying their security tools.</p>\n<p><strong>5. Data Protection</strong><br>Ensure the confidentiality and integrity of engineering logic, configuration files, and operational data to prevent theft or tampering.</p>\n<p><strong>6. Secure by Default</strong><br>Devices should ship with hardened settings, <strong>disable default passwords and insecure services</strong>, and include all security features out of the box.</p>\n<p><strong>7. Secure Communications</strong><br>Must support certificate-based authentication and provide a <strong>simple deployment process</strong>, even for non-cybersecurity professionals.</p>\n<p><strong>8. Resilience Against Malicious Commands</strong><br>Capable of detecting and rejecting unauthorized or unexpected commands to prevent safety incidents or system disruption.</p>\n<p><strong>9. Strong Authentication</strong><br>Must support phishing-resistant <strong>Multi-Factor Authentication (MFA)</strong> and role-based access control to avoid shared credentials and identity abuse.</p>\n<p><strong>10. Threat Modeling Capability</strong><br>Vendors must provide up-to-date threat models and mitigation strategies to assist buyers in security risk assessments.</p>\n<p><strong>11. Vulnerability Management</strong><br>It should follow comprehensive CVE processes, support coordinated vulnerability disclosure (CVD), and include <strong>Software Bill of Materials (SBOM)</strong> — all while offering free security updates.</p>\n<p><strong>12. Upgrade and Patch Tooling</strong><br>Must support secure update verification, well-documented upgrade procedures, and <strong>seamless OS migration</strong> without additional cost.</p>\n<hr>\n<h2 id=\"Cultivating-a-Culture-of-Secure-Procurement-The-Buyer’s-Role\"><a href=\"#Cultivating-a-Culture-of-Secure-Procurement-The-Buyer’s-Role\" class=\"headerlink\" title=\"Cultivating a Culture of Secure Procurement: The Buyer’s Role\"></a>Cultivating a Culture of Secure Procurement: The Buyer’s Role</h2><blockquote>\n<p><strong>At the core of Secure by Demand is a powerful message: Buyers are the first line of defense in OT cybersecurity.</strong></p>\n</blockquote>\n<p>By demanding products that meet the above security priorities, buyers can:</p>\n<ul>\n<li><strong>Incentivize vendors</strong> to integrate cybersecurity into product design</li>\n<li><strong>Avoid high costs</strong> associated with late-stage remediation</li>\n<li><strong>Proactively address compliance</strong> with emerging regulations like the EU’s <a href=\"https://digital-strategy.ec.europa.eu/en/policies/nis2-directive\">NIS2</a> and <a href=\"https://digital-strategy.ec.europa.eu/en/policies/cyber-resilience-act\">Cyber Resilience Act</a></li>\n</ul>\n<p>At the same time, this approach facilitates the <strong>gradual replacement of aging, hard-to-update systems</strong>, paving the way for sustainable digital transformation.</p>\n<hr>\n<h2 id=\"Practical-Tips-for-Secure-Procurement\"><a href=\"#Practical-Tips-for-Secure-Procurement\" class=\"headerlink\" title=\"Practical Tips for Secure Procurement\"></a>Practical Tips for Secure Procurement</h2><ul>\n<li>Explicitly define security features and certification standards (e.g.,<a href=\"https://www.isa.org/standards-and-publications/isa-standards/isa-iec-62443-series-of-standards\"> ISA&#x2F;IEC 62443</a>) in procurement documents</li>\n<li>Evaluate whether vendors provide <strong>free vulnerability remediation</strong> and long-term security support</li>\n<li>Require <strong>threat models, SBOMs, and secure design documentation</strong> as part of vendor deliverables</li>\n<li>Prioritize products that support <strong>MFA, zero-trust architecture</strong>, and <strong>open standards</strong></li>\n</ul>\n<hr>\n<h2 id=\"Conclusion-Cybersecurity-is-Not-Just-a-Technical-Concern-It’s-a-Procurement-Decision\"><a href=\"#Conclusion-Cybersecurity-is-Not-Just-a-Technical-Concern-It’s-a-Procurement-Decision\" class=\"headerlink\" title=\"Conclusion: Cybersecurity is Not Just a Technical Concern - It’s a Procurement Decision\"></a>Conclusion: Cybersecurity is Not Just a Technical Concern - It’s a Procurement Decision</h2><p><strong>Secure by Demand</strong> reinforces a critical truth:</p>\n<blockquote>\n<p><strong>If security is not built-in by default, the ultimate cost will be much higher.</strong></p>\n</blockquote>\n<p>For OT asset owners, procurement marks the beginning of the security journey.</p>\n<p>For vendors, embedding security into products is no longer optional—it’s a competitive differentiator.</p>\n","excerpt":"","more":"<p><img src=\"/post/Secure-by-Demand-Driving-OT-Security-Transformation-Through-Strategic-Procurement/cover_img.jpeg\"></p>\n<center>Source: Cybersecurity and Infrastructure Security Agency </center>\n\n<p>In response to the growing cybersecurity threats facing today’s Industrial Control Systems (ICS) and Operational Technology (OT), the U.S. Cybersecurity and Infrastructure Security Agency (CISA), the National Security Agency (NSA), the Federal Bureau of Investigation (FBI), along with several international government partners, jointly released the “<a href=\"https://www.cisa.gov/resources-tools/resources/secure-demand-priority-considerations-operational-technology-owners-and-operators-when-selecting\">Secure by Demand – Priority Considerations for Operational Technology Owners and Operators When Selecting Digital Products</a>” on January 13, 2025.</p>\n<p>This guide provides OT asset owners and operators with a set of <strong>security-centric procurement priorities</strong>, aimed at accelerating the shift from “<em><strong>Secure by Design</strong></em>” to “<em><strong>Secure by Default</strong></em>” across the digital product supply chain.</p>\n<hr>\n<h2 id=\"Why-Should-OT-Security-Start-with-Procurement\"><a href=\"#Why-Should-OT-Security-Start-with-Procurement\" class=\"headerlink\" title=\"Why Should OT Security Start with Procurement?\"></a>Why Should OT Security Start with Procurement?</h2><p>Historically, OT systems have emphasized availability and stability, often at the cost of integrated cybersecurity.</p>\n<p>Today, attackers no longer target a single organization—they exploit <strong>common vulnerabilities</strong> in OT products such as weak passwords, default credentials, insecure protocols, and lack of logging mechanisms. A successful intrusion can lead to <strong>widespread compromise</strong> across industries and infrastructure sectors.</p>\n<p><strong>Secure by Demand</strong> represents a mindset shift:</p>\n<blockquote>\n<p><strong>Rather than relying on buyers to patch security gaps post-deployment, it calls for vendors to deliver secure-by-default products from the outset.</strong></p>\n</blockquote>\n<hr>\n<h2 id=\"12-Security-Priorities-for-Selecting-OT-Products\"><a href=\"#12-Security-Priorities-for-Selecting-OT-Products\" class=\"headerlink\" title=\"12 Security Priorities for Selecting OT Products\"></a>12 Security Priorities for Selecting OT Products</h2><p><strong>1. Configuration Management</strong><br>Must include change tracking, authorization verification, and secure backup mechanisms to prevent persistent malicious configurations.</p>\n<p><strong>2. Baseline Logging Support</strong><br>Logging of logins, configuration changes, and anomalies should be enabled by default, using open standard formats.</p>\n<p><strong>3. Open Standards Compliance</strong><br>Adoption of interoperable protocols (e.g., <a href=\"https://en.wikipedia.org/wiki/OPC_Unified_Architecture\">OPC UA</a>, <a href=\"https://en.wikipedia.org/wiki/Transport_Layer_Security\">TLS</a>) to enhance portability and prevent vendor lock-in.</p>\n<p><strong>4. Operational Autonomy</strong><br>Buyers must retain full control over system maintenance and not be dependent on vendor-exclusive services or restricted from deploying their security tools.</p>\n<p><strong>5. Data Protection</strong><br>Ensure the confidentiality and integrity of engineering logic, configuration files, and operational data to prevent theft or tampering.</p>\n<p><strong>6. Secure by Default</strong><br>Devices should ship with hardened settings, <strong>disable default passwords and insecure services</strong>, and include all security features out of the box.</p>\n<p><strong>7. Secure Communications</strong><br>Must support certificate-based authentication and provide a <strong>simple deployment process</strong>, even for non-cybersecurity professionals.</p>\n<p><strong>8. Resilience Against Malicious Commands</strong><br>Capable of detecting and rejecting unauthorized or unexpected commands to prevent safety incidents or system disruption.</p>\n<p><strong>9. Strong Authentication</strong><br>Must support phishing-resistant <strong>Multi-Factor Authentication (MFA)</strong> and role-based access control to avoid shared credentials and identity abuse.</p>\n<p><strong>10. Threat Modeling Capability</strong><br>Vendors must provide up-to-date threat models and mitigation strategies to assist buyers in security risk assessments.</p>\n<p><strong>11. Vulnerability Management</strong><br>It should follow comprehensive CVE processes, support coordinated vulnerability disclosure (CVD), and include <strong>Software Bill of Materials (SBOM)</strong> — all while offering free security updates.</p>\n<p><strong>12. Upgrade and Patch Tooling</strong><br>Must support secure update verification, well-documented upgrade procedures, and <strong>seamless OS migration</strong> without additional cost.</p>\n<hr>\n<h2 id=\"Cultivating-a-Culture-of-Secure-Procurement-The-Buyer’s-Role\"><a href=\"#Cultivating-a-Culture-of-Secure-Procurement-The-Buyer’s-Role\" class=\"headerlink\" title=\"Cultivating a Culture of Secure Procurement: The Buyer’s Role\"></a>Cultivating a Culture of Secure Procurement: The Buyer’s Role</h2><blockquote>\n<p><strong>At the core of Secure by Demand is a powerful message: Buyers are the first line of defense in OT cybersecurity.</strong></p>\n</blockquote>\n<p>By demanding products that meet the above security priorities, buyers can:</p>\n<ul>\n<li><strong>Incentivize vendors</strong> to integrate cybersecurity into product design</li>\n<li><strong>Avoid high costs</strong> associated with late-stage remediation</li>\n<li><strong>Proactively address compliance</strong> with emerging regulations like the EU’s <a href=\"https://digital-strategy.ec.europa.eu/en/policies/nis2-directive\">NIS2</a> and <a href=\"https://digital-strategy.ec.europa.eu/en/policies/cyber-resilience-act\">Cyber Resilience Act</a></li>\n</ul>\n<p>At the same time, this approach facilitates the <strong>gradual replacement of aging, hard-to-update systems</strong>, paving the way for sustainable digital transformation.</p>\n<hr>\n<h2 id=\"Practical-Tips-for-Secure-Procurement\"><a href=\"#Practical-Tips-for-Secure-Procurement\" class=\"headerlink\" title=\"Practical Tips for Secure Procurement\"></a>Practical Tips for Secure Procurement</h2><ul>\n<li>Explicitly define security features and certification standards (e.g.,<a href=\"https://www.isa.org/standards-and-publications/isa-standards/isa-iec-62443-series-of-standards\"> ISA&#x2F;IEC 62443</a>) in procurement documents</li>\n<li>Evaluate whether vendors provide <strong>free vulnerability remediation</strong> and long-term security support</li>\n<li>Require <strong>threat models, SBOMs, and secure design documentation</strong> as part of vendor deliverables</li>\n<li>Prioritize products that support <strong>MFA, zero-trust architecture</strong>, and <strong>open standards</strong></li>\n</ul>\n<hr>\n<h2 id=\"Conclusion-Cybersecurity-is-Not-Just-a-Technical-Concern-It’s-a-Procurement-Decision\"><a href=\"#Conclusion-Cybersecurity-is-Not-Just-a-Technical-Concern-It’s-a-Procurement-Decision\" class=\"headerlink\" title=\"Conclusion: Cybersecurity is Not Just a Technical Concern - It’s a Procurement Decision\"></a>Conclusion: Cybersecurity is Not Just a Technical Concern - It’s a Procurement Decision</h2><p><strong>Secure by Demand</strong> reinforces a critical truth:</p>\n<blockquote>\n<p><strong>If security is not built-in by default, the ultimate cost will be much higher.</strong></p>\n</blockquote>\n<p>For OT asset owners, procurement marks the beginning of the security journey.</p>\n<p>For vendors, embedding security into products is no longer optional—it’s a competitive differentiator.</p>\n"},{"title":"Secure by Demand：以採購驅動 OT 系統安全轉型","date":"2025-03-26T14:00:00.000Z","cover_image":"https://kevinchiu923.github.io/post/Secure-by-Demand%EF%BC%9A%E4%BB%A5%E6%8E%A1%E8%B3%BC%E9%A9%85%E5%8B%95-OT-%E7%B3%BB%E7%B5%B1%E5%AE%89%E5%85%A8%E8%BD%89%E5%9E%8B/cover_img.jpeg","_content":"\n![](Secure-by-Demand：以採購驅動-OT-系統安全轉型/cover_img.jpeg)\n<center>Source: Cybersecurity and Infrastructure Security Agency</center>\n\n\n在現今工業控制系統（ICS）與營運技術（OT）面臨日益嚴峻的網路威脅下，CISA、NSA、FBI 協同多國政府單位於 2025/1/13 聯合發布《[Secure by Demand - 營運技術所有者和營運商選擇數位產品時的優先考慮事項](https://www.cisa.gov/resources-tools/resources/secure-demand-priority-considerations-operational-technology-owners-and-operators-when-selecting)》指南，提供 OT 系統採購者一套以資安為主軸的產品選購優先事項，藉此推動供應鏈從「***Secure by Design***」邁向「***Secure by Default***」。\n\n---\n\n## 為什麼 OT 安全必須「從採購開始」？\n傳統 OT 系統長期以可用性與穩定性為優先，導致資安設計被犧牲。如今攻擊者不再針對單一企業，而是鎖定共通的 OT 弱點 (諸如弱密碼、預設憑證、不安全協定與缺乏日誌機制......等)，一但駭客進行攻擊即會造成大規模淪陷。\n\n> **Secure by Demand 轉變思維：不再仰賴買家後期彌補資安漏洞，而是從產品選型階段，要求供應商預設具備資安防護機制。**\n\n---\n\n## 12 項 OT 產品安全選購重點\n1. **組態管理（Configuration Management）**：須具備變更記錄、授權驗證與安全備份機制，防止惡意配置被持久化。\n\n2. **基線日誌支援（Baseline Logging Support）**：預設支援記錄登入、組態變更、異常等事件，並使用開放標準格式。\n\n3. **開放標準支援（Open Standards Compliance）**：採用通用協定（如 [OPC UA](https://en.wikipedia.org/wiki/OPC_Unified_Architecture)、[TLS](https://en.wikipedia.org/wiki/Transport_Layer_Security)）提升可移植性與相容性，避免綁定單一廠商。\n\n4. **操作自主權（Operational Autonomy）**：買方應可獨立維護系統，不應被強制綁定供應商的專屬服務或限制安全工具安裝。\n\n5. **資料保護（Data Protection）**：保護工程邏輯、組態與操作數據的機密性與完整性，避免被竊取或偽造。\n\n6. **預設安全設定（Secure by Default）**：設備出廠即封鎖不安全服務、停用預設密碼並預載強化設定。\n\n7. **安全通訊（Secure Communications）**：支援憑證驗證，並簡化部署流程，使非資安專家亦可完成加密連線設定。\n\n8. **安全控制指令處理（Resilience Against Malicious Commands）**：具備辨識惡意或非預期指令的能力，避免被用於觸發故障或安全事件。\n\n9. **強化身份驗證（Strong Authentication）**：採用 [MFA](https://en.wikipedia.org/wiki/Multi-factor_authentication)、多層權限管理，避免共用帳號與釣魚攻擊。\n\n10. **威脅建模能力（Threat Modeling Capability）**：製造商需提供詳細威脅模型與對應防禦機制，協助買方風險評估。\n\n11. **弱點管理（Vulnerability Management）**：具備完整 CVE 處理流程、漏洞揭露政策與 SBOM（軟體物料清單），並免費提供安全更新。\n\n12. **更新與修補機制（Upgrade and Patch Tooling）**：提供自動驗證更新、相關文件完善的升級流程、並支援無縫移轉至新作業系統。\n\n---\n\n## 建立安全採購文化：買方的角色轉變\n> **Secure by Demand 的關鍵在於：買方成為 OT 安全的第一道關卡。**\n\n透過要求上述安全特徵，買方可：\n- **驅動廠商強化產品資安設計**\n- **避免後期補救導致高昂成本**\n- **提前因應歐盟 [NIS2](https://digital-strategy.ec.europa.eu/en/policies/nis2-directive)、[Cyber Resilience Act](https://digital-strategy.ec.europa.eu/en/policies/cyber-resilience-act) 等合規要求**\n\n同時，也能逐步汰換使用壽命長、難以更新的老舊設備，為數位轉型鋪路。\n\n---\n\n## 建議採購流程實踐要點\n- 在招標文件中明確要求安全功能與驗證標準（如 [ISA/IEC 62443](https://www.isa.org/standards-and-publications/isa-standards/isa-iec-62443-series-of-standards)）\n- 評估供應商是否提供免費的漏洞修補與資安支援週期\n- 要求提供產品威脅模型、SBOM、安全設計白皮書\n- 優先選用支援 MFA、零信任架構、開放標準的產品\n\n---\n\n## 結語：資安，不只是技術問題，更是採購決策\n>**Secure by Demand 強調：若安全不是預設，最終將付出更高代價。**\n\n對 OT 業主而言，採購就是防線起點；對廠商而言，產品內建資安就是未來競爭力的關鍵。","source":"_posts/Secure-by-Demand：以採購驅動-OT-系統安全轉型.md","raw":"---\ntitle: >-\n  Secure by Demand：以採購驅動 OT 系統安全轉型\ndate: 2025-03-26 22:00:00\ntags:\n  - Traditional Chinese\n  - 運營技術\n  - 關鍵基礎設施安全與韌性\n  - 網路安全最佳實踐\ncategories:\n  - Knowledge base\ncover_image: 'https://kevinchiu923.github.io/post/Secure-by-Demand%EF%BC%9A%E4%BB%A5%E6%8E%A1%E8%B3%BC%E9%A9%85%E5%8B%95-OT-%E7%B3%BB%E7%B5%B1%E5%AE%89%E5%85%A8%E8%BD%89%E5%9E%8B/cover_img.jpeg'\n---\n\n![](Secure-by-Demand：以採購驅動-OT-系統安全轉型/cover_img.jpeg)\n<center>Source: Cybersecurity and Infrastructure Security Agency</center>\n\n\n在現今工業控制系統（ICS）與營運技術（OT）面臨日益嚴峻的網路威脅下，CISA、NSA、FBI 協同多國政府單位於 2025/1/13 聯合發布《[Secure by Demand - 營運技術所有者和營運商選擇數位產品時的優先考慮事項](https://www.cisa.gov/resources-tools/resources/secure-demand-priority-considerations-operational-technology-owners-and-operators-when-selecting)》指南，提供 OT 系統採購者一套以資安為主軸的產品選購優先事項，藉此推動供應鏈從「***Secure by Design***」邁向「***Secure by Default***」。\n\n---\n\n## 為什麼 OT 安全必須「從採購開始」？\n傳統 OT 系統長期以可用性與穩定性為優先，導致資安設計被犧牲。如今攻擊者不再針對單一企業，而是鎖定共通的 OT 弱點 (諸如弱密碼、預設憑證、不安全協定與缺乏日誌機制......等)，一但駭客進行攻擊即會造成大規模淪陷。\n\n> **Secure by Demand 轉變思維：不再仰賴買家後期彌補資安漏洞，而是從產品選型階段，要求供應商預設具備資安防護機制。**\n\n---\n\n## 12 項 OT 產品安全選購重點\n1. **組態管理（Configuration Management）**：須具備變更記錄、授權驗證與安全備份機制，防止惡意配置被持久化。\n\n2. **基線日誌支援（Baseline Logging Support）**：預設支援記錄登入、組態變更、異常等事件，並使用開放標準格式。\n\n3. **開放標準支援（Open Standards Compliance）**：採用通用協定（如 [OPC UA](https://en.wikipedia.org/wiki/OPC_Unified_Architecture)、[TLS](https://en.wikipedia.org/wiki/Transport_Layer_Security)）提升可移植性與相容性，避免綁定單一廠商。\n\n4. **操作自主權（Operational Autonomy）**：買方應可獨立維護系統，不應被強制綁定供應商的專屬服務或限制安全工具安裝。\n\n5. **資料保護（Data Protection）**：保護工程邏輯、組態與操作數據的機密性與完整性，避免被竊取或偽造。\n\n6. **預設安全設定（Secure by Default）**：設備出廠即封鎖不安全服務、停用預設密碼並預載強化設定。\n\n7. **安全通訊（Secure Communications）**：支援憑證驗證，並簡化部署流程，使非資安專家亦可完成加密連線設定。\n\n8. **安全控制指令處理（Resilience Against Malicious Commands）**：具備辨識惡意或非預期指令的能力，避免被用於觸發故障或安全事件。\n\n9. **強化身份驗證（Strong Authentication）**：採用 [MFA](https://en.wikipedia.org/wiki/Multi-factor_authentication)、多層權限管理，避免共用帳號與釣魚攻擊。\n\n10. **威脅建模能力（Threat Modeling Capability）**：製造商需提供詳細威脅模型與對應防禦機制，協助買方風險評估。\n\n11. **弱點管理（Vulnerability Management）**：具備完整 CVE 處理流程、漏洞揭露政策與 SBOM（軟體物料清單），並免費提供安全更新。\n\n12. **更新與修補機制（Upgrade and Patch Tooling）**：提供自動驗證更新、相關文件完善的升級流程、並支援無縫移轉至新作業系統。\n\n---\n\n## 建立安全採購文化：買方的角色轉變\n> **Secure by Demand 的關鍵在於：買方成為 OT 安全的第一道關卡。**\n\n透過要求上述安全特徵，買方可：\n- **驅動廠商強化產品資安設計**\n- **避免後期補救導致高昂成本**\n- **提前因應歐盟 [NIS2](https://digital-strategy.ec.europa.eu/en/policies/nis2-directive)、[Cyber Resilience Act](https://digital-strategy.ec.europa.eu/en/policies/cyber-resilience-act) 等合規要求**\n\n同時，也能逐步汰換使用壽命長、難以更新的老舊設備，為數位轉型鋪路。\n\n---\n\n## 建議採購流程實踐要點\n- 在招標文件中明確要求安全功能與驗證標準（如 [ISA/IEC 62443](https://www.isa.org/standards-and-publications/isa-standards/isa-iec-62443-series-of-standards)）\n- 評估供應商是否提供免費的漏洞修補與資安支援週期\n- 要求提供產品威脅模型、SBOM、安全設計白皮書\n- 優先選用支援 MFA、零信任架構、開放標準的產品\n\n---\n\n## 結語：資安，不只是技術問題，更是採購決策\n>**Secure by Demand 強調：若安全不是預設，最終將付出更高代價。**\n\n對 OT 業主而言，採購就是防線起點；對廠商而言，產品內建資安就是未來競爭力的關鍵。","slug":"Secure-by-Demand：以採購驅動-OT-系統安全轉型","published":1,"updated":"2025-04-03T01:50:56.001Z","comments":1,"layout":"post","photos":[],"_id":"cm9agcuc40007nc827xhxapf3","content":"<p><img src=\"/post/Secure-by-Demand%EF%BC%9A%E4%BB%A5%E6%8E%A1%E8%B3%BC%E9%A9%85%E5%8B%95-OT-%E7%B3%BB%E7%B5%B1%E5%AE%89%E5%85%A8%E8%BD%89%E5%9E%8B/cover_img.jpeg\"></p>\n<center>Source: Cybersecurity and Infrastructure Security Agency</center>\n\n\n<p>在現今工業控制系統（ICS）與營運技術（OT）面臨日益嚴峻的網路威脅下，CISA、NSA、FBI 協同多國政府單位於 2025&#x2F;1&#x2F;13 聯合發布《<a href=\"https://www.cisa.gov/resources-tools/resources/secure-demand-priority-considerations-operational-technology-owners-and-operators-when-selecting\">Secure by Demand - 營運技術所有者和營運商選擇數位產品時的優先考慮事項</a>》指南，提供 OT 系統採購者一套以資安為主軸的產品選購優先事項，藉此推動供應鏈從「<em><strong>Secure by Design</strong></em>」邁向「<em><strong>Secure by Default</strong></em>」。</p>\n<hr>\n<h2 id=\"為什麼-OT-安全必須「從採購開始」？\"><a href=\"#為什麼-OT-安全必須「從採購開始」？\" class=\"headerlink\" title=\"為什麼 OT 安全必須「從採購開始」？\"></a>為什麼 OT 安全必須「從採購開始」？</h2><p>傳統 OT 系統長期以可用性與穩定性為優先，導致資安設計被犧牲。如今攻擊者不再針對單一企業，而是鎖定共通的 OT 弱點 (諸如弱密碼、預設憑證、不安全協定與缺乏日誌機制……等)，一但駭客進行攻擊即會造成大規模淪陷。</p>\n<blockquote>\n<p><strong>Secure by Demand 轉變思維：不再仰賴買家後期彌補資安漏洞，而是從產品選型階段，要求供應商預設具備資安防護機制。</strong></p>\n</blockquote>\n<hr>\n<h2 id=\"12-項-OT-產品安全選購重點\"><a href=\"#12-項-OT-產品安全選購重點\" class=\"headerlink\" title=\"12 項 OT 產品安全選購重點\"></a>12 項 OT 產品安全選購重點</h2><ol>\n<li><p><strong>組態管理（Configuration Management）</strong>：須具備變更記錄、授權驗證與安全備份機制，防止惡意配置被持久化。</p>\n</li>\n<li><p><strong>基線日誌支援（Baseline Logging Support）</strong>：預設支援記錄登入、組態變更、異常等事件，並使用開放標準格式。</p>\n</li>\n<li><p><strong>開放標準支援（Open Standards Compliance）</strong>：採用通用協定（如 <a href=\"https://en.wikipedia.org/wiki/OPC_Unified_Architecture\">OPC UA</a>、<a href=\"https://en.wikipedia.org/wiki/Transport_Layer_Security\">TLS</a>）提升可移植性與相容性，避免綁定單一廠商。</p>\n</li>\n<li><p><strong>操作自主權（Operational Autonomy）</strong>：買方應可獨立維護系統，不應被強制綁定供應商的專屬服務或限制安全工具安裝。</p>\n</li>\n<li><p><strong>資料保護（Data Protection）</strong>：保護工程邏輯、組態與操作數據的機密性與完整性，避免被竊取或偽造。</p>\n</li>\n<li><p><strong>預設安全設定（Secure by Default）</strong>：設備出廠即封鎖不安全服務、停用預設密碼並預載強化設定。</p>\n</li>\n<li><p><strong>安全通訊（Secure Communications）</strong>：支援憑證驗證，並簡化部署流程，使非資安專家亦可完成加密連線設定。</p>\n</li>\n<li><p><strong>安全控制指令處理（Resilience Against Malicious Commands）</strong>：具備辨識惡意或非預期指令的能力，避免被用於觸發故障或安全事件。</p>\n</li>\n<li><p><strong>強化身份驗證（Strong Authentication）</strong>：採用 <a href=\"https://en.wikipedia.org/wiki/Multi-factor_authentication\">MFA</a>、多層權限管理，避免共用帳號與釣魚攻擊。</p>\n</li>\n<li><p><strong>威脅建模能力（Threat Modeling Capability）</strong>：製造商需提供詳細威脅模型與對應防禦機制，協助買方風險評估。</p>\n</li>\n<li><p><strong>弱點管理（Vulnerability Management）</strong>：具備完整 CVE 處理流程、漏洞揭露政策與 SBOM（軟體物料清單），並免費提供安全更新。</p>\n</li>\n<li><p><strong>更新與修補機制（Upgrade and Patch Tooling）</strong>：提供自動驗證更新、相關文件完善的升級流程、並支援無縫移轉至新作業系統。</p>\n</li>\n</ol>\n<hr>\n<h2 id=\"建立安全採購文化：買方的角色轉變\"><a href=\"#建立安全採購文化：買方的角色轉變\" class=\"headerlink\" title=\"建立安全採購文化：買方的角色轉變\"></a>建立安全採購文化：買方的角色轉變</h2><blockquote>\n<p><strong>Secure by Demand 的關鍵在於：買方成為 OT 安全的第一道關卡。</strong></p>\n</blockquote>\n<p>透過要求上述安全特徵，買方可：</p>\n<ul>\n<li><strong>驅動廠商強化產品資安設計</strong></li>\n<li><strong>避免後期補救導致高昂成本</strong></li>\n<li><strong>提前因應歐盟 <a href=\"https://digital-strategy.ec.europa.eu/en/policies/nis2-directive\">NIS2</a>、<a href=\"https://digital-strategy.ec.europa.eu/en/policies/cyber-resilience-act\">Cyber Resilience Act</a> 等合規要求</strong></li>\n</ul>\n<p>同時，也能逐步汰換使用壽命長、難以更新的老舊設備，為數位轉型鋪路。</p>\n<hr>\n<h2 id=\"建議採購流程實踐要點\"><a href=\"#建議採購流程實踐要點\" class=\"headerlink\" title=\"建議採購流程實踐要點\"></a>建議採購流程實踐要點</h2><ul>\n<li>在招標文件中明確要求安全功能與驗證標準（如 <a href=\"https://www.isa.org/standards-and-publications/isa-standards/isa-iec-62443-series-of-standards\">ISA&#x2F;IEC 62443</a>）</li>\n<li>評估供應商是否提供免費的漏洞修補與資安支援週期</li>\n<li>要求提供產品威脅模型、SBOM、安全設計白皮書</li>\n<li>優先選用支援 MFA、零信任架構、開放標準的產品</li>\n</ul>\n<hr>\n<h2 id=\"結語：資安，不只是技術問題，更是採購決策\"><a href=\"#結語：資安，不只是技術問題，更是採購決策\" class=\"headerlink\" title=\"結語：資安，不只是技術問題，更是採購決策\"></a>結語：資安，不只是技術問題，更是採購決策</h2><blockquote>\n<p><strong>Secure by Demand 強調：若安全不是預設，最終將付出更高代價。</strong></p>\n</blockquote>\n<p>對 OT 業主而言，採購就是防線起點；對廠商而言，產品內建資安就是未來競爭力的關鍵。</p>\n","excerpt":"","more":"<p><img src=\"/post/Secure-by-Demand%EF%BC%9A%E4%BB%A5%E6%8E%A1%E8%B3%BC%E9%A9%85%E5%8B%95-OT-%E7%B3%BB%E7%B5%B1%E5%AE%89%E5%85%A8%E8%BD%89%E5%9E%8B/cover_img.jpeg\"></p>\n<center>Source: Cybersecurity and Infrastructure Security Agency</center>\n\n\n<p>在現今工業控制系統（ICS）與營運技術（OT）面臨日益嚴峻的網路威脅下，CISA、NSA、FBI 協同多國政府單位於 2025&#x2F;1&#x2F;13 聯合發布《<a href=\"https://www.cisa.gov/resources-tools/resources/secure-demand-priority-considerations-operational-technology-owners-and-operators-when-selecting\">Secure by Demand - 營運技術所有者和營運商選擇數位產品時的優先考慮事項</a>》指南，提供 OT 系統採購者一套以資安為主軸的產品選購優先事項，藉此推動供應鏈從「<em><strong>Secure by Design</strong></em>」邁向「<em><strong>Secure by Default</strong></em>」。</p>\n<hr>\n<h2 id=\"為什麼-OT-安全必須「從採購開始」？\"><a href=\"#為什麼-OT-安全必須「從採購開始」？\" class=\"headerlink\" title=\"為什麼 OT 安全必須「從採購開始」？\"></a>為什麼 OT 安全必須「從採購開始」？</h2><p>傳統 OT 系統長期以可用性與穩定性為優先，導致資安設計被犧牲。如今攻擊者不再針對單一企業，而是鎖定共通的 OT 弱點 (諸如弱密碼、預設憑證、不安全協定與缺乏日誌機制……等)，一但駭客進行攻擊即會造成大規模淪陷。</p>\n<blockquote>\n<p><strong>Secure by Demand 轉變思維：不再仰賴買家後期彌補資安漏洞，而是從產品選型階段，要求供應商預設具備資安防護機制。</strong></p>\n</blockquote>\n<hr>\n<h2 id=\"12-項-OT-產品安全選購重點\"><a href=\"#12-項-OT-產品安全選購重點\" class=\"headerlink\" title=\"12 項 OT 產品安全選購重點\"></a>12 項 OT 產品安全選購重點</h2><ol>\n<li><p><strong>組態管理（Configuration Management）</strong>：須具備變更記錄、授權驗證與安全備份機制，防止惡意配置被持久化。</p>\n</li>\n<li><p><strong>基線日誌支援（Baseline Logging Support）</strong>：預設支援記錄登入、組態變更、異常等事件，並使用開放標準格式。</p>\n</li>\n<li><p><strong>開放標準支援（Open Standards Compliance）</strong>：採用通用協定（如 <a href=\"https://en.wikipedia.org/wiki/OPC_Unified_Architecture\">OPC UA</a>、<a href=\"https://en.wikipedia.org/wiki/Transport_Layer_Security\">TLS</a>）提升可移植性與相容性，避免綁定單一廠商。</p>\n</li>\n<li><p><strong>操作自主權（Operational Autonomy）</strong>：買方應可獨立維護系統，不應被強制綁定供應商的專屬服務或限制安全工具安裝。</p>\n</li>\n<li><p><strong>資料保護（Data Protection）</strong>：保護工程邏輯、組態與操作數據的機密性與完整性，避免被竊取或偽造。</p>\n</li>\n<li><p><strong>預設安全設定（Secure by Default）</strong>：設備出廠即封鎖不安全服務、停用預設密碼並預載強化設定。</p>\n</li>\n<li><p><strong>安全通訊（Secure Communications）</strong>：支援憑證驗證，並簡化部署流程，使非資安專家亦可完成加密連線設定。</p>\n</li>\n<li><p><strong>安全控制指令處理（Resilience Against Malicious Commands）</strong>：具備辨識惡意或非預期指令的能力，避免被用於觸發故障或安全事件。</p>\n</li>\n<li><p><strong>強化身份驗證（Strong Authentication）</strong>：採用 <a href=\"https://en.wikipedia.org/wiki/Multi-factor_authentication\">MFA</a>、多層權限管理，避免共用帳號與釣魚攻擊。</p>\n</li>\n<li><p><strong>威脅建模能力（Threat Modeling Capability）</strong>：製造商需提供詳細威脅模型與對應防禦機制，協助買方風險評估。</p>\n</li>\n<li><p><strong>弱點管理（Vulnerability Management）</strong>：具備完整 CVE 處理流程、漏洞揭露政策與 SBOM（軟體物料清單），並免費提供安全更新。</p>\n</li>\n<li><p><strong>更新與修補機制（Upgrade and Patch Tooling）</strong>：提供自動驗證更新、相關文件完善的升級流程、並支援無縫移轉至新作業系統。</p>\n</li>\n</ol>\n<hr>\n<h2 id=\"建立安全採購文化：買方的角色轉變\"><a href=\"#建立安全採購文化：買方的角色轉變\" class=\"headerlink\" title=\"建立安全採購文化：買方的角色轉變\"></a>建立安全採購文化：買方的角色轉變</h2><blockquote>\n<p><strong>Secure by Demand 的關鍵在於：買方成為 OT 安全的第一道關卡。</strong></p>\n</blockquote>\n<p>透過要求上述安全特徵，買方可：</p>\n<ul>\n<li><strong>驅動廠商強化產品資安設計</strong></li>\n<li><strong>避免後期補救導致高昂成本</strong></li>\n<li><strong>提前因應歐盟 <a href=\"https://digital-strategy.ec.europa.eu/en/policies/nis2-directive\">NIS2</a>、<a href=\"https://digital-strategy.ec.europa.eu/en/policies/cyber-resilience-act\">Cyber Resilience Act</a> 等合規要求</strong></li>\n</ul>\n<p>同時，也能逐步汰換使用壽命長、難以更新的老舊設備，為數位轉型鋪路。</p>\n<hr>\n<h2 id=\"建議採購流程實踐要點\"><a href=\"#建議採購流程實踐要點\" class=\"headerlink\" title=\"建議採購流程實踐要點\"></a>建議採購流程實踐要點</h2><ul>\n<li>在招標文件中明確要求安全功能與驗證標準（如 <a href=\"https://www.isa.org/standards-and-publications/isa-standards/isa-iec-62443-series-of-standards\">ISA&#x2F;IEC 62443</a>）</li>\n<li>評估供應商是否提供免費的漏洞修補與資安支援週期</li>\n<li>要求提供產品威脅模型、SBOM、安全設計白皮書</li>\n<li>優先選用支援 MFA、零信任架構、開放標準的產品</li>\n</ul>\n<hr>\n<h2 id=\"結語：資安，不只是技術問題，更是採購決策\"><a href=\"#結語：資安，不只是技術問題，更是採購決策\" class=\"headerlink\" title=\"結語：資安，不只是技術問題，更是採購決策\"></a>結語：資安，不只是技術問題，更是採購決策</h2><blockquote>\n<p><strong>Secure by Demand 強調：若安全不是預設，最終將付出更高代價。</strong></p>\n</blockquote>\n<p>對 OT 業主而言，採購就是防線起點；對廠商而言，產品內建資安就是未來競爭力的關鍵。</p>\n"},{"title":"The Hidden Power of Shim: How Windows and Linux Use It—and Why You Should Care","date":"2025-04-10T12:10:00.000Z","cover_image":"https://kevinchiu923.github.io/post/The-Hidden-Power-of-Shim-How-Windows-and-Linux-Use-It—and-Why-You-Should-Care/en_cover_img.png","_content":"Shim is a critical middleware component used in operating systems. Through API interception or signature verification, it provides both application compatibility and Secure Boot integrity. However, it can also serve as an attack surface for threat actors. This article focuses on the design, implementation, potential security risks, and defense strategies related to Shim.\n\n## Introduction: What is a Shim?\n\nIn computing, a *Shim* acts as an intermediary layer that bridges the gap between two incompatible system components. Much like a [gasket](https://www.tfhc-oilseal.com/Gasketseal/%E5%BB%B6%E9%95%B7%E8%A8%AD%E5%82%99%E5%A3%BD%E5%91%BD,%E5%A2%9E%E5%8A%A0%E7%94%A2%E8%83%BD%E7%9A%84%E9%97%9C%E9%8D%B5%E9%9B%B6%E7%B5%84%E4%BB%B6-%E7%A9%BA%E5%A3%93%E6%B2%B9%E5%B0%81%E5%A2%8A%E7%89%87/) in mechanical engineering, a shim fills in the space or mismatch, enabling smooth interaction.\n\nIn computer systems, shims vary in form but share the core goal of *modifying or intercepting native behavior to enable compatibility or enforce security*. This article explores Shim implementations in two major OS platforms:\n\n- **Windows - Application Shim**: Primarily for resolving legacy software compatibility.\n- **Linux - Secure Boot Shim (UEFI environments)**: Serves as the foundational trust anchor in the Secure Boot chain.\n\n\n## Comparing Shims in Windows vs. Linux\n\n| Aspect | Windows Application Shim | Linux Secure Boot Shim |\n|--------|---------------------------|-------------------------|\n| **Primary Use** | Compatibility for legacy apps | Trust anchor for Secure Boot |\n| **Runtime Context** | User-mode | Early UEFI boot phase |\n| **Main Function** | API interception, behavior modification | Digital signature verification (GRUB, Kernel) |\n| **Installation** | `.sdb` database, tool-assisted | Signed loader (distro-shipped, Microsoft-signed) |\n| **Security Risks** | Shim Injection | Vulnerable outdated shim bypassing Secure Boot |\n| **Common Use Case** | Internal legacy systems, old games | Dual-boot systems, cloud Linux images |\n\n## Windows: Implementing Application Compatibility Shims and Security Implications\n\n### 1. Use Cases & Purpose\nWindows Shims are designed to resolve compatibility issues that arise when older applications are run on newer OS versions. By intercepting API calls, the shim can masquerade version behavior or adjust logic, tricking the app into \"believing\" it's still in a legacy environment.\n\n### 2. Core Mechanism\n\n- **Shim Database ( `.sdb` )**: Maps applications to associated fixes.\n- **Shim Engine**: Injects DLLs and intercepts runtime APIs.\n- **Compatibility Administrator**: GUI tool for customizing and deploying shim fixes.\n\n### 3. Example Command to Install a Shim\n\n```bash\n# After creating the `.sdb` file using the Compatibility Administrator tool\nsdbinst.exe C:\\path\\to\\custom_shim.sdb\n```\n\n### 4. Querying Installed Shim Databases\n\n**For Older Versions of Windows:**\nIf you’re using an older version of Windows (e.g., Windows 7 or 8), you can check for installed custom .sdb (Shim Database) files using the following PowerShell command, as documented in earlier technical references (Ref. [1][2]):\n\n```bash\nreg query \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\InstalledSDB\"\n```\n\n**For Newer Versions of Windows:**\nOn more recent versions of Windows (e.g., Windows 10 or 11), the above registry path may not exist or may return nothing. This is because while the `AppCompat` database still exists, its entries are no longer guaranteed to appear under the `InstalledSDB` key. Instead, related Shim information may be spread across other registry locations.\n\nYou can use the following PowerShell commands to check for relevant Shim behaviors:\n- List custom shims applied to specific executable paths:\n    ```bash\n    reg query \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Custom\"\n    ```\n\n- List user-defined compatibility layers, such as those set via “Run in compatibility mode” from the right-click menu:\n    ```bash\n    reg query \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Layers\"\n    ```\n\n**Why Might the InstalledSDB Key Be Missing?**\nThere are several possible reasons why the InstalledSDB key is not found in newer versions of Windows:\n1. Not all .sdb installations are recorded under InstalledSDB.\n2. Some Windows editions no longer create this registry key by default.\n3. Microsoft has shifted its approach to managing shims, increasingly favoring stricter application control mechanisms such as [WDAC (Windows Defender Application Control)](https://learn.microsoft.com/en-us/hololens/windows-defender-application-control-wdac) and [AppLocker](https://learn.microsoft.com/en-us/windows/security/application-security/application-control/app-control-for-business/applocker/what-is-applocker).\n\n### 5. Common Shim Examples\n\n- `VersionLie`: Fakes Windows version\n- `ForceAdminAccess`: Tricks apps into thinking user is Admin\n- `CorrectFilePaths`: Redirects paths to compatible locations\n\n### 6. Security Risk - Shim Injection\n\nAttackers can craft `.sdb` files and use `sdbinst.exe` to silently install malicious shims. When the target application runs, the shim injects malicious logic. Notably, the APT group [FIN7](https://malpedia.caad.fkie.fraunhofer.de/actor/fin7) has used this technique for persistent access. (Ref.[3])\n\n\n## Linux: Shim's Role in Secure Boot\n\n### 1. Secure Boot Overview\n\nUEFI Secure Boot ensures only signed binaries are executed during boot. Firmware trusts binaries signed by Microsoft’s UEFI CA.\n\n### 2. Why Linux Needs Shim\n\nShim allows distributions to sign and manage their own GRUB/kernel updates without requiring direct Microsoft signature for every update.\nShim itself is Microsoft-signed, while embedded public keys inside shim verify GRUB and Linux kernel.\n\n### 3. Boot Process Flow: The Shim Three-Stage Trust Chain\nThe three-stage trust chain is a core architecture used in Linux systems under UEFI Secure Boot to ensure a secure and tamper-resistant boot process.\n\nIts primary goal is to guarantee that every executable component involved in the boot sequence—from UEFI firmware to GRUB and ultimately to the Linux kernel—is cryptographically verified and trusted, ensuring integrity and authenticity throughout the chain.\n\nThis trust chain consists of four critical components in sequence: Firmware, Shim, GRUB, and the Kernel. Each stage is signed and verified by a distinct trusted authority:\n- Firmware is typically provided and signed by the hardware vendor.\n- Shim is developed by the Linux distribution and signed by Microsoft to gain acceptance by the UEFI firmware.\n- GRUB and the Kernel are signed by the distribution itself and are verified by Shim using embedded public keys or through the MOK (Machine Owner Key) mechanism.\n\nTogether, these components form a complete and auditable trust path, ensuring that only validated binaries are executed during system boot.\n\n![](https://kevinchiu923.github.io/post/The-Hidden-Power-of-Shim-How-Windows-and-Linux-Use-It—and-Why-You-Should-Care/Three-stage-Trust-Chain.jpeg)\n\n**Detailed Flow:**\n**Step 1: Firmware → Shim (Signed by Microsoft)**\n| Item |Description |\n| -------- | -------- |\n| Boot Source|UEFI firmware    |\n| Target     | shimx64.efi (provided by the Linux distribution, signed by Microsoft)     |\n| Verification     | Verified via Microsoft UEFI CA signature |\n| Purpose    | Enables non-Microsoft bootloaders (e.g., GRUB) to load under Secure Boot     |\n\n**Step 2: Shim → GRUB (or Other Bootloaders, Signed by Distro)**\n| Item |Description |\n| -------- | -------- |\n| Boot Source     | shimx64.efi     |\n| Target     | grubx64.efi (signed by the Linux distribution)     |\n| Verification     | Verified using an embedded public key in Shim, or via the MOK (Machine Owner Key) system |\n| Purpose     | Loads the next-stage bootloader (e.g., GRUB) and establishes the next trust link     |\n\n**Step 3: GRUB → Kernel (Using Shim’s Verification Capabilities)**\n| Item |Description |\n| -------- | -------- |\n| Boot Source     | GRUB     |\n| Target     | vmlinuz (Linux kernel image)     |\n| Verification     | Verified using the signature checking modules from Shim or GRUB |\n| Purpose     |Ensures that the kernel being booted is cryptographically validated  |\n\nThese three stages are jointly managed by Microsoft, the Linux distribution, and the system owner, forming a **complete and layered trust architecture based on tiered signing and staged verification**.\n\n\n### 4. Managing Custom Keys: MOK (Machine Owner Key)\n\nMOK (Machine Owner Key) allows users to manually enroll custom signing keys, which can then be used to validate third-party drivers or custom-compiled Linux kernels.\nOnce enrolled, the corresponding public key is stored in [NVRAM (non-volatile memory)](https://en.wikipedia.org/wiki/Non-volatile_memory) and becomes part of the Secure Boot validation process, handled by [MokManager](https://github.com/hakuna-m/wubiuefi/wiki/MOKManager) during system startup.\nExample: Importing a MOK on Ubuntu\n\n```bash\nsudo mokutil --import my_key_pub.der\n# The system will prompt you to set a password. After a reboot, you’ll be guided through the MokManager interface to complete the key enrollment process.\n```\n\n### 5. Security Retrospective: BootHole and the Birth of SBAT\n\nThe disclosure of the **[BootHole vulnerability (CVE-2020-10713)](https://nvd.nist.gov/vuln/detail/cve-2020-10713)** in 2020 marked a turning point for the UEFI Secure Boot ecosystem.\nThis flaw existed in the configuration parsing logic of the GRUB2 bootloader, where an attacker could tamper with grub.cfg to inject malicious code. Alarmingly, this could occur even with Secure Boot enabled, effectively bypassing the signature verification process and executing unsigned binaries.\n\nThis incident exposed a critical single point of failure within the Secure Boot trust chain and highlighted the limitations of the traditional revocation approach (such as Microsoft’s dbx blacklist), where revoking a single vulnerable binary could inadvertently disrupt all systems using that version.\n\nTo address these systemic risks, the Linux community—in collaboration with UEFI stakeholders such as Canonical, Red Hat, and others—developed a new mechanism called **[SBAT (Secure Boot Advanced Targeting)](https://www.gnu.org/software/grub/manual/grub/html_node/Secure-Boot-Advanced-Targeting.html)**.\n\nSBAT introduces a more granular and version-aware revocation model, enabling Secure Boot to selectively block specific versions of vulnerable boot components—such as particular builds of shim, GRUB, or the Linux kernel—without impacting safe versions. This significantly improves the flexibility and maintainability of Secure Boot over time.\n\n\n## Conclusion: Shim as a Double-Edged Sword\nShim plays a bridging role in modern operating systems:\n- In Windows, it extends the lifecycle of legacy applications by ensuring compatibility.\n- In Linux, it upholds the integrity and continuity of the Secure Boot trust chain.\n\nOnly by thoroughly understanding how Shim works can organizations fully leverage its advantages—while proactively mitigating the potential security risks it may introduce.\n\n### Why Is Shim Considered a Double-Edged Sword?\n#### Pros:\n - **Maintains Compatibility and Flexibility:**\nShim offers significant flexibility and operational convenience, allowing legacy applications or custom drivers to continue running in modern environments. This reduces both maintenance overhead and the cost of system upgrades.\n\n#### Cons:\n- **Potential Security Risks:**\nThe same mechanisms that offer flexibility can also be exploited as attack vectors. For example, malicious actors may leverage Shim Injection in Windows or exploit outdated shims in Linux to bypass security controls.\n- **Single Point of Failure in the Trust Chain:**\nIn Secure Boot environments, Shim serves as the root of trust. If Shim itself is compromised—either by a vulnerability or unauthorized replacement—the entire trust chain may be invalidated.\n- **High Maintenance and Revocation Complexity:**\nOnce widely deployed, updating or revoking Shim (e.g., via SBAT) can be operationally challenging. Improper updates may even prevent systems from booting, increasing the risk and complexity of incident response.\n\n### Mitigation Strategies and Security Recommendations\nFor real-world deployment, organizations and developers are strongly encouraged to implement version control, enforce signature policies, and adopt centralized management solutions. Continuous monitoring of Shim and Secure Boot–related security advisories is essential to reduce potential attack surfaces.\nRecommended actions include:\n\n1. Maintain Compatibility with Controlled Flexibility\n    - Apply Shims only to essential legacy applications where no viable alternatives exist, avoiding unnecessary dependency across the system.\n    - Implement a robust change management and testing process (e.g., following [ISO/IEC 27001](https://www.iso.org/standard/27001), [NIST 800-53](https://csrc.nist.gov/pubs/sp/800/53/r5/upd1/final)), including risk assessment, functional validation, and version tracking for each Shim configuration to balance compatibility with security.\n    - Enforce application whitelisting policies using mechanisms such as [AppLocker](https://learn.microsoft.com/en-us/windows/security/application-security/application-control/app-control-for-business/applocker/what-is-applocker) or [WDAC](https://learn.microsoft.com/en-us/hololens/windows-defender-application-control-wdac) to restrict the execution of unauthorized programs.\n\n2. Address Potential Security Breaches\n    - Establish monitoring systems to detect suspicious behavior such as the execution of sdbinst.exe or unusual changes to Shim databases.\n\t- Restrict Shim installation privileges to system administrators and limit access to Shim-related tools at the user level.\n\t- Conduct regular audits of %WINDIR%\\AppPatch\\Custom\\ and relevant Shim-related registry paths to track unauthorized modifications.\n\n3. Mitigate Trust Chain Single Points of Failure\n    - Use only officially distributed Shim binaries signed by Microsoft to ensure integrity and trustworthiness.\n    - Deploy SBAT-compliant Shim versions, which allow for granular revocation and precise version management.\n    - Maintain up-to-date versions of Shim, GRUB, the Linux kernel, and UEFI firmware to reduce exposure to known vulnerabilities.\n\n4. Reduce Operational Overhead and Improve Revocation Response\n    - Utilize centralized management tools such as [Microsoft Intune](https://learn.microsoft.com/en-us/intune/intune-service/fundamentals/what-is-intune) or [Ansible](https://www.redhat.com/en/ansible-collaborative) to streamline deployment and monitor Shim usage across environments.\n\t- Design boot recovery strategies, including USB live images or dedicated recovery partitions, to ensure system bootability in case of Shim-related failures.\n\t- Maintain version history and SHA-256 checksum records to support validation and forensic investigation when needed.\n## References\n\n1. Black Hat EU 2015 Whitepaper - [Defending Against Malicious Application Compatibility Shims](https://www.blackhat.com/docs/eu-15/materials/eu-15-Pierce-Defending-Against-Malicious-Application-Compatibility-Shims-wp.pdf)\n2. F-Secure Blog Post - [Hunting for Application Shim Databases](https://blog.f-secure.com/hunting-for-application-shim-databases/)\n3. Google Cloud - [FIN7 Leveraging Shim Databases](https://cloud.google.com/blog/topics/threat-intelligence/fin7-shim-databases-persistence/)\n","source":"_posts/The-Hidden-Power-of-Shim-How-Windows-and-Linux-Use-It—and-Why-You-Should-Care.md","raw":"---\ntitle: 'The Hidden Power of Shim: How Windows and Linux Use It—and Why You Should Care'\ndate: 2025-04-10 20:10:00\ntags:\n  - English\n  - Windows\n  - Linux\n  - Cyber security\ncategories:\n  - Knowledge base\ncover_image: 'https://kevinchiu923.github.io/post/The-Hidden-Power-of-Shim-How-Windows-and-Linux-Use-It—and-Why-You-Should-Care/en_cover_img.png'\n---\nShim is a critical middleware component used in operating systems. Through API interception or signature verification, it provides both application compatibility and Secure Boot integrity. However, it can also serve as an attack surface for threat actors. This article focuses on the design, implementation, potential security risks, and defense strategies related to Shim.\n\n## Introduction: What is a Shim?\n\nIn computing, a *Shim* acts as an intermediary layer that bridges the gap between two incompatible system components. Much like a [gasket](https://www.tfhc-oilseal.com/Gasketseal/%E5%BB%B6%E9%95%B7%E8%A8%AD%E5%82%99%E5%A3%BD%E5%91%BD,%E5%A2%9E%E5%8A%A0%E7%94%A2%E8%83%BD%E7%9A%84%E9%97%9C%E9%8D%B5%E9%9B%B6%E7%B5%84%E4%BB%B6-%E7%A9%BA%E5%A3%93%E6%B2%B9%E5%B0%81%E5%A2%8A%E7%89%87/) in mechanical engineering, a shim fills in the space or mismatch, enabling smooth interaction.\n\nIn computer systems, shims vary in form but share the core goal of *modifying or intercepting native behavior to enable compatibility or enforce security*. This article explores Shim implementations in two major OS platforms:\n\n- **Windows - Application Shim**: Primarily for resolving legacy software compatibility.\n- **Linux - Secure Boot Shim (UEFI environments)**: Serves as the foundational trust anchor in the Secure Boot chain.\n\n\n## Comparing Shims in Windows vs. Linux\n\n| Aspect | Windows Application Shim | Linux Secure Boot Shim |\n|--------|---------------------------|-------------------------|\n| **Primary Use** | Compatibility for legacy apps | Trust anchor for Secure Boot |\n| **Runtime Context** | User-mode | Early UEFI boot phase |\n| **Main Function** | API interception, behavior modification | Digital signature verification (GRUB, Kernel) |\n| **Installation** | `.sdb` database, tool-assisted | Signed loader (distro-shipped, Microsoft-signed) |\n| **Security Risks** | Shim Injection | Vulnerable outdated shim bypassing Secure Boot |\n| **Common Use Case** | Internal legacy systems, old games | Dual-boot systems, cloud Linux images |\n\n## Windows: Implementing Application Compatibility Shims and Security Implications\n\n### 1. Use Cases & Purpose\nWindows Shims are designed to resolve compatibility issues that arise when older applications are run on newer OS versions. By intercepting API calls, the shim can masquerade version behavior or adjust logic, tricking the app into \"believing\" it's still in a legacy environment.\n\n### 2. Core Mechanism\n\n- **Shim Database ( `.sdb` )**: Maps applications to associated fixes.\n- **Shim Engine**: Injects DLLs and intercepts runtime APIs.\n- **Compatibility Administrator**: GUI tool for customizing and deploying shim fixes.\n\n### 3. Example Command to Install a Shim\n\n```bash\n# After creating the `.sdb` file using the Compatibility Administrator tool\nsdbinst.exe C:\\path\\to\\custom_shim.sdb\n```\n\n### 4. Querying Installed Shim Databases\n\n**For Older Versions of Windows:**\nIf you’re using an older version of Windows (e.g., Windows 7 or 8), you can check for installed custom .sdb (Shim Database) files using the following PowerShell command, as documented in earlier technical references (Ref. [1][2]):\n\n```bash\nreg query \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\InstalledSDB\"\n```\n\n**For Newer Versions of Windows:**\nOn more recent versions of Windows (e.g., Windows 10 or 11), the above registry path may not exist or may return nothing. This is because while the `AppCompat` database still exists, its entries are no longer guaranteed to appear under the `InstalledSDB` key. Instead, related Shim information may be spread across other registry locations.\n\nYou can use the following PowerShell commands to check for relevant Shim behaviors:\n- List custom shims applied to specific executable paths:\n    ```bash\n    reg query \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Custom\"\n    ```\n\n- List user-defined compatibility layers, such as those set via “Run in compatibility mode” from the right-click menu:\n    ```bash\n    reg query \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Layers\"\n    ```\n\n**Why Might the InstalledSDB Key Be Missing?**\nThere are several possible reasons why the InstalledSDB key is not found in newer versions of Windows:\n1. Not all .sdb installations are recorded under InstalledSDB.\n2. Some Windows editions no longer create this registry key by default.\n3. Microsoft has shifted its approach to managing shims, increasingly favoring stricter application control mechanisms such as [WDAC (Windows Defender Application Control)](https://learn.microsoft.com/en-us/hololens/windows-defender-application-control-wdac) and [AppLocker](https://learn.microsoft.com/en-us/windows/security/application-security/application-control/app-control-for-business/applocker/what-is-applocker).\n\n### 5. Common Shim Examples\n\n- `VersionLie`: Fakes Windows version\n- `ForceAdminAccess`: Tricks apps into thinking user is Admin\n- `CorrectFilePaths`: Redirects paths to compatible locations\n\n### 6. Security Risk - Shim Injection\n\nAttackers can craft `.sdb` files and use `sdbinst.exe` to silently install malicious shims. When the target application runs, the shim injects malicious logic. Notably, the APT group [FIN7](https://malpedia.caad.fkie.fraunhofer.de/actor/fin7) has used this technique for persistent access. (Ref.[3])\n\n\n## Linux: Shim's Role in Secure Boot\n\n### 1. Secure Boot Overview\n\nUEFI Secure Boot ensures only signed binaries are executed during boot. Firmware trusts binaries signed by Microsoft’s UEFI CA.\n\n### 2. Why Linux Needs Shim\n\nShim allows distributions to sign and manage their own GRUB/kernel updates without requiring direct Microsoft signature for every update.\nShim itself is Microsoft-signed, while embedded public keys inside shim verify GRUB and Linux kernel.\n\n### 3. Boot Process Flow: The Shim Three-Stage Trust Chain\nThe three-stage trust chain is a core architecture used in Linux systems under UEFI Secure Boot to ensure a secure and tamper-resistant boot process.\n\nIts primary goal is to guarantee that every executable component involved in the boot sequence—from UEFI firmware to GRUB and ultimately to the Linux kernel—is cryptographically verified and trusted, ensuring integrity and authenticity throughout the chain.\n\nThis trust chain consists of four critical components in sequence: Firmware, Shim, GRUB, and the Kernel. Each stage is signed and verified by a distinct trusted authority:\n- Firmware is typically provided and signed by the hardware vendor.\n- Shim is developed by the Linux distribution and signed by Microsoft to gain acceptance by the UEFI firmware.\n- GRUB and the Kernel are signed by the distribution itself and are verified by Shim using embedded public keys or through the MOK (Machine Owner Key) mechanism.\n\nTogether, these components form a complete and auditable trust path, ensuring that only validated binaries are executed during system boot.\n\n![](https://kevinchiu923.github.io/post/The-Hidden-Power-of-Shim-How-Windows-and-Linux-Use-It—and-Why-You-Should-Care/Three-stage-Trust-Chain.jpeg)\n\n**Detailed Flow:**\n**Step 1: Firmware → Shim (Signed by Microsoft)**\n| Item |Description |\n| -------- | -------- |\n| Boot Source|UEFI firmware    |\n| Target     | shimx64.efi (provided by the Linux distribution, signed by Microsoft)     |\n| Verification     | Verified via Microsoft UEFI CA signature |\n| Purpose    | Enables non-Microsoft bootloaders (e.g., GRUB) to load under Secure Boot     |\n\n**Step 2: Shim → GRUB (or Other Bootloaders, Signed by Distro)**\n| Item |Description |\n| -------- | -------- |\n| Boot Source     | shimx64.efi     |\n| Target     | grubx64.efi (signed by the Linux distribution)     |\n| Verification     | Verified using an embedded public key in Shim, or via the MOK (Machine Owner Key) system |\n| Purpose     | Loads the next-stage bootloader (e.g., GRUB) and establishes the next trust link     |\n\n**Step 3: GRUB → Kernel (Using Shim’s Verification Capabilities)**\n| Item |Description |\n| -------- | -------- |\n| Boot Source     | GRUB     |\n| Target     | vmlinuz (Linux kernel image)     |\n| Verification     | Verified using the signature checking modules from Shim or GRUB |\n| Purpose     |Ensures that the kernel being booted is cryptographically validated  |\n\nThese three stages are jointly managed by Microsoft, the Linux distribution, and the system owner, forming a **complete and layered trust architecture based on tiered signing and staged verification**.\n\n\n### 4. Managing Custom Keys: MOK (Machine Owner Key)\n\nMOK (Machine Owner Key) allows users to manually enroll custom signing keys, which can then be used to validate third-party drivers or custom-compiled Linux kernels.\nOnce enrolled, the corresponding public key is stored in [NVRAM (non-volatile memory)](https://en.wikipedia.org/wiki/Non-volatile_memory) and becomes part of the Secure Boot validation process, handled by [MokManager](https://github.com/hakuna-m/wubiuefi/wiki/MOKManager) during system startup.\nExample: Importing a MOK on Ubuntu\n\n```bash\nsudo mokutil --import my_key_pub.der\n# The system will prompt you to set a password. After a reboot, you’ll be guided through the MokManager interface to complete the key enrollment process.\n```\n\n### 5. Security Retrospective: BootHole and the Birth of SBAT\n\nThe disclosure of the **[BootHole vulnerability (CVE-2020-10713)](https://nvd.nist.gov/vuln/detail/cve-2020-10713)** in 2020 marked a turning point for the UEFI Secure Boot ecosystem.\nThis flaw existed in the configuration parsing logic of the GRUB2 bootloader, where an attacker could tamper with grub.cfg to inject malicious code. Alarmingly, this could occur even with Secure Boot enabled, effectively bypassing the signature verification process and executing unsigned binaries.\n\nThis incident exposed a critical single point of failure within the Secure Boot trust chain and highlighted the limitations of the traditional revocation approach (such as Microsoft’s dbx blacklist), where revoking a single vulnerable binary could inadvertently disrupt all systems using that version.\n\nTo address these systemic risks, the Linux community—in collaboration with UEFI stakeholders such as Canonical, Red Hat, and others—developed a new mechanism called **[SBAT (Secure Boot Advanced Targeting)](https://www.gnu.org/software/grub/manual/grub/html_node/Secure-Boot-Advanced-Targeting.html)**.\n\nSBAT introduces a more granular and version-aware revocation model, enabling Secure Boot to selectively block specific versions of vulnerable boot components—such as particular builds of shim, GRUB, or the Linux kernel—without impacting safe versions. This significantly improves the flexibility and maintainability of Secure Boot over time.\n\n\n## Conclusion: Shim as a Double-Edged Sword\nShim plays a bridging role in modern operating systems:\n- In Windows, it extends the lifecycle of legacy applications by ensuring compatibility.\n- In Linux, it upholds the integrity and continuity of the Secure Boot trust chain.\n\nOnly by thoroughly understanding how Shim works can organizations fully leverage its advantages—while proactively mitigating the potential security risks it may introduce.\n\n### Why Is Shim Considered a Double-Edged Sword?\n#### Pros:\n - **Maintains Compatibility and Flexibility:**\nShim offers significant flexibility and operational convenience, allowing legacy applications or custom drivers to continue running in modern environments. This reduces both maintenance overhead and the cost of system upgrades.\n\n#### Cons:\n- **Potential Security Risks:**\nThe same mechanisms that offer flexibility can also be exploited as attack vectors. For example, malicious actors may leverage Shim Injection in Windows or exploit outdated shims in Linux to bypass security controls.\n- **Single Point of Failure in the Trust Chain:**\nIn Secure Boot environments, Shim serves as the root of trust. If Shim itself is compromised—either by a vulnerability or unauthorized replacement—the entire trust chain may be invalidated.\n- **High Maintenance and Revocation Complexity:**\nOnce widely deployed, updating or revoking Shim (e.g., via SBAT) can be operationally challenging. Improper updates may even prevent systems from booting, increasing the risk and complexity of incident response.\n\n### Mitigation Strategies and Security Recommendations\nFor real-world deployment, organizations and developers are strongly encouraged to implement version control, enforce signature policies, and adopt centralized management solutions. Continuous monitoring of Shim and Secure Boot–related security advisories is essential to reduce potential attack surfaces.\nRecommended actions include:\n\n1. Maintain Compatibility with Controlled Flexibility\n    - Apply Shims only to essential legacy applications where no viable alternatives exist, avoiding unnecessary dependency across the system.\n    - Implement a robust change management and testing process (e.g., following [ISO/IEC 27001](https://www.iso.org/standard/27001), [NIST 800-53](https://csrc.nist.gov/pubs/sp/800/53/r5/upd1/final)), including risk assessment, functional validation, and version tracking for each Shim configuration to balance compatibility with security.\n    - Enforce application whitelisting policies using mechanisms such as [AppLocker](https://learn.microsoft.com/en-us/windows/security/application-security/application-control/app-control-for-business/applocker/what-is-applocker) or [WDAC](https://learn.microsoft.com/en-us/hololens/windows-defender-application-control-wdac) to restrict the execution of unauthorized programs.\n\n2. Address Potential Security Breaches\n    - Establish monitoring systems to detect suspicious behavior such as the execution of sdbinst.exe or unusual changes to Shim databases.\n\t- Restrict Shim installation privileges to system administrators and limit access to Shim-related tools at the user level.\n\t- Conduct regular audits of %WINDIR%\\AppPatch\\Custom\\ and relevant Shim-related registry paths to track unauthorized modifications.\n\n3. Mitigate Trust Chain Single Points of Failure\n    - Use only officially distributed Shim binaries signed by Microsoft to ensure integrity and trustworthiness.\n    - Deploy SBAT-compliant Shim versions, which allow for granular revocation and precise version management.\n    - Maintain up-to-date versions of Shim, GRUB, the Linux kernel, and UEFI firmware to reduce exposure to known vulnerabilities.\n\n4. Reduce Operational Overhead and Improve Revocation Response\n    - Utilize centralized management tools such as [Microsoft Intune](https://learn.microsoft.com/en-us/intune/intune-service/fundamentals/what-is-intune) or [Ansible](https://www.redhat.com/en/ansible-collaborative) to streamline deployment and monitor Shim usage across environments.\n\t- Design boot recovery strategies, including USB live images or dedicated recovery partitions, to ensure system bootability in case of Shim-related failures.\n\t- Maintain version history and SHA-256 checksum records to support validation and forensic investigation when needed.\n## References\n\n1. Black Hat EU 2015 Whitepaper - [Defending Against Malicious Application Compatibility Shims](https://www.blackhat.com/docs/eu-15/materials/eu-15-Pierce-Defending-Against-Malicious-Application-Compatibility-Shims-wp.pdf)\n2. F-Secure Blog Post - [Hunting for Application Shim Databases](https://blog.f-secure.com/hunting-for-application-shim-databases/)\n3. Google Cloud - [FIN7 Leveraging Shim Databases](https://cloud.google.com/blog/topics/threat-intelligence/fin7-shim-databases-persistence/)\n","slug":"The-Hidden-Power-of-Shim-How-Windows-and-Linux-Use-It—and-Why-You-Should-Care","published":1,"updated":"2025-04-09T21:39:30.654Z","comments":1,"layout":"post","photos":[],"_id":"cm9agcuc70010nc82e2bvcpym","content":"<p>Shim is a critical middleware component used in operating systems. Through API interception or signature verification, it provides both application compatibility and Secure Boot integrity. However, it can also serve as an attack surface for threat actors. This article focuses on the design, implementation, potential security risks, and defense strategies related to Shim.</p>\n<h2 id=\"Introduction-What-is-a-Shim\"><a href=\"#Introduction-What-is-a-Shim\" class=\"headerlink\" title=\"Introduction: What is a Shim?\"></a>Introduction: What is a Shim?</h2><p>In computing, a <em>Shim</em> acts as an intermediary layer that bridges the gap between two incompatible system components. Much like a <a href=\"https://www.tfhc-oilseal.com/Gasketseal/%E5%BB%B6%E9%95%B7%E8%A8%AD%E5%82%99%E5%A3%BD%E5%91%BD,%E5%A2%9E%E5%8A%A0%E7%94%A2%E8%83%BD%E7%9A%84%E9%97%9C%E9%8D%B5%E9%9B%B6%E7%B5%84%E4%BB%B6-%E7%A9%BA%E5%A3%93%E6%B2%B9%E5%B0%81%E5%A2%8A%E7%89%87/\">gasket</a> in mechanical engineering, a shim fills in the space or mismatch, enabling smooth interaction.</p>\n<p>In computer systems, shims vary in form but share the core goal of <em>modifying or intercepting native behavior to enable compatibility or enforce security</em>. This article explores Shim implementations in two major OS platforms:</p>\n<ul>\n<li><strong>Windows - Application Shim</strong>: Primarily for resolving legacy software compatibility.</li>\n<li><strong>Linux - Secure Boot Shim (UEFI environments)</strong>: Serves as the foundational trust anchor in the Secure Boot chain.</li>\n</ul>\n<h2 id=\"Comparing-Shims-in-Windows-vs-Linux\"><a href=\"#Comparing-Shims-in-Windows-vs-Linux\" class=\"headerlink\" title=\"Comparing Shims in Windows vs. Linux\"></a>Comparing Shims in Windows vs. Linux</h2><table>\n<thead>\n<tr>\n<th>Aspect</th>\n<th>Windows Application Shim</th>\n<th>Linux Secure Boot Shim</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>Primary Use</strong></td>\n<td>Compatibility for legacy apps</td>\n<td>Trust anchor for Secure Boot</td>\n</tr>\n<tr>\n<td><strong>Runtime Context</strong></td>\n<td>User-mode</td>\n<td>Early UEFI boot phase</td>\n</tr>\n<tr>\n<td><strong>Main Function</strong></td>\n<td>API interception, behavior modification</td>\n<td>Digital signature verification (GRUB, Kernel)</td>\n</tr>\n<tr>\n<td><strong>Installation</strong></td>\n<td><code>.sdb</code> database, tool-assisted</td>\n<td>Signed loader (distro-shipped, Microsoft-signed)</td>\n</tr>\n<tr>\n<td><strong>Security Risks</strong></td>\n<td>Shim Injection</td>\n<td>Vulnerable outdated shim bypassing Secure Boot</td>\n</tr>\n<tr>\n<td><strong>Common Use Case</strong></td>\n<td>Internal legacy systems, old games</td>\n<td>Dual-boot systems, cloud Linux images</td>\n</tr>\n</tbody></table>\n<h2 id=\"Windows-Implementing-Application-Compatibility-Shims-and-Security-Implications\"><a href=\"#Windows-Implementing-Application-Compatibility-Shims-and-Security-Implications\" class=\"headerlink\" title=\"Windows: Implementing Application Compatibility Shims and Security Implications\"></a>Windows: Implementing Application Compatibility Shims and Security Implications</h2><h3 id=\"1-Use-Cases-Purpose\"><a href=\"#1-Use-Cases-Purpose\" class=\"headerlink\" title=\"1. Use Cases &amp; Purpose\"></a>1. Use Cases &amp; Purpose</h3><p>Windows Shims are designed to resolve compatibility issues that arise when older applications are run on newer OS versions. By intercepting API calls, the shim can masquerade version behavior or adjust logic, tricking the app into “believing” it’s still in a legacy environment.</p>\n<h3 id=\"2-Core-Mechanism\"><a href=\"#2-Core-Mechanism\" class=\"headerlink\" title=\"2. Core Mechanism\"></a>2. Core Mechanism</h3><ul>\n<li><strong>Shim Database ( <code>.sdb</code> )</strong>: Maps applications to associated fixes.</li>\n<li><strong>Shim Engine</strong>: Injects DLLs and intercepts runtime APIs.</li>\n<li><strong>Compatibility Administrator</strong>: GUI tool for customizing and deploying shim fixes.</li>\n</ul>\n<h3 id=\"3-Example-Command-to-Install-a-Shim\"><a href=\"#3-Example-Command-to-Install-a-Shim\" class=\"headerlink\" title=\"3. Example Command to Install a Shim\"></a>3. Example Command to Install a Shim</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># After creating the `.sdb` file using the Compatibility Administrator tool</span></span><br><span class=\"line\">sdbinst.exe C:\\path\\to\\custom_shim.sdb</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-Querying-Installed-Shim-Databases\"><a href=\"#4-Querying-Installed-Shim-Databases\" class=\"headerlink\" title=\"4. Querying Installed Shim Databases\"></a>4. Querying Installed Shim Databases</h3><p><strong>For Older Versions of Windows:</strong><br>If you’re using an older version of Windows (e.g., Windows 7 or 8), you can check for installed custom .sdb (Shim Database) files using the following PowerShell command, as documented in earlier technical references (Ref. [1][2]):</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">reg query <span class=\"string\">&quot;HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\InstalledSDB&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>For Newer Versions of Windows:</strong><br>On more recent versions of Windows (e.g., Windows 10 or 11), the above registry path may not exist or may return nothing. This is because while the <code>AppCompat</code> database still exists, its entries are no longer guaranteed to appear under the <code>InstalledSDB</code> key. Instead, related Shim information may be spread across other registry locations.</p>\n<p>You can use the following PowerShell commands to check for relevant Shim behaviors:</p>\n<ul>\n<li><p>List custom shims applied to specific executable paths:</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">reg query <span class=\"string\">&quot;HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Custom&quot;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>List user-defined compatibility layers, such as those set via “Run in compatibility mode” from the right-click menu:</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">reg query <span class=\"string\">&quot;HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Layers&quot;</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<p><strong>Why Might the InstalledSDB Key Be Missing?</strong><br>There are several possible reasons why the InstalledSDB key is not found in newer versions of Windows:</p>\n<ol>\n<li>Not all .sdb installations are recorded under InstalledSDB.</li>\n<li>Some Windows editions no longer create this registry key by default.</li>\n<li>Microsoft has shifted its approach to managing shims, increasingly favoring stricter application control mechanisms such as <a href=\"https://learn.microsoft.com/en-us/hololens/windows-defender-application-control-wdac\">WDAC (Windows Defender Application Control)</a> and <a href=\"https://learn.microsoft.com/en-us/windows/security/application-security/application-control/app-control-for-business/applocker/what-is-applocker\">AppLocker</a>.</li>\n</ol>\n<h3 id=\"5-Common-Shim-Examples\"><a href=\"#5-Common-Shim-Examples\" class=\"headerlink\" title=\"5. Common Shim Examples\"></a>5. Common Shim Examples</h3><ul>\n<li><code>VersionLie</code>: Fakes Windows version</li>\n<li><code>ForceAdminAccess</code>: Tricks apps into thinking user is Admin</li>\n<li><code>CorrectFilePaths</code>: Redirects paths to compatible locations</li>\n</ul>\n<h3 id=\"6-Security-Risk-Shim-Injection\"><a href=\"#6-Security-Risk-Shim-Injection\" class=\"headerlink\" title=\"6. Security Risk - Shim Injection\"></a>6. Security Risk - Shim Injection</h3><p>Attackers can craft <code>.sdb</code> files and use <code>sdbinst.exe</code> to silently install malicious shims. When the target application runs, the shim injects malicious logic. Notably, the APT group <a href=\"https://malpedia.caad.fkie.fraunhofer.de/actor/fin7\">FIN7</a> has used this technique for persistent access. (Ref.[3])</p>\n<h2 id=\"Linux-Shim’s-Role-in-Secure-Boot\"><a href=\"#Linux-Shim’s-Role-in-Secure-Boot\" class=\"headerlink\" title=\"Linux: Shim’s Role in Secure Boot\"></a>Linux: Shim’s Role in Secure Boot</h2><h3 id=\"1-Secure-Boot-Overview\"><a href=\"#1-Secure-Boot-Overview\" class=\"headerlink\" title=\"1. Secure Boot Overview\"></a>1. Secure Boot Overview</h3><p>UEFI Secure Boot ensures only signed binaries are executed during boot. Firmware trusts binaries signed by Microsoft’s UEFI CA.</p>\n<h3 id=\"2-Why-Linux-Needs-Shim\"><a href=\"#2-Why-Linux-Needs-Shim\" class=\"headerlink\" title=\"2. Why Linux Needs Shim\"></a>2. Why Linux Needs Shim</h3><p>Shim allows distributions to sign and manage their own GRUB&#x2F;kernel updates without requiring direct Microsoft signature for every update.<br>Shim itself is Microsoft-signed, while embedded public keys inside shim verify GRUB and Linux kernel.</p>\n<h3 id=\"3-Boot-Process-Flow-The-Shim-Three-Stage-Trust-Chain\"><a href=\"#3-Boot-Process-Flow-The-Shim-Three-Stage-Trust-Chain\" class=\"headerlink\" title=\"3. Boot Process Flow: The Shim Three-Stage Trust Chain\"></a>3. Boot Process Flow: The Shim Three-Stage Trust Chain</h3><p>The three-stage trust chain is a core architecture used in Linux systems under UEFI Secure Boot to ensure a secure and tamper-resistant boot process.</p>\n<p>Its primary goal is to guarantee that every executable component involved in the boot sequence—from UEFI firmware to GRUB and ultimately to the Linux kernel—is cryptographically verified and trusted, ensuring integrity and authenticity throughout the chain.</p>\n<p>This trust chain consists of four critical components in sequence: Firmware, Shim, GRUB, and the Kernel. Each stage is signed and verified by a distinct trusted authority:</p>\n<ul>\n<li>Firmware is typically provided and signed by the hardware vendor.</li>\n<li>Shim is developed by the Linux distribution and signed by Microsoft to gain acceptance by the UEFI firmware.</li>\n<li>GRUB and the Kernel are signed by the distribution itself and are verified by Shim using embedded public keys or through the MOK (Machine Owner Key) mechanism.</li>\n</ul>\n<p>Together, these components form a complete and auditable trust path, ensuring that only validated binaries are executed during system boot.</p>\n<p><img src=\"https://kevinchiu923.github.io/post/The-Hidden-Power-of-Shim-How-Windows-and-Linux-Use-It%E2%80%94and-Why-You-Should-Care/Three-stage-Trust-Chain.jpeg\"></p>\n<p><strong>Detailed Flow:</strong><br><strong>Step 1: Firmware → Shim (Signed by Microsoft)</strong></p>\n<table>\n<thead>\n<tr>\n<th>Item</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Boot Source</td>\n<td>UEFI firmware</td>\n</tr>\n<tr>\n<td>Target</td>\n<td>shimx64.efi (provided by the Linux distribution, signed by Microsoft)</td>\n</tr>\n<tr>\n<td>Verification</td>\n<td>Verified via Microsoft UEFI CA signature</td>\n</tr>\n<tr>\n<td>Purpose</td>\n<td>Enables non-Microsoft bootloaders (e.g., GRUB) to load under Secure Boot</td>\n</tr>\n</tbody></table>\n<p><strong>Step 2: Shim → GRUB (or Other Bootloaders, Signed by Distro)</strong></p>\n<table>\n<thead>\n<tr>\n<th>Item</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Boot Source</td>\n<td>shimx64.efi</td>\n</tr>\n<tr>\n<td>Target</td>\n<td>grubx64.efi (signed by the Linux distribution)</td>\n</tr>\n<tr>\n<td>Verification</td>\n<td>Verified using an embedded public key in Shim, or via the MOK (Machine Owner Key) system</td>\n</tr>\n<tr>\n<td>Purpose</td>\n<td>Loads the next-stage bootloader (e.g., GRUB) and establishes the next trust link</td>\n</tr>\n</tbody></table>\n<p><strong>Step 3: GRUB → Kernel (Using Shim’s Verification Capabilities)</strong></p>\n<table>\n<thead>\n<tr>\n<th>Item</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Boot Source</td>\n<td>GRUB</td>\n</tr>\n<tr>\n<td>Target</td>\n<td>vmlinuz (Linux kernel image)</td>\n</tr>\n<tr>\n<td>Verification</td>\n<td>Verified using the signature checking modules from Shim or GRUB</td>\n</tr>\n<tr>\n<td>Purpose</td>\n<td>Ensures that the kernel being booted is cryptographically validated</td>\n</tr>\n</tbody></table>\n<p>These three stages are jointly managed by Microsoft, the Linux distribution, and the system owner, forming a <strong>complete and layered trust architecture based on tiered signing and staged verification</strong>.</p>\n<h3 id=\"4-Managing-Custom-Keys-MOK-Machine-Owner-Key\"><a href=\"#4-Managing-Custom-Keys-MOK-Machine-Owner-Key\" class=\"headerlink\" title=\"4. Managing Custom Keys: MOK (Machine Owner Key)\"></a>4. Managing Custom Keys: MOK (Machine Owner Key)</h3><p>MOK (Machine Owner Key) allows users to manually enroll custom signing keys, which can then be used to validate third-party drivers or custom-compiled Linux kernels.<br>Once enrolled, the corresponding public key is stored in <a href=\"https://en.wikipedia.org/wiki/Non-volatile_memory\">NVRAM (non-volatile memory)</a> and becomes part of the Secure Boot validation process, handled by <a href=\"https://github.com/hakuna-m/wubiuefi/wiki/MOKManager\">MokManager</a> during system startup.<br>Example: Importing a MOK on Ubuntu</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> mokutil --import my_key_pub.der</span><br><span class=\"line\"><span class=\"comment\"># The system will prompt you to set a password. After a reboot, you’ll be guided through the MokManager interface to complete the key enrollment process.</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5-Security-Retrospective-BootHole-and-the-Birth-of-SBAT\"><a href=\"#5-Security-Retrospective-BootHole-and-the-Birth-of-SBAT\" class=\"headerlink\" title=\"5. Security Retrospective: BootHole and the Birth of SBAT\"></a>5. Security Retrospective: BootHole and the Birth of SBAT</h3><p>The disclosure of the <strong><a href=\"https://nvd.nist.gov/vuln/detail/cve-2020-10713\">BootHole vulnerability (CVE-2020-10713)</a></strong> in 2020 marked a turning point for the UEFI Secure Boot ecosystem.<br>This flaw existed in the configuration parsing logic of the GRUB2 bootloader, where an attacker could tamper with grub.cfg to inject malicious code. Alarmingly, this could occur even with Secure Boot enabled, effectively bypassing the signature verification process and executing unsigned binaries.</p>\n<p>This incident exposed a critical single point of failure within the Secure Boot trust chain and highlighted the limitations of the traditional revocation approach (such as Microsoft’s dbx blacklist), where revoking a single vulnerable binary could inadvertently disrupt all systems using that version.</p>\n<p>To address these systemic risks, the Linux community—in collaboration with UEFI stakeholders such as Canonical, Red Hat, and others—developed a new mechanism called <strong><a href=\"https://www.gnu.org/software/grub/manual/grub/html_node/Secure-Boot-Advanced-Targeting.html\">SBAT (Secure Boot Advanced Targeting)</a></strong>.</p>\n<p>SBAT introduces a more granular and version-aware revocation model, enabling Secure Boot to selectively block specific versions of vulnerable boot components—such as particular builds of shim, GRUB, or the Linux kernel—without impacting safe versions. This significantly improves the flexibility and maintainability of Secure Boot over time.</p>\n<h2 id=\"Conclusion-Shim-as-a-Double-Edged-Sword\"><a href=\"#Conclusion-Shim-as-a-Double-Edged-Sword\" class=\"headerlink\" title=\"Conclusion: Shim as a Double-Edged Sword\"></a>Conclusion: Shim as a Double-Edged Sword</h2><p>Shim plays a bridging role in modern operating systems:</p>\n<ul>\n<li>In Windows, it extends the lifecycle of legacy applications by ensuring compatibility.</li>\n<li>In Linux, it upholds the integrity and continuity of the Secure Boot trust chain.</li>\n</ul>\n<p>Only by thoroughly understanding how Shim works can organizations fully leverage its advantages—while proactively mitigating the potential security risks it may introduce.</p>\n<h3 id=\"Why-Is-Shim-Considered-a-Double-Edged-Sword\"><a href=\"#Why-Is-Shim-Considered-a-Double-Edged-Sword\" class=\"headerlink\" title=\"Why Is Shim Considered a Double-Edged Sword?\"></a>Why Is Shim Considered a Double-Edged Sword?</h3><h4 id=\"Pros\"><a href=\"#Pros\" class=\"headerlink\" title=\"Pros:\"></a>Pros:</h4><ul>\n<li><strong>Maintains Compatibility and Flexibility:</strong><br>Shim offers significant flexibility and operational convenience, allowing legacy applications or custom drivers to continue running in modern environments. This reduces both maintenance overhead and the cost of system upgrades.</li>\n</ul>\n<h4 id=\"Cons\"><a href=\"#Cons\" class=\"headerlink\" title=\"Cons:\"></a>Cons:</h4><ul>\n<li><strong>Potential Security Risks:</strong><br>The same mechanisms that offer flexibility can also be exploited as attack vectors. For example, malicious actors may leverage Shim Injection in Windows or exploit outdated shims in Linux to bypass security controls.</li>\n<li><strong>Single Point of Failure in the Trust Chain:</strong><br>In Secure Boot environments, Shim serves as the root of trust. If Shim itself is compromised—either by a vulnerability or unauthorized replacement—the entire trust chain may be invalidated.</li>\n<li><strong>High Maintenance and Revocation Complexity:</strong><br>Once widely deployed, updating or revoking Shim (e.g., via SBAT) can be operationally challenging. Improper updates may even prevent systems from booting, increasing the risk and complexity of incident response.</li>\n</ul>\n<h3 id=\"Mitigation-Strategies-and-Security-Recommendations\"><a href=\"#Mitigation-Strategies-and-Security-Recommendations\" class=\"headerlink\" title=\"Mitigation Strategies and Security Recommendations\"></a>Mitigation Strategies and Security Recommendations</h3><p>For real-world deployment, organizations and developers are strongly encouraged to implement version control, enforce signature policies, and adopt centralized management solutions. Continuous monitoring of Shim and Secure Boot–related security advisories is essential to reduce potential attack surfaces.<br>Recommended actions include:</p>\n<ol>\n<li><p>Maintain Compatibility with Controlled Flexibility</p>\n<ul>\n<li>Apply Shims only to essential legacy applications where no viable alternatives exist, avoiding unnecessary dependency across the system.</li>\n<li>Implement a robust change management and testing process (e.g., following <a href=\"https://www.iso.org/standard/27001\">ISO&#x2F;IEC 27001</a>, <a href=\"https://csrc.nist.gov/pubs/sp/800/53/r5/upd1/final\">NIST 800-53</a>), including risk assessment, functional validation, and version tracking for each Shim configuration to balance compatibility with security.</li>\n<li>Enforce application whitelisting policies using mechanisms such as <a href=\"https://learn.microsoft.com/en-us/windows/security/application-security/application-control/app-control-for-business/applocker/what-is-applocker\">AppLocker</a> or <a href=\"https://learn.microsoft.com/en-us/hololens/windows-defender-application-control-wdac\">WDAC</a> to restrict the execution of unauthorized programs.</li>\n</ul>\n</li>\n<li><p>Address Potential Security Breaches</p>\n<ul>\n<li>Establish monitoring systems to detect suspicious behavior such as the execution of sdbinst.exe or unusual changes to Shim databases.</li>\n<li>Restrict Shim installation privileges to system administrators and limit access to Shim-related tools at the user level.</li>\n<li>Conduct regular audits of %WINDIR%\\AppPatch\\Custom\\ and relevant Shim-related registry paths to track unauthorized modifications.</li>\n</ul>\n</li>\n<li><p>Mitigate Trust Chain Single Points of Failure</p>\n<ul>\n<li>Use only officially distributed Shim binaries signed by Microsoft to ensure integrity and trustworthiness.</li>\n<li>Deploy SBAT-compliant Shim versions, which allow for granular revocation and precise version management.</li>\n<li>Maintain up-to-date versions of Shim, GRUB, the Linux kernel, and UEFI firmware to reduce exposure to known vulnerabilities.</li>\n</ul>\n</li>\n<li><p>Reduce Operational Overhead and Improve Revocation Response</p>\n<ul>\n<li>Utilize centralized management tools such as <a href=\"https://learn.microsoft.com/en-us/intune/intune-service/fundamentals/what-is-intune\">Microsoft Intune</a> or <a href=\"https://www.redhat.com/en/ansible-collaborative\">Ansible</a> to streamline deployment and monitor Shim usage across environments.</li>\n<li>Design boot recovery strategies, including USB live images or dedicated recovery partitions, to ensure system bootability in case of Shim-related failures.</li>\n<li>Maintain version history and SHA-256 checksum records to support validation and forensic investigation when needed.</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"References\"><a href=\"#References\" class=\"headerlink\" title=\"References\"></a>References</h2><ol>\n<li>Black Hat EU 2015 Whitepaper - <a href=\"https://www.blackhat.com/docs/eu-15/materials/eu-15-Pierce-Defending-Against-Malicious-Application-Compatibility-Shims-wp.pdf\">Defending Against Malicious Application Compatibility Shims</a></li>\n<li>F-Secure Blog Post - <a href=\"https://blog.f-secure.com/hunting-for-application-shim-databases/\">Hunting for Application Shim Databases</a></li>\n<li>Google Cloud - <a href=\"https://cloud.google.com/blog/topics/threat-intelligence/fin7-shim-databases-persistence/\">FIN7 Leveraging Shim Databases</a></li>\n</ol>\n","excerpt":"","more":"<p>Shim is a critical middleware component used in operating systems. Through API interception or signature verification, it provides both application compatibility and Secure Boot integrity. However, it can also serve as an attack surface for threat actors. This article focuses on the design, implementation, potential security risks, and defense strategies related to Shim.</p>\n<h2 id=\"Introduction-What-is-a-Shim\"><a href=\"#Introduction-What-is-a-Shim\" class=\"headerlink\" title=\"Introduction: What is a Shim?\"></a>Introduction: What is a Shim?</h2><p>In computing, a <em>Shim</em> acts as an intermediary layer that bridges the gap between two incompatible system components. Much like a <a href=\"https://www.tfhc-oilseal.com/Gasketseal/%E5%BB%B6%E9%95%B7%E8%A8%AD%E5%82%99%E5%A3%BD%E5%91%BD,%E5%A2%9E%E5%8A%A0%E7%94%A2%E8%83%BD%E7%9A%84%E9%97%9C%E9%8D%B5%E9%9B%B6%E7%B5%84%E4%BB%B6-%E7%A9%BA%E5%A3%93%E6%B2%B9%E5%B0%81%E5%A2%8A%E7%89%87/\">gasket</a> in mechanical engineering, a shim fills in the space or mismatch, enabling smooth interaction.</p>\n<p>In computer systems, shims vary in form but share the core goal of <em>modifying or intercepting native behavior to enable compatibility or enforce security</em>. This article explores Shim implementations in two major OS platforms:</p>\n<ul>\n<li><strong>Windows - Application Shim</strong>: Primarily for resolving legacy software compatibility.</li>\n<li><strong>Linux - Secure Boot Shim (UEFI environments)</strong>: Serves as the foundational trust anchor in the Secure Boot chain.</li>\n</ul>\n<h2 id=\"Comparing-Shims-in-Windows-vs-Linux\"><a href=\"#Comparing-Shims-in-Windows-vs-Linux\" class=\"headerlink\" title=\"Comparing Shims in Windows vs. Linux\"></a>Comparing Shims in Windows vs. Linux</h2><table>\n<thead>\n<tr>\n<th>Aspect</th>\n<th>Windows Application Shim</th>\n<th>Linux Secure Boot Shim</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><strong>Primary Use</strong></td>\n<td>Compatibility for legacy apps</td>\n<td>Trust anchor for Secure Boot</td>\n</tr>\n<tr>\n<td><strong>Runtime Context</strong></td>\n<td>User-mode</td>\n<td>Early UEFI boot phase</td>\n</tr>\n<tr>\n<td><strong>Main Function</strong></td>\n<td>API interception, behavior modification</td>\n<td>Digital signature verification (GRUB, Kernel)</td>\n</tr>\n<tr>\n<td><strong>Installation</strong></td>\n<td><code>.sdb</code> database, tool-assisted</td>\n<td>Signed loader (distro-shipped, Microsoft-signed)</td>\n</tr>\n<tr>\n<td><strong>Security Risks</strong></td>\n<td>Shim Injection</td>\n<td>Vulnerable outdated shim bypassing Secure Boot</td>\n</tr>\n<tr>\n<td><strong>Common Use Case</strong></td>\n<td>Internal legacy systems, old games</td>\n<td>Dual-boot systems, cloud Linux images</td>\n</tr>\n</tbody></table>\n<h2 id=\"Windows-Implementing-Application-Compatibility-Shims-and-Security-Implications\"><a href=\"#Windows-Implementing-Application-Compatibility-Shims-and-Security-Implications\" class=\"headerlink\" title=\"Windows: Implementing Application Compatibility Shims and Security Implications\"></a>Windows: Implementing Application Compatibility Shims and Security Implications</h2><h3 id=\"1-Use-Cases-Purpose\"><a href=\"#1-Use-Cases-Purpose\" class=\"headerlink\" title=\"1. Use Cases &amp; Purpose\"></a>1. Use Cases &amp; Purpose</h3><p>Windows Shims are designed to resolve compatibility issues that arise when older applications are run on newer OS versions. By intercepting API calls, the shim can masquerade version behavior or adjust logic, tricking the app into “believing” it’s still in a legacy environment.</p>\n<h3 id=\"2-Core-Mechanism\"><a href=\"#2-Core-Mechanism\" class=\"headerlink\" title=\"2. Core Mechanism\"></a>2. Core Mechanism</h3><ul>\n<li><strong>Shim Database ( <code>.sdb</code> )</strong>: Maps applications to associated fixes.</li>\n<li><strong>Shim Engine</strong>: Injects DLLs and intercepts runtime APIs.</li>\n<li><strong>Compatibility Administrator</strong>: GUI tool for customizing and deploying shim fixes.</li>\n</ul>\n<h3 id=\"3-Example-Command-to-Install-a-Shim\"><a href=\"#3-Example-Command-to-Install-a-Shim\" class=\"headerlink\" title=\"3. Example Command to Install a Shim\"></a>3. Example Command to Install a Shim</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># After creating the `.sdb` file using the Compatibility Administrator tool</span></span><br><span class=\"line\">sdbinst.exe C:\\path\\to\\custom_shim.sdb</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-Querying-Installed-Shim-Databases\"><a href=\"#4-Querying-Installed-Shim-Databases\" class=\"headerlink\" title=\"4. Querying Installed Shim Databases\"></a>4. Querying Installed Shim Databases</h3><p><strong>For Older Versions of Windows:</strong><br>If you’re using an older version of Windows (e.g., Windows 7 or 8), you can check for installed custom .sdb (Shim Database) files using the following PowerShell command, as documented in earlier technical references (Ref. [1][2]):</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">reg query <span class=\"string\">&quot;HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\InstalledSDB&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>For Newer Versions of Windows:</strong><br>On more recent versions of Windows (e.g., Windows 10 or 11), the above registry path may not exist or may return nothing. This is because while the <code>AppCompat</code> database still exists, its entries are no longer guaranteed to appear under the <code>InstalledSDB</code> key. Instead, related Shim information may be spread across other registry locations.</p>\n<p>You can use the following PowerShell commands to check for relevant Shim behaviors:</p>\n<ul>\n<li><p>List custom shims applied to specific executable paths:</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">reg query <span class=\"string\">&quot;HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Custom&quot;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>List user-defined compatibility layers, such as those set via “Run in compatibility mode” from the right-click menu:</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">reg query <span class=\"string\">&quot;HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Layers&quot;</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<p><strong>Why Might the InstalledSDB Key Be Missing?</strong><br>There are several possible reasons why the InstalledSDB key is not found in newer versions of Windows:</p>\n<ol>\n<li>Not all .sdb installations are recorded under InstalledSDB.</li>\n<li>Some Windows editions no longer create this registry key by default.</li>\n<li>Microsoft has shifted its approach to managing shims, increasingly favoring stricter application control mechanisms such as <a href=\"https://learn.microsoft.com/en-us/hololens/windows-defender-application-control-wdac\">WDAC (Windows Defender Application Control)</a> and <a href=\"https://learn.microsoft.com/en-us/windows/security/application-security/application-control/app-control-for-business/applocker/what-is-applocker\">AppLocker</a>.</li>\n</ol>\n<h3 id=\"5-Common-Shim-Examples\"><a href=\"#5-Common-Shim-Examples\" class=\"headerlink\" title=\"5. Common Shim Examples\"></a>5. Common Shim Examples</h3><ul>\n<li><code>VersionLie</code>: Fakes Windows version</li>\n<li><code>ForceAdminAccess</code>: Tricks apps into thinking user is Admin</li>\n<li><code>CorrectFilePaths</code>: Redirects paths to compatible locations</li>\n</ul>\n<h3 id=\"6-Security-Risk-Shim-Injection\"><a href=\"#6-Security-Risk-Shim-Injection\" class=\"headerlink\" title=\"6. Security Risk - Shim Injection\"></a>6. Security Risk - Shim Injection</h3><p>Attackers can craft <code>.sdb</code> files and use <code>sdbinst.exe</code> to silently install malicious shims. When the target application runs, the shim injects malicious logic. Notably, the APT group <a href=\"https://malpedia.caad.fkie.fraunhofer.de/actor/fin7\">FIN7</a> has used this technique for persistent access. (Ref.[3])</p>\n<h2 id=\"Linux-Shim’s-Role-in-Secure-Boot\"><a href=\"#Linux-Shim’s-Role-in-Secure-Boot\" class=\"headerlink\" title=\"Linux: Shim’s Role in Secure Boot\"></a>Linux: Shim’s Role in Secure Boot</h2><h3 id=\"1-Secure-Boot-Overview\"><a href=\"#1-Secure-Boot-Overview\" class=\"headerlink\" title=\"1. Secure Boot Overview\"></a>1. Secure Boot Overview</h3><p>UEFI Secure Boot ensures only signed binaries are executed during boot. Firmware trusts binaries signed by Microsoft’s UEFI CA.</p>\n<h3 id=\"2-Why-Linux-Needs-Shim\"><a href=\"#2-Why-Linux-Needs-Shim\" class=\"headerlink\" title=\"2. Why Linux Needs Shim\"></a>2. Why Linux Needs Shim</h3><p>Shim allows distributions to sign and manage their own GRUB&#x2F;kernel updates without requiring direct Microsoft signature for every update.<br>Shim itself is Microsoft-signed, while embedded public keys inside shim verify GRUB and Linux kernel.</p>\n<h3 id=\"3-Boot-Process-Flow-The-Shim-Three-Stage-Trust-Chain\"><a href=\"#3-Boot-Process-Flow-The-Shim-Three-Stage-Trust-Chain\" class=\"headerlink\" title=\"3. Boot Process Flow: The Shim Three-Stage Trust Chain\"></a>3. Boot Process Flow: The Shim Three-Stage Trust Chain</h3><p>The three-stage trust chain is a core architecture used in Linux systems under UEFI Secure Boot to ensure a secure and tamper-resistant boot process.</p>\n<p>Its primary goal is to guarantee that every executable component involved in the boot sequence—from UEFI firmware to GRUB and ultimately to the Linux kernel—is cryptographically verified and trusted, ensuring integrity and authenticity throughout the chain.</p>\n<p>This trust chain consists of four critical components in sequence: Firmware, Shim, GRUB, and the Kernel. Each stage is signed and verified by a distinct trusted authority:</p>\n<ul>\n<li>Firmware is typically provided and signed by the hardware vendor.</li>\n<li>Shim is developed by the Linux distribution and signed by Microsoft to gain acceptance by the UEFI firmware.</li>\n<li>GRUB and the Kernel are signed by the distribution itself and are verified by Shim using embedded public keys or through the MOK (Machine Owner Key) mechanism.</li>\n</ul>\n<p>Together, these components form a complete and auditable trust path, ensuring that only validated binaries are executed during system boot.</p>\n<p><img src=\"https://kevinchiu923.github.io/post/The-Hidden-Power-of-Shim-How-Windows-and-Linux-Use-It%E2%80%94and-Why-You-Should-Care/Three-stage-Trust-Chain.jpeg\"></p>\n<p><strong>Detailed Flow:</strong><br><strong>Step 1: Firmware → Shim (Signed by Microsoft)</strong></p>\n<table>\n<thead>\n<tr>\n<th>Item</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Boot Source</td>\n<td>UEFI firmware</td>\n</tr>\n<tr>\n<td>Target</td>\n<td>shimx64.efi (provided by the Linux distribution, signed by Microsoft)</td>\n</tr>\n<tr>\n<td>Verification</td>\n<td>Verified via Microsoft UEFI CA signature</td>\n</tr>\n<tr>\n<td>Purpose</td>\n<td>Enables non-Microsoft bootloaders (e.g., GRUB) to load under Secure Boot</td>\n</tr>\n</tbody></table>\n<p><strong>Step 2: Shim → GRUB (or Other Bootloaders, Signed by Distro)</strong></p>\n<table>\n<thead>\n<tr>\n<th>Item</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Boot Source</td>\n<td>shimx64.efi</td>\n</tr>\n<tr>\n<td>Target</td>\n<td>grubx64.efi (signed by the Linux distribution)</td>\n</tr>\n<tr>\n<td>Verification</td>\n<td>Verified using an embedded public key in Shim, or via the MOK (Machine Owner Key) system</td>\n</tr>\n<tr>\n<td>Purpose</td>\n<td>Loads the next-stage bootloader (e.g., GRUB) and establishes the next trust link</td>\n</tr>\n</tbody></table>\n<p><strong>Step 3: GRUB → Kernel (Using Shim’s Verification Capabilities)</strong></p>\n<table>\n<thead>\n<tr>\n<th>Item</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Boot Source</td>\n<td>GRUB</td>\n</tr>\n<tr>\n<td>Target</td>\n<td>vmlinuz (Linux kernel image)</td>\n</tr>\n<tr>\n<td>Verification</td>\n<td>Verified using the signature checking modules from Shim or GRUB</td>\n</tr>\n<tr>\n<td>Purpose</td>\n<td>Ensures that the kernel being booted is cryptographically validated</td>\n</tr>\n</tbody></table>\n<p>These three stages are jointly managed by Microsoft, the Linux distribution, and the system owner, forming a <strong>complete and layered trust architecture based on tiered signing and staged verification</strong>.</p>\n<h3 id=\"4-Managing-Custom-Keys-MOK-Machine-Owner-Key\"><a href=\"#4-Managing-Custom-Keys-MOK-Machine-Owner-Key\" class=\"headerlink\" title=\"4. Managing Custom Keys: MOK (Machine Owner Key)\"></a>4. Managing Custom Keys: MOK (Machine Owner Key)</h3><p>MOK (Machine Owner Key) allows users to manually enroll custom signing keys, which can then be used to validate third-party drivers or custom-compiled Linux kernels.<br>Once enrolled, the corresponding public key is stored in <a href=\"https://en.wikipedia.org/wiki/Non-volatile_memory\">NVRAM (non-volatile memory)</a> and becomes part of the Secure Boot validation process, handled by <a href=\"https://github.com/hakuna-m/wubiuefi/wiki/MOKManager\">MokManager</a> during system startup.<br>Example: Importing a MOK on Ubuntu</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> mokutil --import my_key_pub.der</span><br><span class=\"line\"><span class=\"comment\"># The system will prompt you to set a password. After a reboot, you’ll be guided through the MokManager interface to complete the key enrollment process.</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5-Security-Retrospective-BootHole-and-the-Birth-of-SBAT\"><a href=\"#5-Security-Retrospective-BootHole-and-the-Birth-of-SBAT\" class=\"headerlink\" title=\"5. Security Retrospective: BootHole and the Birth of SBAT\"></a>5. Security Retrospective: BootHole and the Birth of SBAT</h3><p>The disclosure of the <strong><a href=\"https://nvd.nist.gov/vuln/detail/cve-2020-10713\">BootHole vulnerability (CVE-2020-10713)</a></strong> in 2020 marked a turning point for the UEFI Secure Boot ecosystem.<br>This flaw existed in the configuration parsing logic of the GRUB2 bootloader, where an attacker could tamper with grub.cfg to inject malicious code. Alarmingly, this could occur even with Secure Boot enabled, effectively bypassing the signature verification process and executing unsigned binaries.</p>\n<p>This incident exposed a critical single point of failure within the Secure Boot trust chain and highlighted the limitations of the traditional revocation approach (such as Microsoft’s dbx blacklist), where revoking a single vulnerable binary could inadvertently disrupt all systems using that version.</p>\n<p>To address these systemic risks, the Linux community—in collaboration with UEFI stakeholders such as Canonical, Red Hat, and others—developed a new mechanism called <strong><a href=\"https://www.gnu.org/software/grub/manual/grub/html_node/Secure-Boot-Advanced-Targeting.html\">SBAT (Secure Boot Advanced Targeting)</a></strong>.</p>\n<p>SBAT introduces a more granular and version-aware revocation model, enabling Secure Boot to selectively block specific versions of vulnerable boot components—such as particular builds of shim, GRUB, or the Linux kernel—without impacting safe versions. This significantly improves the flexibility and maintainability of Secure Boot over time.</p>\n<h2 id=\"Conclusion-Shim-as-a-Double-Edged-Sword\"><a href=\"#Conclusion-Shim-as-a-Double-Edged-Sword\" class=\"headerlink\" title=\"Conclusion: Shim as a Double-Edged Sword\"></a>Conclusion: Shim as a Double-Edged Sword</h2><p>Shim plays a bridging role in modern operating systems:</p>\n<ul>\n<li>In Windows, it extends the lifecycle of legacy applications by ensuring compatibility.</li>\n<li>In Linux, it upholds the integrity and continuity of the Secure Boot trust chain.</li>\n</ul>\n<p>Only by thoroughly understanding how Shim works can organizations fully leverage its advantages—while proactively mitigating the potential security risks it may introduce.</p>\n<h3 id=\"Why-Is-Shim-Considered-a-Double-Edged-Sword\"><a href=\"#Why-Is-Shim-Considered-a-Double-Edged-Sword\" class=\"headerlink\" title=\"Why Is Shim Considered a Double-Edged Sword?\"></a>Why Is Shim Considered a Double-Edged Sword?</h3><h4 id=\"Pros\"><a href=\"#Pros\" class=\"headerlink\" title=\"Pros:\"></a>Pros:</h4><ul>\n<li><strong>Maintains Compatibility and Flexibility:</strong><br>Shim offers significant flexibility and operational convenience, allowing legacy applications or custom drivers to continue running in modern environments. This reduces both maintenance overhead and the cost of system upgrades.</li>\n</ul>\n<h4 id=\"Cons\"><a href=\"#Cons\" class=\"headerlink\" title=\"Cons:\"></a>Cons:</h4><ul>\n<li><strong>Potential Security Risks:</strong><br>The same mechanisms that offer flexibility can also be exploited as attack vectors. For example, malicious actors may leverage Shim Injection in Windows or exploit outdated shims in Linux to bypass security controls.</li>\n<li><strong>Single Point of Failure in the Trust Chain:</strong><br>In Secure Boot environments, Shim serves as the root of trust. If Shim itself is compromised—either by a vulnerability or unauthorized replacement—the entire trust chain may be invalidated.</li>\n<li><strong>High Maintenance and Revocation Complexity:</strong><br>Once widely deployed, updating or revoking Shim (e.g., via SBAT) can be operationally challenging. Improper updates may even prevent systems from booting, increasing the risk and complexity of incident response.</li>\n</ul>\n<h3 id=\"Mitigation-Strategies-and-Security-Recommendations\"><a href=\"#Mitigation-Strategies-and-Security-Recommendations\" class=\"headerlink\" title=\"Mitigation Strategies and Security Recommendations\"></a>Mitigation Strategies and Security Recommendations</h3><p>For real-world deployment, organizations and developers are strongly encouraged to implement version control, enforce signature policies, and adopt centralized management solutions. Continuous monitoring of Shim and Secure Boot–related security advisories is essential to reduce potential attack surfaces.<br>Recommended actions include:</p>\n<ol>\n<li><p>Maintain Compatibility with Controlled Flexibility</p>\n<ul>\n<li>Apply Shims only to essential legacy applications where no viable alternatives exist, avoiding unnecessary dependency across the system.</li>\n<li>Implement a robust change management and testing process (e.g., following <a href=\"https://www.iso.org/standard/27001\">ISO&#x2F;IEC 27001</a>, <a href=\"https://csrc.nist.gov/pubs/sp/800/53/r5/upd1/final\">NIST 800-53</a>), including risk assessment, functional validation, and version tracking for each Shim configuration to balance compatibility with security.</li>\n<li>Enforce application whitelisting policies using mechanisms such as <a href=\"https://learn.microsoft.com/en-us/windows/security/application-security/application-control/app-control-for-business/applocker/what-is-applocker\">AppLocker</a> or <a href=\"https://learn.microsoft.com/en-us/hololens/windows-defender-application-control-wdac\">WDAC</a> to restrict the execution of unauthorized programs.</li>\n</ul>\n</li>\n<li><p>Address Potential Security Breaches</p>\n<ul>\n<li>Establish monitoring systems to detect suspicious behavior such as the execution of sdbinst.exe or unusual changes to Shim databases.</li>\n<li>Restrict Shim installation privileges to system administrators and limit access to Shim-related tools at the user level.</li>\n<li>Conduct regular audits of %WINDIR%\\AppPatch\\Custom\\ and relevant Shim-related registry paths to track unauthorized modifications.</li>\n</ul>\n</li>\n<li><p>Mitigate Trust Chain Single Points of Failure</p>\n<ul>\n<li>Use only officially distributed Shim binaries signed by Microsoft to ensure integrity and trustworthiness.</li>\n<li>Deploy SBAT-compliant Shim versions, which allow for granular revocation and precise version management.</li>\n<li>Maintain up-to-date versions of Shim, GRUB, the Linux kernel, and UEFI firmware to reduce exposure to known vulnerabilities.</li>\n</ul>\n</li>\n<li><p>Reduce Operational Overhead and Improve Revocation Response</p>\n<ul>\n<li>Utilize centralized management tools such as <a href=\"https://learn.microsoft.com/en-us/intune/intune-service/fundamentals/what-is-intune\">Microsoft Intune</a> or <a href=\"https://www.redhat.com/en/ansible-collaborative\">Ansible</a> to streamline deployment and monitor Shim usage across environments.</li>\n<li>Design boot recovery strategies, including USB live images or dedicated recovery partitions, to ensure system bootability in case of Shim-related failures.</li>\n<li>Maintain version history and SHA-256 checksum records to support validation and forensic investigation when needed.</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"References\"><a href=\"#References\" class=\"headerlink\" title=\"References\"></a>References</h2><ol>\n<li>Black Hat EU 2015 Whitepaper - <a href=\"https://www.blackhat.com/docs/eu-15/materials/eu-15-Pierce-Defending-Against-Malicious-Application-Compatibility-Shims-wp.pdf\">Defending Against Malicious Application Compatibility Shims</a></li>\n<li>F-Secure Blog Post - <a href=\"https://blog.f-secure.com/hunting-for-application-shim-databases/\">Hunting for Application Shim Databases</a></li>\n<li>Google Cloud - <a href=\"https://cloud.google.com/blog/topics/threat-intelligence/fin7-shim-databases-persistence/\">FIN7 Leveraging Shim Databases</a></li>\n</ol>\n"},{"title":"深入解析 Shim：Windows 相容性修正與 Linux Secure Boot 信任鏈核心","date":"2025-04-10T12:00:00.000Z","cover_image":"https://kevinchiu923.github.io/post/深入解析-Shim：Windows-相容性修正與-Linux-Secure-Boot-信任鏈核心/zhtw_cover_img.png","_content":"Shim 是一種關鍵的系統中介技術，透過 API 攔截或簽章驗證，提供應用程式相容性與Secure Boot 安全性，但同時也可能成為資安攻擊的切入點。\n本文將著重介紹 Shim 的運作原理、實作方式、潛在風險與對應防護策略。\n\n## 前言：Shim 是什麼？\n\n在資訊系統中，Shim 是一種中介程式，負責「橋接」兩個不相容或無法直接溝通的系統元件；就如同機械工程中的 [墊片(gasket)](https://www.tfhc-oilseal.com/Gasketseal/%E5%BB%B6%E9%95%B7%E8%A8%AD%E5%82%99%E5%A3%BD%E5%91%BD,%E5%A2%9E%E5%8A%A0%E7%94%A2%E8%83%BD%E7%9A%84%E9%97%9C%E9%8D%B5%E9%9B%B6%E7%B5%84%E4%BB%B6-%E7%A9%BA%E5%A3%93%E6%B2%B9%E5%B0%81%E5%A2%8A%E7%89%87/) 一樣，用來填補介面之間的落差。Shim 可以在兩個元件之間增加一層轉換層，讓它們得以協同運作。\n\n在電腦系統中，Shim 的形式多樣，但核心目的都是**攔截或調整原始行為，實現相容性或安全性**；本文將深入探討 Shim 在兩個主流作業系統中的應用：\n\n- **Windows - Application Shim**：以「應用程式相容性 Shim」為主，處理老舊軟體與新系統間的相容問題。\n- **Linux - Secure Boot Shim（UEFI 環境）**：Shim 作為 Secure Boot 信任鏈的第一環，確保開機流程安全性。\n\n\n## Shim 在 Windows 與 Linux 中的差異比較\n\n| 項目 | Windows Application Shim | Linux Secure Boot Shim |\n| --- | --- | --- |\n| 主要用途 | 解決舊應用與新版系統的相容性問題 | 建立 Secure Boot 的信任鏈起點 |\n| 執行階段 | 使用者層級（User-mode） | 開機初期（UEFI Boot） |\n| 主要功能 | 攔截 API、修改行為、模擬舊系統 | 驗證 GRUB 與 Kernel 的數位簽章 |\n| 安裝方式 | 利用 `.sdb` 資料庫，透過工具安裝 | 隨發行版安裝的簽署程式（由微軟簽章） |\n| 安全風險 | 可被惡意利用進行 Shim Injection | 過時 shim 版本有繞過 Secure Boot 的風險 |\n| 常見應用 | 公司內部無法更新的舊系統、老遊戲 | 雙開系統、Linux 雲端映像啟動 |\n\n\n## Windows：Application Compatibility Shim 的實作與資安考量\n\n### 1. 應用場景與目的\n\nWindows Shim 主要解決因作業系統升級導致的應用程式不相容問題。透過**攔截應用程式對 API 的呼叫**，進行行為轉換或版本「偽裝」，讓老程式能「誤以為」自己仍在舊環境執行。\n\n### 2. 核心機制與運作原理\n\n- **Shim 資料庫（.sdb）**：記錄程式與修正規則的對應。\n- **Shim Engine**：動態攔截 API 呼叫，透過 DLL 注入來修改執行邏輯。\n- **Compatibility Administrator 工具**：可自訂並安裝 Shim 修正組。\n\n### 3. 建立自訂 Shim 的指令範例：\n\n```bash\n# 使用 Compatibility Administrator 建立 .sdb 後\nsdbinst.exe C:\\path\\to\\custom_shim.sdb\n```\n\n### 4. 查詢已安裝的 Shim 資料庫\n- **適用於舊版 Windows：**\n若使用的是舊版本的 Windows (如: Windows 7/8)，根據早期的技術資料中可以使用以下 PowerShell 指令列出安裝過的自訂 `.sdb` (參考資料 [1][2]):\n    ```bash\n    reg query \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\InstalledSDB\"\n    ```\n\n- **適用於新版 Windows：**\n若使用的是較新版本的 Windows (如: Windows 10/11)，以上述指令執行可能會發生查找不到的狀況。這是因為新版本中的 `AppCompat` 資料庫雖然存在，但不一定會出現在 `InstalledSDB` 下，而是散布在其他註冊機碼 (registry key) 中，可用以下兩種 PowerShell 指令查詢:\n    - 列出針對特定路徑的應用程式所套用的 Shim 行為，也就是「Custom Shim」\n        ```bash\n        reg query \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Custom\"\n        ```\n    - 顯示使用者手動設定的相容性層（Compatibility Layers），例如用滑鼠右鍵設定「以 Windows 7 相容模式執行」的那些項目\n        ```bash\n        reg query \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Layers\"\n        ```\n\n\n**為什麼找不到 InstalledSDB？**\n至於為什麼新版本 Windows 中會有 `InstalledSDB` 缺失的問題呢? 主要原因有以下三點:\n1. 並非所有 `.sdb` 安裝都會登記在 InstalledSDB 下\n2. 有些系統版本根本不建立這個鍵值\n3. 微軟改變了 Shim 的儲存或管理方式（特別是近年趨向 WDAC 和 AppLocker 等更嚴格控管）\n\n### 5. 常見 Shim 應用實例\n\n- `VersionLie`：偽裝成特定 Windows 版本\n- `ForceAdminAccess`：欺騙應用程式認為目前使用者是 Admin\n- `CorrectFilePaths`：將檔案路徑重導至現代系統中可用位置\n\n### 6. 資安風險：Shim Injection\n\n攻擊者可自製 `.sdb` 檔並利用 `sdbinst.exe` 安裝至系統中，當使用者啟動特定程式時，自動注入惡意程式碼。例如[知名駭客集團 FIN7](https://malpedia.caad.fkie.fraunhofer.de/actor/fin7) 就曾使用此技術 (參考資料 [3])。\n\n\n## Linux：Shim Loader 在 Secure Boot 中的角色與實踐\n\n### 1. Secure Boot 簡介\n\nUEFI Secure Boot 確保開機流程中執行的程式碼皆經由簽章驗證。韌體通常僅信任由微軟 UEFI CA 所簽署的開機元件。\n\n### 2. Linux 為什麼需要 Shim？\n\nLinux 發行版透過 shim 避免每次 kernel 或 bootloader 更新都需向微軟簽章。\nShim 自身由微軟簽署，而它內嵌的發行版公鑰可用來驗證 GRUB 與 Linux kernel。\n\n### 3. 運作流程：Shim 的三段式信任鏈 (Three-stage Trust Chain)\n三段式信任鏈是 Linux 在 UEFI Secure Boot 環境中，用以確保開機流程安全與完整性的核心架構。\n其主要目的，是確保從 UEFI 韌體啟動開始，經由 GRUB，到最終載入 Linux 核心的每一個階段裡所執行的元件皆為經簽章驗證、未遭竄改可信的程式碼。\n\n整體信任鏈依序包含 Firmware、Shim、GRUB 與 Kernel 四個關鍵元件，其中每一階段的簽章與驗證機制，分別由不同單位負責：\nFirmware 通常由硬體廠商提供，Shim 則由 Linux 發行版開發並交由微軟簽章，GRUB 和 Kernel 則由發行版簽署，並透過 Shim 或 MOK 機制進行驗證，共同構成一條完整且可追溯的信任路徑。\n\n![](https://kevinchiu923.github.io/post/深入解析-Shim：Windows-相容性修正與-Linux-Secure-Boot-信任鏈核心/Three-stage-Trust-Chain.jpeg)\n\n詳細流程如下：\n\n**Step 1：Firmware → shim(由微軟簽署)**\n| 項目 |說明 |\n| -------- | -------- |\n| 啟動元件     | UEFI 固件     |\n| 執行對象     | shimx64.efi (由 Linux 發行版提供，已由微軟簽章)     |\n| 驗證方式     | 使用 Microsoft UEFI CA 簽章來驗證 Shim |\n| 目標     | 讓非微軟提供的 bootloader (如 GRUB)能在 Secure Boot 下被合法載入     |\n\n**Step 2：shim → GRUB (或其他 bootloader)（由發行版簽署)**\n| 項目 |說明 |\n| -------- | -------- |\n| 啟動元件     | shimx64.efi     |\n| 執行對象     | grubx64.efi (由 Linux 發行版簽章)     |\n| 驗證方式     | 使用內嵌在 Shim 中的公鑰，或從 MOK (Machine Owner Key) 資料庫驗證 |\n| 目標     | 載入下一階段 bootloader (如 GRUB)，建立信任傳遞關係     |\n\n**Step 3：GRUB → Kernel（使用 shim 提供之驗證功能）**\n| 項目 |說明 |\n| -------- | -------- |\n| 啟動元件     | GRUB     |\n| 執行對象     | vmlinux (Linuex kernel 映像檔)     |\n| 驗證方式     | 使用 Shim 或 GRUB 的簽章驗證模組，驗證 kernel 簽章 |\n| 目標     |確保啟動的 kernel 也經過驗證  |\n\n這三個階段分別由微軟、Linux 發行版與使用者管理，形成一條 **「分層簽署、階段驗證」** 的完整分層信任架構。\n\n### 4. 管理自簽金鑰：MOK（Machine Owner Key）\n\n允許使用者手動註冊自定義簽名金鑰，然後可以使用這些金鑰來驗證第三方驅動程式或自定義編譯的 Linux 內核。\n註冊后，相應的公鑰將儲存在 [NVRAM（非揮發記憶體）](https://en.wikipedia.org/wiki/Non-volatile_memory)中成為安全啟動驗證過程的一部分，並在 Secure Boot 流程中由 [MokManager](https://github.com/hakuna-m/wubiuefi/wiki/MOKManager) 處理。\n\n\n新增 MOK 流程（以 Ubuntu 為例）：\n```bash\nsudo mokutil --import my_key_pub.der\n# 系統將提示設定密碼，重新開機後進入 MokManager 加入金鑰\n```\n\n### 5. 相關資安風險回顧\n於 2020 年爆出的 **BootHole ([CVE-2020-10713](https://nvd.nist.gov/vuln/detail/cve-2020-10713))** 漏洞，促使了整個 UEFI Secure Boot 生態系迎來一場大革新。\n這個漏洞存在於 GRUB2 bootloader 的設定解析邏輯中，攻擊者可以藉由篡改 grub.cfg 來注入惡意程式碼，即使在 Secure Boot 啟用的情況下，也能繞過驗證機制、執行未經簽署的內容。\n這不僅暴露了 Secure Boot 信任鏈的單點風險，更凸顯了傳統撤銷 (revocation) 機制（如 dbx）的侷限性。\n\n為了解決這類系統性風險，Linux 社群與多家 UEFI 相關廠商（如 Canonical、Red Hat 等）合作，設計出一套名為 **[SBAT（Secure Boot Advanced Targeting）](https://www.gnu.org/software/grub/manual/grub/html_node/Secure-Boot-Advanced-Targeting.html)** 的新機制。\nSBAT 允許系統更精確的辨識和撤銷具有風險的開機元件版本，例如特定版本的 shim、GRUB 或 Linux kernel，避免因一次撤銷而連帶影響所有使用者與版本，提升了 Secure Boot 的彈性與可維運性。\n\n## 結語：Shim 是一把雙面刃\n\nShim 在現代系統中扮演橋樑角色：\n\n- Windows 的 Shim 強化了舊應用程式的生命週期\n- Linux 的 Shim 維繫 Secure Boot 的完整性與信任鏈\n\n唯有深入理解其機制，才能有效運用其優勢、提早防範可能的安全風險。\n\n### 為什麼說 Shim 是雙面刃？\n#### 優點：\n- **維持相容與開放性**：Shim 提供了強大的彈性與便利性，允許舊應用程式或自訂驅動在現代環境中繼續運作，降低維護與升級成本。\n\n#### 缺點：\n- **潛在安全破口**：同樣的機制若被濫用，可能成為惡意程式碼的載具，例如 Windows 中的 Shim injection 或 Linux 過期 shim 被攻擊者利用。\n- **信任鏈單點風險**：特別在 Secure Boot 環境中，shim 是信任鏈的起點，一旦 shim 本身有漏洞或被取代，整條信任機制將形同虛設。\n- **維護成本與撤銷困難**：Shim 一旦廣泛部署，若需進行更新（如 SBAT 撤銷）常會伴隨使用者無法開機等風險與操作複雜度。\n\n因此，在部署與使用 shim 時，應同時考慮便利性與安全性，並持續追蹤官方針對 shim 更新與安全通報。\n\n### 因應對策與防護建議\n在實際部署中，建議企業與開發人員落實版本控管、簽章政策與集中式管理機制，並持續關注 Shim 與 Secure Boot 的安全通報，以降低潛在攻擊風險。具體如下：\n1. 維持相容與開放性\n    - 僅針對無可替代的關鍵應用程式使用 Shim，避免全面啟用造成過度依賴。\n    - 導入完整的變更控管(Change Control / Change Management) 與測試流程(如 [ISO/IEC 27001](https://www.iso.org/standard/27001)、[NIST 800-53](https://csrc.nist.gov/pubs/sp/800/53/r5/upd1/final))，針對每項 Shim 設定進行風險評估、功能驗證與版本記錄，以確保相容性需求與系統安全性之間的平衡。\n    - 搭配應用程式白名單機制（如 [AppLocker](https://learn.microsoft.com/en-us/windows/security/application-security/application-control/app-control-for-business/applocker/what-is-applocker)、[WDAC](https://learn.microsoft.com/en-us/hololens/windows-defender-application-control-wdac)）限制執行來源。\n2. 潛在安全破口\n    - 建立監控機制，偵測如 sdbinst.exe 執行、異常的 Shim 資料庫變更等行為。\n    - 僅授予系統管理員權限安裝 Shim，並限制使用者層級存取 Shim 管理工具。\n    - 定期稽核 %WINDIR%\\AppPatch\\Custom\\ 和註冊機碼下的 Shim 記錄。\n3. 信任鏈單點風險\n    - 僅使用官方發行、由 Microsoft 簽署的 shim 映像檔。\n    - 部署支援 SBAT 的 shim 版本，以便精確撤銷與進行版本管控。\n    - 定期更新 shim、GRUB、Kernel 與 UEFI 韌體，以防範已知漏洞。\n4. 維護成本與撤銷困難\n    - 使用集中化管理工具（如 [Intune](https://learn.microsoft.com/en-us/intune/intune-service/fundamentals/what-is-intune)、[Ansible](https://www.redhat.com/en/ansible-collaborative)）統一佈署與監控 Shim 使用情形。\n    - 規劃開機備援方案，例如 USB live 磁區、Recovery 分割區，以因應 Shim 更新後的開機失敗。\n    - 建立版本記錄與 SHA256 雜湊校驗機制，以利驗證與回溯分析。\n\n## 參考資料\n[1] Black Hat Europe 2015 Whitepaper -[《Defending Against Malicious Application Compatibility Shims》](https://www.blackhat.com/docs/eu-15/materials/eu-15-Pierce-Defending-Against-Malicious-Application-Compatibility-Shims-wp.pdf)\n[2] F-Secure Blog post - [《Hunting for Application Shim Databases》](https://blog.f-secure.com/hunting-for-application-shim-databases/)\n[3] Google Cloud - [To SDB, Or Not To SDB: FIN7 Leveraging Shim Databases for Persistence](https://cloud.google.com/blog/topics/threat-intelligence/fin7-shim-databases-persistence/)","source":"_posts/深入解析-Shim：Windows-相容性修正與-Linux-Secure-Boot-信任鏈核心.md","raw":"---\ntitle: 深入解析 Shim：Windows 相容性修正與 Linux Secure Boot 信任鏈核心\ndate: 2025-04-10 20:00:00\ntags:\n  - Traditional Chinese\n  - Windows\n  - Linux\n  - 資訊安全\ncategories:\n  - Knowledge base\ncover_image: 'https://kevinchiu923.github.io/post/深入解析-Shim：Windows-相容性修正與-Linux-Secure-Boot-信任鏈核心/zhtw_cover_img.png'\n---\nShim 是一種關鍵的系統中介技術，透過 API 攔截或簽章驗證，提供應用程式相容性與Secure Boot 安全性，但同時也可能成為資安攻擊的切入點。\n本文將著重介紹 Shim 的運作原理、實作方式、潛在風險與對應防護策略。\n\n## 前言：Shim 是什麼？\n\n在資訊系統中，Shim 是一種中介程式，負責「橋接」兩個不相容或無法直接溝通的系統元件；就如同機械工程中的 [墊片(gasket)](https://www.tfhc-oilseal.com/Gasketseal/%E5%BB%B6%E9%95%B7%E8%A8%AD%E5%82%99%E5%A3%BD%E5%91%BD,%E5%A2%9E%E5%8A%A0%E7%94%A2%E8%83%BD%E7%9A%84%E9%97%9C%E9%8D%B5%E9%9B%B6%E7%B5%84%E4%BB%B6-%E7%A9%BA%E5%A3%93%E6%B2%B9%E5%B0%81%E5%A2%8A%E7%89%87/) 一樣，用來填補介面之間的落差。Shim 可以在兩個元件之間增加一層轉換層，讓它們得以協同運作。\n\n在電腦系統中，Shim 的形式多樣，但核心目的都是**攔截或調整原始行為，實現相容性或安全性**；本文將深入探討 Shim 在兩個主流作業系統中的應用：\n\n- **Windows - Application Shim**：以「應用程式相容性 Shim」為主，處理老舊軟體與新系統間的相容問題。\n- **Linux - Secure Boot Shim（UEFI 環境）**：Shim 作為 Secure Boot 信任鏈的第一環，確保開機流程安全性。\n\n\n## Shim 在 Windows 與 Linux 中的差異比較\n\n| 項目 | Windows Application Shim | Linux Secure Boot Shim |\n| --- | --- | --- |\n| 主要用途 | 解決舊應用與新版系統的相容性問題 | 建立 Secure Boot 的信任鏈起點 |\n| 執行階段 | 使用者層級（User-mode） | 開機初期（UEFI Boot） |\n| 主要功能 | 攔截 API、修改行為、模擬舊系統 | 驗證 GRUB 與 Kernel 的數位簽章 |\n| 安裝方式 | 利用 `.sdb` 資料庫，透過工具安裝 | 隨發行版安裝的簽署程式（由微軟簽章） |\n| 安全風險 | 可被惡意利用進行 Shim Injection | 過時 shim 版本有繞過 Secure Boot 的風險 |\n| 常見應用 | 公司內部無法更新的舊系統、老遊戲 | 雙開系統、Linux 雲端映像啟動 |\n\n\n## Windows：Application Compatibility Shim 的實作與資安考量\n\n### 1. 應用場景與目的\n\nWindows Shim 主要解決因作業系統升級導致的應用程式不相容問題。透過**攔截應用程式對 API 的呼叫**，進行行為轉換或版本「偽裝」，讓老程式能「誤以為」自己仍在舊環境執行。\n\n### 2. 核心機制與運作原理\n\n- **Shim 資料庫（.sdb）**：記錄程式與修正規則的對應。\n- **Shim Engine**：動態攔截 API 呼叫，透過 DLL 注入來修改執行邏輯。\n- **Compatibility Administrator 工具**：可自訂並安裝 Shim 修正組。\n\n### 3. 建立自訂 Shim 的指令範例：\n\n```bash\n# 使用 Compatibility Administrator 建立 .sdb 後\nsdbinst.exe C:\\path\\to\\custom_shim.sdb\n```\n\n### 4. 查詢已安裝的 Shim 資料庫\n- **適用於舊版 Windows：**\n若使用的是舊版本的 Windows (如: Windows 7/8)，根據早期的技術資料中可以使用以下 PowerShell 指令列出安裝過的自訂 `.sdb` (參考資料 [1][2]):\n    ```bash\n    reg query \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\InstalledSDB\"\n    ```\n\n- **適用於新版 Windows：**\n若使用的是較新版本的 Windows (如: Windows 10/11)，以上述指令執行可能會發生查找不到的狀況。這是因為新版本中的 `AppCompat` 資料庫雖然存在，但不一定會出現在 `InstalledSDB` 下，而是散布在其他註冊機碼 (registry key) 中，可用以下兩種 PowerShell 指令查詢:\n    - 列出針對特定路徑的應用程式所套用的 Shim 行為，也就是「Custom Shim」\n        ```bash\n        reg query \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Custom\"\n        ```\n    - 顯示使用者手動設定的相容性層（Compatibility Layers），例如用滑鼠右鍵設定「以 Windows 7 相容模式執行」的那些項目\n        ```bash\n        reg query \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Layers\"\n        ```\n\n\n**為什麼找不到 InstalledSDB？**\n至於為什麼新版本 Windows 中會有 `InstalledSDB` 缺失的問題呢? 主要原因有以下三點:\n1. 並非所有 `.sdb` 安裝都會登記在 InstalledSDB 下\n2. 有些系統版本根本不建立這個鍵值\n3. 微軟改變了 Shim 的儲存或管理方式（特別是近年趨向 WDAC 和 AppLocker 等更嚴格控管）\n\n### 5. 常見 Shim 應用實例\n\n- `VersionLie`：偽裝成特定 Windows 版本\n- `ForceAdminAccess`：欺騙應用程式認為目前使用者是 Admin\n- `CorrectFilePaths`：將檔案路徑重導至現代系統中可用位置\n\n### 6. 資安風險：Shim Injection\n\n攻擊者可自製 `.sdb` 檔並利用 `sdbinst.exe` 安裝至系統中，當使用者啟動特定程式時，自動注入惡意程式碼。例如[知名駭客集團 FIN7](https://malpedia.caad.fkie.fraunhofer.de/actor/fin7) 就曾使用此技術 (參考資料 [3])。\n\n\n## Linux：Shim Loader 在 Secure Boot 中的角色與實踐\n\n### 1. Secure Boot 簡介\n\nUEFI Secure Boot 確保開機流程中執行的程式碼皆經由簽章驗證。韌體通常僅信任由微軟 UEFI CA 所簽署的開機元件。\n\n### 2. Linux 為什麼需要 Shim？\n\nLinux 發行版透過 shim 避免每次 kernel 或 bootloader 更新都需向微軟簽章。\nShim 自身由微軟簽署，而它內嵌的發行版公鑰可用來驗證 GRUB 與 Linux kernel。\n\n### 3. 運作流程：Shim 的三段式信任鏈 (Three-stage Trust Chain)\n三段式信任鏈是 Linux 在 UEFI Secure Boot 環境中，用以確保開機流程安全與完整性的核心架構。\n其主要目的，是確保從 UEFI 韌體啟動開始，經由 GRUB，到最終載入 Linux 核心的每一個階段裡所執行的元件皆為經簽章驗證、未遭竄改可信的程式碼。\n\n整體信任鏈依序包含 Firmware、Shim、GRUB 與 Kernel 四個關鍵元件，其中每一階段的簽章與驗證機制，分別由不同單位負責：\nFirmware 通常由硬體廠商提供，Shim 則由 Linux 發行版開發並交由微軟簽章，GRUB 和 Kernel 則由發行版簽署，並透過 Shim 或 MOK 機制進行驗證，共同構成一條完整且可追溯的信任路徑。\n\n![](https://kevinchiu923.github.io/post/深入解析-Shim：Windows-相容性修正與-Linux-Secure-Boot-信任鏈核心/Three-stage-Trust-Chain.jpeg)\n\n詳細流程如下：\n\n**Step 1：Firmware → shim(由微軟簽署)**\n| 項目 |說明 |\n| -------- | -------- |\n| 啟動元件     | UEFI 固件     |\n| 執行對象     | shimx64.efi (由 Linux 發行版提供，已由微軟簽章)     |\n| 驗證方式     | 使用 Microsoft UEFI CA 簽章來驗證 Shim |\n| 目標     | 讓非微軟提供的 bootloader (如 GRUB)能在 Secure Boot 下被合法載入     |\n\n**Step 2：shim → GRUB (或其他 bootloader)（由發行版簽署)**\n| 項目 |說明 |\n| -------- | -------- |\n| 啟動元件     | shimx64.efi     |\n| 執行對象     | grubx64.efi (由 Linux 發行版簽章)     |\n| 驗證方式     | 使用內嵌在 Shim 中的公鑰，或從 MOK (Machine Owner Key) 資料庫驗證 |\n| 目標     | 載入下一階段 bootloader (如 GRUB)，建立信任傳遞關係     |\n\n**Step 3：GRUB → Kernel（使用 shim 提供之驗證功能）**\n| 項目 |說明 |\n| -------- | -------- |\n| 啟動元件     | GRUB     |\n| 執行對象     | vmlinux (Linuex kernel 映像檔)     |\n| 驗證方式     | 使用 Shim 或 GRUB 的簽章驗證模組，驗證 kernel 簽章 |\n| 目標     |確保啟動的 kernel 也經過驗證  |\n\n這三個階段分別由微軟、Linux 發行版與使用者管理，形成一條 **「分層簽署、階段驗證」** 的完整分層信任架構。\n\n### 4. 管理自簽金鑰：MOK（Machine Owner Key）\n\n允許使用者手動註冊自定義簽名金鑰，然後可以使用這些金鑰來驗證第三方驅動程式或自定義編譯的 Linux 內核。\n註冊后，相應的公鑰將儲存在 [NVRAM（非揮發記憶體）](https://en.wikipedia.org/wiki/Non-volatile_memory)中成為安全啟動驗證過程的一部分，並在 Secure Boot 流程中由 [MokManager](https://github.com/hakuna-m/wubiuefi/wiki/MOKManager) 處理。\n\n\n新增 MOK 流程（以 Ubuntu 為例）：\n```bash\nsudo mokutil --import my_key_pub.der\n# 系統將提示設定密碼，重新開機後進入 MokManager 加入金鑰\n```\n\n### 5. 相關資安風險回顧\n於 2020 年爆出的 **BootHole ([CVE-2020-10713](https://nvd.nist.gov/vuln/detail/cve-2020-10713))** 漏洞，促使了整個 UEFI Secure Boot 生態系迎來一場大革新。\n這個漏洞存在於 GRUB2 bootloader 的設定解析邏輯中，攻擊者可以藉由篡改 grub.cfg 來注入惡意程式碼，即使在 Secure Boot 啟用的情況下，也能繞過驗證機制、執行未經簽署的內容。\n這不僅暴露了 Secure Boot 信任鏈的單點風險，更凸顯了傳統撤銷 (revocation) 機制（如 dbx）的侷限性。\n\n為了解決這類系統性風險，Linux 社群與多家 UEFI 相關廠商（如 Canonical、Red Hat 等）合作，設計出一套名為 **[SBAT（Secure Boot Advanced Targeting）](https://www.gnu.org/software/grub/manual/grub/html_node/Secure-Boot-Advanced-Targeting.html)** 的新機制。\nSBAT 允許系統更精確的辨識和撤銷具有風險的開機元件版本，例如特定版本的 shim、GRUB 或 Linux kernel，避免因一次撤銷而連帶影響所有使用者與版本，提升了 Secure Boot 的彈性與可維運性。\n\n## 結語：Shim 是一把雙面刃\n\nShim 在現代系統中扮演橋樑角色：\n\n- Windows 的 Shim 強化了舊應用程式的生命週期\n- Linux 的 Shim 維繫 Secure Boot 的完整性與信任鏈\n\n唯有深入理解其機制，才能有效運用其優勢、提早防範可能的安全風險。\n\n### 為什麼說 Shim 是雙面刃？\n#### 優點：\n- **維持相容與開放性**：Shim 提供了強大的彈性與便利性，允許舊應用程式或自訂驅動在現代環境中繼續運作，降低維護與升級成本。\n\n#### 缺點：\n- **潛在安全破口**：同樣的機制若被濫用，可能成為惡意程式碼的載具，例如 Windows 中的 Shim injection 或 Linux 過期 shim 被攻擊者利用。\n- **信任鏈單點風險**：特別在 Secure Boot 環境中，shim 是信任鏈的起點，一旦 shim 本身有漏洞或被取代，整條信任機制將形同虛設。\n- **維護成本與撤銷困難**：Shim 一旦廣泛部署，若需進行更新（如 SBAT 撤銷）常會伴隨使用者無法開機等風險與操作複雜度。\n\n因此，在部署與使用 shim 時，應同時考慮便利性與安全性，並持續追蹤官方針對 shim 更新與安全通報。\n\n### 因應對策與防護建議\n在實際部署中，建議企業與開發人員落實版本控管、簽章政策與集中式管理機制，並持續關注 Shim 與 Secure Boot 的安全通報，以降低潛在攻擊風險。具體如下：\n1. 維持相容與開放性\n    - 僅針對無可替代的關鍵應用程式使用 Shim，避免全面啟用造成過度依賴。\n    - 導入完整的變更控管(Change Control / Change Management) 與測試流程(如 [ISO/IEC 27001](https://www.iso.org/standard/27001)、[NIST 800-53](https://csrc.nist.gov/pubs/sp/800/53/r5/upd1/final))，針對每項 Shim 設定進行風險評估、功能驗證與版本記錄，以確保相容性需求與系統安全性之間的平衡。\n    - 搭配應用程式白名單機制（如 [AppLocker](https://learn.microsoft.com/en-us/windows/security/application-security/application-control/app-control-for-business/applocker/what-is-applocker)、[WDAC](https://learn.microsoft.com/en-us/hololens/windows-defender-application-control-wdac)）限制執行來源。\n2. 潛在安全破口\n    - 建立監控機制，偵測如 sdbinst.exe 執行、異常的 Shim 資料庫變更等行為。\n    - 僅授予系統管理員權限安裝 Shim，並限制使用者層級存取 Shim 管理工具。\n    - 定期稽核 %WINDIR%\\AppPatch\\Custom\\ 和註冊機碼下的 Shim 記錄。\n3. 信任鏈單點風險\n    - 僅使用官方發行、由 Microsoft 簽署的 shim 映像檔。\n    - 部署支援 SBAT 的 shim 版本，以便精確撤銷與進行版本管控。\n    - 定期更新 shim、GRUB、Kernel 與 UEFI 韌體，以防範已知漏洞。\n4. 維護成本與撤銷困難\n    - 使用集中化管理工具（如 [Intune](https://learn.microsoft.com/en-us/intune/intune-service/fundamentals/what-is-intune)、[Ansible](https://www.redhat.com/en/ansible-collaborative)）統一佈署與監控 Shim 使用情形。\n    - 規劃開機備援方案，例如 USB live 磁區、Recovery 分割區，以因應 Shim 更新後的開機失敗。\n    - 建立版本記錄與 SHA256 雜湊校驗機制，以利驗證與回溯分析。\n\n## 參考資料\n[1] Black Hat Europe 2015 Whitepaper -[《Defending Against Malicious Application Compatibility Shims》](https://www.blackhat.com/docs/eu-15/materials/eu-15-Pierce-Defending-Against-Malicious-Application-Compatibility-Shims-wp.pdf)\n[2] F-Secure Blog post - [《Hunting for Application Shim Databases》](https://blog.f-secure.com/hunting-for-application-shim-databases/)\n[3] Google Cloud - [To SDB, Or Not To SDB: FIN7 Leveraging Shim Databases for Persistence](https://cloud.google.com/blog/topics/threat-intelligence/fin7-shim-databases-persistence/)","slug":"深入解析-Shim：Windows-相容性修正與-Linux-Secure-Boot-信任鏈核心","published":1,"updated":"2025-04-09T21:39:33.504Z","comments":1,"layout":"post","photos":[],"_id":"cm9agcuc70011nc827cqh4zhi","content":"<p>Shim 是一種關鍵的系統中介技術，透過 API 攔截或簽章驗證，提供應用程式相容性與Secure Boot 安全性，但同時也可能成為資安攻擊的切入點。<br>本文將著重介紹 Shim 的運作原理、實作方式、潛在風險與對應防護策略。</p>\n<h2 id=\"前言：Shim-是什麼？\"><a href=\"#前言：Shim-是什麼？\" class=\"headerlink\" title=\"前言：Shim 是什麼？\"></a>前言：Shim 是什麼？</h2><p>在資訊系統中，Shim 是一種中介程式，負責「橋接」兩個不相容或無法直接溝通的系統元件；就如同機械工程中的 <a href=\"https://www.tfhc-oilseal.com/Gasketseal/%E5%BB%B6%E9%95%B7%E8%A8%AD%E5%82%99%E5%A3%BD%E5%91%BD,%E5%A2%9E%E5%8A%A0%E7%94%A2%E8%83%BD%E7%9A%84%E9%97%9C%E9%8D%B5%E9%9B%B6%E7%B5%84%E4%BB%B6-%E7%A9%BA%E5%A3%93%E6%B2%B9%E5%B0%81%E5%A2%8A%E7%89%87/\">墊片(gasket)</a> 一樣，用來填補介面之間的落差。Shim 可以在兩個元件之間增加一層轉換層，讓它們得以協同運作。</p>\n<p>在電腦系統中，Shim 的形式多樣，但核心目的都是<strong>攔截或調整原始行為，實現相容性或安全性</strong>；本文將深入探討 Shim 在兩個主流作業系統中的應用：</p>\n<ul>\n<li><strong>Windows - Application Shim</strong>：以「應用程式相容性 Shim」為主，處理老舊軟體與新系統間的相容問題。</li>\n<li><strong>Linux - Secure Boot Shim（UEFI 環境）</strong>：Shim 作為 Secure Boot 信任鏈的第一環，確保開機流程安全性。</li>\n</ul>\n<h2 id=\"Shim-在-Windows-與-Linux-中的差異比較\"><a href=\"#Shim-在-Windows-與-Linux-中的差異比較\" class=\"headerlink\" title=\"Shim 在 Windows 與 Linux 中的差異比較\"></a>Shim 在 Windows 與 Linux 中的差異比較</h2><table>\n<thead>\n<tr>\n<th>項目</th>\n<th>Windows Application Shim</th>\n<th>Linux Secure Boot Shim</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>主要用途</td>\n<td>解決舊應用與新版系統的相容性問題</td>\n<td>建立 Secure Boot 的信任鏈起點</td>\n</tr>\n<tr>\n<td>執行階段</td>\n<td>使用者層級（User-mode）</td>\n<td>開機初期（UEFI Boot）</td>\n</tr>\n<tr>\n<td>主要功能</td>\n<td>攔截 API、修改行為、模擬舊系統</td>\n<td>驗證 GRUB 與 Kernel 的數位簽章</td>\n</tr>\n<tr>\n<td>安裝方式</td>\n<td>利用 <code>.sdb</code> 資料庫，透過工具安裝</td>\n<td>隨發行版安裝的簽署程式（由微軟簽章）</td>\n</tr>\n<tr>\n<td>安全風險</td>\n<td>可被惡意利用進行 Shim Injection</td>\n<td>過時 shim 版本有繞過 Secure Boot 的風險</td>\n</tr>\n<tr>\n<td>常見應用</td>\n<td>公司內部無法更新的舊系統、老遊戲</td>\n<td>雙開系統、Linux 雲端映像啟動</td>\n</tr>\n</tbody></table>\n<h2 id=\"Windows：Application-Compatibility-Shim-的實作與資安考量\"><a href=\"#Windows：Application-Compatibility-Shim-的實作與資安考量\" class=\"headerlink\" title=\"Windows：Application Compatibility Shim 的實作與資安考量\"></a>Windows：Application Compatibility Shim 的實作與資安考量</h2><h3 id=\"1-應用場景與目的\"><a href=\"#1-應用場景與目的\" class=\"headerlink\" title=\"1. 應用場景與目的\"></a>1. 應用場景與目的</h3><p>Windows Shim 主要解決因作業系統升級導致的應用程式不相容問題。透過<strong>攔截應用程式對 API 的呼叫</strong>，進行行為轉換或版本「偽裝」，讓老程式能「誤以為」自己仍在舊環境執行。</p>\n<h3 id=\"2-核心機制與運作原理\"><a href=\"#2-核心機制與運作原理\" class=\"headerlink\" title=\"2. 核心機制與運作原理\"></a>2. 核心機制與運作原理</h3><ul>\n<li><strong>Shim 資料庫（.sdb）</strong>：記錄程式與修正規則的對應。</li>\n<li><strong>Shim Engine</strong>：動態攔截 API 呼叫，透過 DLL 注入來修改執行邏輯。</li>\n<li><strong>Compatibility Administrator 工具</strong>：可自訂並安裝 Shim 修正組。</li>\n</ul>\n<h3 id=\"3-建立自訂-Shim-的指令範例：\"><a href=\"#3-建立自訂-Shim-的指令範例：\" class=\"headerlink\" title=\"3. 建立自訂 Shim 的指令範例：\"></a>3. 建立自訂 Shim 的指令範例：</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 使用 Compatibility Administrator 建立 .sdb 後</span></span><br><span class=\"line\">sdbinst.exe C:\\path\\to\\custom_shim.sdb</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-查詢已安裝的-Shim-資料庫\"><a href=\"#4-查詢已安裝的-Shim-資料庫\" class=\"headerlink\" title=\"4. 查詢已安裝的 Shim 資料庫\"></a>4. 查詢已安裝的 Shim 資料庫</h3><ul>\n<li><p><strong>適用於舊版 Windows：</strong><br>若使用的是舊版本的 Windows (如: Windows 7&#x2F;8)，根據早期的技術資料中可以使用以下 PowerShell 指令列出安裝過的自訂 <code>.sdb</code> (參考資料 [1][2]):</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">reg query <span class=\"string\">&quot;HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\InstalledSDB&quot;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p><strong>適用於新版 Windows：</strong><br>若使用的是較新版本的 Windows (如: Windows 10&#x2F;11)，以上述指令執行可能會發生查找不到的狀況。這是因為新版本中的 <code>AppCompat</code> 資料庫雖然存在，但不一定會出現在 <code>InstalledSDB</code> 下，而是散布在其他註冊機碼 (registry key) 中，可用以下兩種 PowerShell 指令查詢:</p>\n<ul>\n<li>列出針對特定路徑的應用程式所套用的 Shim 行為，也就是「Custom Shim」  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">reg query <span class=\"string\">&quot;HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Custom&quot;</span></span><br></pre></td></tr></table></figure></li>\n<li>顯示使用者手動設定的相容性層（Compatibility Layers），例如用滑鼠右鍵設定「以 Windows 7 相容模式執行」的那些項目  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">reg query <span class=\"string\">&quot;HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Layers&quot;</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<p><strong>為什麼找不到 InstalledSDB？</strong><br>至於為什麼新版本 Windows 中會有 <code>InstalledSDB</code> 缺失的問題呢? 主要原因有以下三點:</p>\n<ol>\n<li>並非所有 <code>.sdb</code> 安裝都會登記在 InstalledSDB 下</li>\n<li>有些系統版本根本不建立這個鍵值</li>\n<li>微軟改變了 Shim 的儲存或管理方式（特別是近年趨向 WDAC 和 AppLocker 等更嚴格控管）</li>\n</ol>\n<h3 id=\"5-常見-Shim-應用實例\"><a href=\"#5-常見-Shim-應用實例\" class=\"headerlink\" title=\"5. 常見 Shim 應用實例\"></a>5. 常見 Shim 應用實例</h3><ul>\n<li><code>VersionLie</code>：偽裝成特定 Windows 版本</li>\n<li><code>ForceAdminAccess</code>：欺騙應用程式認為目前使用者是 Admin</li>\n<li><code>CorrectFilePaths</code>：將檔案路徑重導至現代系統中可用位置</li>\n</ul>\n<h3 id=\"6-資安風險：Shim-Injection\"><a href=\"#6-資安風險：Shim-Injection\" class=\"headerlink\" title=\"6. 資安風險：Shim Injection\"></a>6. 資安風險：Shim Injection</h3><p>攻擊者可自製 <code>.sdb</code> 檔並利用 <code>sdbinst.exe</code> 安裝至系統中，當使用者啟動特定程式時，自動注入惡意程式碼。例如<a href=\"https://malpedia.caad.fkie.fraunhofer.de/actor/fin7\">知名駭客集團 FIN7</a> 就曾使用此技術 (參考資料 [3])。</p>\n<h2 id=\"Linux：Shim-Loader-在-Secure-Boot-中的角色與實踐\"><a href=\"#Linux：Shim-Loader-在-Secure-Boot-中的角色與實踐\" class=\"headerlink\" title=\"Linux：Shim Loader 在 Secure Boot 中的角色與實踐\"></a>Linux：Shim Loader 在 Secure Boot 中的角色與實踐</h2><h3 id=\"1-Secure-Boot-簡介\"><a href=\"#1-Secure-Boot-簡介\" class=\"headerlink\" title=\"1. Secure Boot 簡介\"></a>1. Secure Boot 簡介</h3><p>UEFI Secure Boot 確保開機流程中執行的程式碼皆經由簽章驗證。韌體通常僅信任由微軟 UEFI CA 所簽署的開機元件。</p>\n<h3 id=\"2-Linux-為什麼需要-Shim？\"><a href=\"#2-Linux-為什麼需要-Shim？\" class=\"headerlink\" title=\"2. Linux 為什麼需要 Shim？\"></a>2. Linux 為什麼需要 Shim？</h3><p>Linux 發行版透過 shim 避免每次 kernel 或 bootloader 更新都需向微軟簽章。<br>Shim 自身由微軟簽署，而它內嵌的發行版公鑰可用來驗證 GRUB 與 Linux kernel。</p>\n<h3 id=\"3-運作流程：Shim-的三段式信任鏈-Three-stage-Trust-Chain\"><a href=\"#3-運作流程：Shim-的三段式信任鏈-Three-stage-Trust-Chain\" class=\"headerlink\" title=\"3. 運作流程：Shim 的三段式信任鏈 (Three-stage Trust Chain)\"></a>3. 運作流程：Shim 的三段式信任鏈 (Three-stage Trust Chain)</h3><p>三段式信任鏈是 Linux 在 UEFI Secure Boot 環境中，用以確保開機流程安全與完整性的核心架構。<br>其主要目的，是確保從 UEFI 韌體啟動開始，經由 GRUB，到最終載入 Linux 核心的每一個階段裡所執行的元件皆為經簽章驗證、未遭竄改可信的程式碼。</p>\n<p>整體信任鏈依序包含 Firmware、Shim、GRUB 與 Kernel 四個關鍵元件，其中每一階段的簽章與驗證機制，分別由不同單位負責：<br>Firmware 通常由硬體廠商提供，Shim 則由 Linux 發行版開發並交由微軟簽章，GRUB 和 Kernel 則由發行版簽署，並透過 Shim 或 MOK 機制進行驗證，共同構成一條完整且可追溯的信任路徑。</p>\n<p><img src=\"https://kevinchiu923.github.io/post/%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90-Shim%EF%BC%9AWindows-%E7%9B%B8%E5%AE%B9%E6%80%A7%E4%BF%AE%E6%AD%A3%E8%88%87-Linux-Secure-Boot-%E4%BF%A1%E4%BB%BB%E9%8F%88%E6%A0%B8%E5%BF%83/Three-stage-Trust-Chain.jpeg\"></p>\n<p>詳細流程如下：</p>\n<p><strong>Step 1：Firmware → shim(由微軟簽署)</strong></p>\n<table>\n<thead>\n<tr>\n<th>項目</th>\n<th>說明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>啟動元件</td>\n<td>UEFI 固件</td>\n</tr>\n<tr>\n<td>執行對象</td>\n<td>shimx64.efi (由 Linux 發行版提供，已由微軟簽章)</td>\n</tr>\n<tr>\n<td>驗證方式</td>\n<td>使用 Microsoft UEFI CA 簽章來驗證 Shim</td>\n</tr>\n<tr>\n<td>目標</td>\n<td>讓非微軟提供的 bootloader (如 GRUB)能在 Secure Boot 下被合法載入</td>\n</tr>\n</tbody></table>\n<p><strong>Step 2：shim → GRUB (或其他 bootloader)（由發行版簽署)</strong></p>\n<table>\n<thead>\n<tr>\n<th>項目</th>\n<th>說明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>啟動元件</td>\n<td>shimx64.efi</td>\n</tr>\n<tr>\n<td>執行對象</td>\n<td>grubx64.efi (由 Linux 發行版簽章)</td>\n</tr>\n<tr>\n<td>驗證方式</td>\n<td>使用內嵌在 Shim 中的公鑰，或從 MOK (Machine Owner Key) 資料庫驗證</td>\n</tr>\n<tr>\n<td>目標</td>\n<td>載入下一階段 bootloader (如 GRUB)，建立信任傳遞關係</td>\n</tr>\n</tbody></table>\n<p><strong>Step 3：GRUB → Kernel（使用 shim 提供之驗證功能）</strong></p>\n<table>\n<thead>\n<tr>\n<th>項目</th>\n<th>說明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>啟動元件</td>\n<td>GRUB</td>\n</tr>\n<tr>\n<td>執行對象</td>\n<td>vmlinux (Linuex kernel 映像檔)</td>\n</tr>\n<tr>\n<td>驗證方式</td>\n<td>使用 Shim 或 GRUB 的簽章驗證模組，驗證 kernel 簽章</td>\n</tr>\n<tr>\n<td>目標</td>\n<td>確保啟動的 kernel 也經過驗證</td>\n</tr>\n</tbody></table>\n<p>這三個階段分別由微軟、Linux 發行版與使用者管理，形成一條 <strong>「分層簽署、階段驗證」</strong> 的完整分層信任架構。</p>\n<h3 id=\"4-管理自簽金鑰：MOK（Machine-Owner-Key）\"><a href=\"#4-管理自簽金鑰：MOK（Machine-Owner-Key）\" class=\"headerlink\" title=\"4. 管理自簽金鑰：MOK（Machine Owner Key）\"></a>4. 管理自簽金鑰：MOK（Machine Owner Key）</h3><p>允許使用者手動註冊自定義簽名金鑰，然後可以使用這些金鑰來驗證第三方驅動程式或自定義編譯的 Linux 內核。<br>註冊后，相應的公鑰將儲存在 <a href=\"https://en.wikipedia.org/wiki/Non-volatile_memory\">NVRAM（非揮發記憶體）</a>中成為安全啟動驗證過程的一部分，並在 Secure Boot 流程中由 <a href=\"https://github.com/hakuna-m/wubiuefi/wiki/MOKManager\">MokManager</a> 處理。</p>\n<p>新增 MOK 流程（以 Ubuntu 為例）：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> mokutil --import my_key_pub.der</span><br><span class=\"line\"><span class=\"comment\"># 系統將提示設定密碼，重新開機後進入 MokManager 加入金鑰</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5-相關資安風險回顧\"><a href=\"#5-相關資安風險回顧\" class=\"headerlink\" title=\"5. 相關資安風險回顧\"></a>5. 相關資安風險回顧</h3><p>於 2020 年爆出的 <strong>BootHole (<a href=\"https://nvd.nist.gov/vuln/detail/cve-2020-10713\">CVE-2020-10713</a>)</strong> 漏洞，促使了整個 UEFI Secure Boot 生態系迎來一場大革新。<br>這個漏洞存在於 GRUB2 bootloader 的設定解析邏輯中，攻擊者可以藉由篡改 grub.cfg 來注入惡意程式碼，即使在 Secure Boot 啟用的情況下，也能繞過驗證機制、執行未經簽署的內容。<br>這不僅暴露了 Secure Boot 信任鏈的單點風險，更凸顯了傳統撤銷 (revocation) 機制（如 dbx）的侷限性。</p>\n<p>為了解決這類系統性風險，Linux 社群與多家 UEFI 相關廠商（如 Canonical、Red Hat 等）合作，設計出一套名為 <strong><a href=\"https://www.gnu.org/software/grub/manual/grub/html_node/Secure-Boot-Advanced-Targeting.html\">SBAT（Secure Boot Advanced Targeting）</a></strong> 的新機制。<br>SBAT 允許系統更精確的辨識和撤銷具有風險的開機元件版本，例如特定版本的 shim、GRUB 或 Linux kernel，避免因一次撤銷而連帶影響所有使用者與版本，提升了 Secure Boot 的彈性與可維運性。</p>\n<h2 id=\"結語：Shim-是一把雙面刃\"><a href=\"#結語：Shim-是一把雙面刃\" class=\"headerlink\" title=\"結語：Shim 是一把雙面刃\"></a>結語：Shim 是一把雙面刃</h2><p>Shim 在現代系統中扮演橋樑角色：</p>\n<ul>\n<li>Windows 的 Shim 強化了舊應用程式的生命週期</li>\n<li>Linux 的 Shim 維繫 Secure Boot 的完整性與信任鏈</li>\n</ul>\n<p>唯有深入理解其機制，才能有效運用其優勢、提早防範可能的安全風險。</p>\n<h3 id=\"為什麼說-Shim-是雙面刃？\"><a href=\"#為什麼說-Shim-是雙面刃？\" class=\"headerlink\" title=\"為什麼說 Shim 是雙面刃？\"></a>為什麼說 Shim 是雙面刃？</h3><h4 id=\"優點：\"><a href=\"#優點：\" class=\"headerlink\" title=\"優點：\"></a>優點：</h4><ul>\n<li><strong>維持相容與開放性</strong>：Shim 提供了強大的彈性與便利性，允許舊應用程式或自訂驅動在現代環境中繼續運作，降低維護與升級成本。</li>\n</ul>\n<h4 id=\"缺點：\"><a href=\"#缺點：\" class=\"headerlink\" title=\"缺點：\"></a>缺點：</h4><ul>\n<li><strong>潛在安全破口</strong>：同樣的機制若被濫用，可能成為惡意程式碼的載具，例如 Windows 中的 Shim injection 或 Linux 過期 shim 被攻擊者利用。</li>\n<li><strong>信任鏈單點風險</strong>：特別在 Secure Boot 環境中，shim 是信任鏈的起點，一旦 shim 本身有漏洞或被取代，整條信任機制將形同虛設。</li>\n<li><strong>維護成本與撤銷困難</strong>：Shim 一旦廣泛部署，若需進行更新（如 SBAT 撤銷）常會伴隨使用者無法開機等風險與操作複雜度。</li>\n</ul>\n<p>因此，在部署與使用 shim 時，應同時考慮便利性與安全性，並持續追蹤官方針對 shim 更新與安全通報。</p>\n<h3 id=\"因應對策與防護建議\"><a href=\"#因應對策與防護建議\" class=\"headerlink\" title=\"因應對策與防護建議\"></a>因應對策與防護建議</h3><p>在實際部署中，建議企業與開發人員落實版本控管、簽章政策與集中式管理機制，並持續關注 Shim 與 Secure Boot 的安全通報，以降低潛在攻擊風險。具體如下：</p>\n<ol>\n<li>維持相容與開放性<ul>\n<li>僅針對無可替代的關鍵應用程式使用 Shim，避免全面啟用造成過度依賴。</li>\n<li>導入完整的變更控管(Change Control &#x2F; Change Management) 與測試流程(如 <a href=\"https://www.iso.org/standard/27001\">ISO&#x2F;IEC 27001</a>、<a href=\"https://csrc.nist.gov/pubs/sp/800/53/r5/upd1/final\">NIST 800-53</a>)，針對每項 Shim 設定進行風險評估、功能驗證與版本記錄，以確保相容性需求與系統安全性之間的平衡。</li>\n<li>搭配應用程式白名單機制（如 <a href=\"https://learn.microsoft.com/en-us/windows/security/application-security/application-control/app-control-for-business/applocker/what-is-applocker\">AppLocker</a>、<a href=\"https://learn.microsoft.com/en-us/hololens/windows-defender-application-control-wdac\">WDAC</a>）限制執行來源。</li>\n</ul>\n</li>\n<li>潛在安全破口<ul>\n<li>建立監控機制，偵測如 sdbinst.exe 執行、異常的 Shim 資料庫變更等行為。</li>\n<li>僅授予系統管理員權限安裝 Shim，並限制使用者層級存取 Shim 管理工具。</li>\n<li>定期稽核 %WINDIR%\\AppPatch\\Custom\\ 和註冊機碼下的 Shim 記錄。</li>\n</ul>\n</li>\n<li>信任鏈單點風險<ul>\n<li>僅使用官方發行、由 Microsoft 簽署的 shim 映像檔。</li>\n<li>部署支援 SBAT 的 shim 版本，以便精確撤銷與進行版本管控。</li>\n<li>定期更新 shim、GRUB、Kernel 與 UEFI 韌體，以防範已知漏洞。</li>\n</ul>\n</li>\n<li>維護成本與撤銷困難<ul>\n<li>使用集中化管理工具（如 <a href=\"https://learn.microsoft.com/en-us/intune/intune-service/fundamentals/what-is-intune\">Intune</a>、<a href=\"https://www.redhat.com/en/ansible-collaborative\">Ansible</a>）統一佈署與監控 Shim 使用情形。</li>\n<li>規劃開機備援方案，例如 USB live 磁區、Recovery 分割區，以因應 Shim 更新後的開機失敗。</li>\n<li>建立版本記錄與 SHA256 雜湊校驗機制，以利驗證與回溯分析。</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"參考資料\"><a href=\"#參考資料\" class=\"headerlink\" title=\"參考資料\"></a>參考資料</h2><p>[1] Black Hat Europe 2015 Whitepaper -<a href=\"https://www.blackhat.com/docs/eu-15/materials/eu-15-Pierce-Defending-Against-Malicious-Application-Compatibility-Shims-wp.pdf\">《Defending Against Malicious Application Compatibility Shims》</a><br>[2] F-Secure Blog post - <a href=\"https://blog.f-secure.com/hunting-for-application-shim-databases/\">《Hunting for Application Shim Databases》</a><br>[3] Google Cloud - <a href=\"https://cloud.google.com/blog/topics/threat-intelligence/fin7-shim-databases-persistence/\">To SDB, Or Not To SDB: FIN7 Leveraging Shim Databases for Persistence</a></p>\n","excerpt":"","more":"<p>Shim 是一種關鍵的系統中介技術，透過 API 攔截或簽章驗證，提供應用程式相容性與Secure Boot 安全性，但同時也可能成為資安攻擊的切入點。<br>本文將著重介紹 Shim 的運作原理、實作方式、潛在風險與對應防護策略。</p>\n<h2 id=\"前言：Shim-是什麼？\"><a href=\"#前言：Shim-是什麼？\" class=\"headerlink\" title=\"前言：Shim 是什麼？\"></a>前言：Shim 是什麼？</h2><p>在資訊系統中，Shim 是一種中介程式，負責「橋接」兩個不相容或無法直接溝通的系統元件；就如同機械工程中的 <a href=\"https://www.tfhc-oilseal.com/Gasketseal/%E5%BB%B6%E9%95%B7%E8%A8%AD%E5%82%99%E5%A3%BD%E5%91%BD,%E5%A2%9E%E5%8A%A0%E7%94%A2%E8%83%BD%E7%9A%84%E9%97%9C%E9%8D%B5%E9%9B%B6%E7%B5%84%E4%BB%B6-%E7%A9%BA%E5%A3%93%E6%B2%B9%E5%B0%81%E5%A2%8A%E7%89%87/\">墊片(gasket)</a> 一樣，用來填補介面之間的落差。Shim 可以在兩個元件之間增加一層轉換層，讓它們得以協同運作。</p>\n<p>在電腦系統中，Shim 的形式多樣，但核心目的都是<strong>攔截或調整原始行為，實現相容性或安全性</strong>；本文將深入探討 Shim 在兩個主流作業系統中的應用：</p>\n<ul>\n<li><strong>Windows - Application Shim</strong>：以「應用程式相容性 Shim」為主，處理老舊軟體與新系統間的相容問題。</li>\n<li><strong>Linux - Secure Boot Shim（UEFI 環境）</strong>：Shim 作為 Secure Boot 信任鏈的第一環，確保開機流程安全性。</li>\n</ul>\n<h2 id=\"Shim-在-Windows-與-Linux-中的差異比較\"><a href=\"#Shim-在-Windows-與-Linux-中的差異比較\" class=\"headerlink\" title=\"Shim 在 Windows 與 Linux 中的差異比較\"></a>Shim 在 Windows 與 Linux 中的差異比較</h2><table>\n<thead>\n<tr>\n<th>項目</th>\n<th>Windows Application Shim</th>\n<th>Linux Secure Boot Shim</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>主要用途</td>\n<td>解決舊應用與新版系統的相容性問題</td>\n<td>建立 Secure Boot 的信任鏈起點</td>\n</tr>\n<tr>\n<td>執行階段</td>\n<td>使用者層級（User-mode）</td>\n<td>開機初期（UEFI Boot）</td>\n</tr>\n<tr>\n<td>主要功能</td>\n<td>攔截 API、修改行為、模擬舊系統</td>\n<td>驗證 GRUB 與 Kernel 的數位簽章</td>\n</tr>\n<tr>\n<td>安裝方式</td>\n<td>利用 <code>.sdb</code> 資料庫，透過工具安裝</td>\n<td>隨發行版安裝的簽署程式（由微軟簽章）</td>\n</tr>\n<tr>\n<td>安全風險</td>\n<td>可被惡意利用進行 Shim Injection</td>\n<td>過時 shim 版本有繞過 Secure Boot 的風險</td>\n</tr>\n<tr>\n<td>常見應用</td>\n<td>公司內部無法更新的舊系統、老遊戲</td>\n<td>雙開系統、Linux 雲端映像啟動</td>\n</tr>\n</tbody></table>\n<h2 id=\"Windows：Application-Compatibility-Shim-的實作與資安考量\"><a href=\"#Windows：Application-Compatibility-Shim-的實作與資安考量\" class=\"headerlink\" title=\"Windows：Application Compatibility Shim 的實作與資安考量\"></a>Windows：Application Compatibility Shim 的實作與資安考量</h2><h3 id=\"1-應用場景與目的\"><a href=\"#1-應用場景與目的\" class=\"headerlink\" title=\"1. 應用場景與目的\"></a>1. 應用場景與目的</h3><p>Windows Shim 主要解決因作業系統升級導致的應用程式不相容問題。透過<strong>攔截應用程式對 API 的呼叫</strong>，進行行為轉換或版本「偽裝」，讓老程式能「誤以為」自己仍在舊環境執行。</p>\n<h3 id=\"2-核心機制與運作原理\"><a href=\"#2-核心機制與運作原理\" class=\"headerlink\" title=\"2. 核心機制與運作原理\"></a>2. 核心機制與運作原理</h3><ul>\n<li><strong>Shim 資料庫（.sdb）</strong>：記錄程式與修正規則的對應。</li>\n<li><strong>Shim Engine</strong>：動態攔截 API 呼叫，透過 DLL 注入來修改執行邏輯。</li>\n<li><strong>Compatibility Administrator 工具</strong>：可自訂並安裝 Shim 修正組。</li>\n</ul>\n<h3 id=\"3-建立自訂-Shim-的指令範例：\"><a href=\"#3-建立自訂-Shim-的指令範例：\" class=\"headerlink\" title=\"3. 建立自訂 Shim 的指令範例：\"></a>3. 建立自訂 Shim 的指令範例：</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 使用 Compatibility Administrator 建立 .sdb 後</span></span><br><span class=\"line\">sdbinst.exe C:\\path\\to\\custom_shim.sdb</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-查詢已安裝的-Shim-資料庫\"><a href=\"#4-查詢已安裝的-Shim-資料庫\" class=\"headerlink\" title=\"4. 查詢已安裝的 Shim 資料庫\"></a>4. 查詢已安裝的 Shim 資料庫</h3><ul>\n<li><p><strong>適用於舊版 Windows：</strong><br>若使用的是舊版本的 Windows (如: Windows 7&#x2F;8)，根據早期的技術資料中可以使用以下 PowerShell 指令列出安裝過的自訂 <code>.sdb</code> (參考資料 [1][2]):</p>\n  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">reg query <span class=\"string\">&quot;HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\InstalledSDB&quot;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p><strong>適用於新版 Windows：</strong><br>若使用的是較新版本的 Windows (如: Windows 10&#x2F;11)，以上述指令執行可能會發生查找不到的狀況。這是因為新版本中的 <code>AppCompat</code> 資料庫雖然存在，但不一定會出現在 <code>InstalledSDB</code> 下，而是散布在其他註冊機碼 (registry key) 中，可用以下兩種 PowerShell 指令查詢:</p>\n<ul>\n<li>列出針對特定路徑的應用程式所套用的 Shim 行為，也就是「Custom Shim」  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">reg query <span class=\"string\">&quot;HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Custom&quot;</span></span><br></pre></td></tr></table></figure></li>\n<li>顯示使用者手動設定的相容性層（Compatibility Layers），例如用滑鼠右鍵設定「以 Windows 7 相容模式執行」的那些項目  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">reg query <span class=\"string\">&quot;HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Layers&quot;</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<p><strong>為什麼找不到 InstalledSDB？</strong><br>至於為什麼新版本 Windows 中會有 <code>InstalledSDB</code> 缺失的問題呢? 主要原因有以下三點:</p>\n<ol>\n<li>並非所有 <code>.sdb</code> 安裝都會登記在 InstalledSDB 下</li>\n<li>有些系統版本根本不建立這個鍵值</li>\n<li>微軟改變了 Shim 的儲存或管理方式（特別是近年趨向 WDAC 和 AppLocker 等更嚴格控管）</li>\n</ol>\n<h3 id=\"5-常見-Shim-應用實例\"><a href=\"#5-常見-Shim-應用實例\" class=\"headerlink\" title=\"5. 常見 Shim 應用實例\"></a>5. 常見 Shim 應用實例</h3><ul>\n<li><code>VersionLie</code>：偽裝成特定 Windows 版本</li>\n<li><code>ForceAdminAccess</code>：欺騙應用程式認為目前使用者是 Admin</li>\n<li><code>CorrectFilePaths</code>：將檔案路徑重導至現代系統中可用位置</li>\n</ul>\n<h3 id=\"6-資安風險：Shim-Injection\"><a href=\"#6-資安風險：Shim-Injection\" class=\"headerlink\" title=\"6. 資安風險：Shim Injection\"></a>6. 資安風險：Shim Injection</h3><p>攻擊者可自製 <code>.sdb</code> 檔並利用 <code>sdbinst.exe</code> 安裝至系統中，當使用者啟動特定程式時，自動注入惡意程式碼。例如<a href=\"https://malpedia.caad.fkie.fraunhofer.de/actor/fin7\">知名駭客集團 FIN7</a> 就曾使用此技術 (參考資料 [3])。</p>\n<h2 id=\"Linux：Shim-Loader-在-Secure-Boot-中的角色與實踐\"><a href=\"#Linux：Shim-Loader-在-Secure-Boot-中的角色與實踐\" class=\"headerlink\" title=\"Linux：Shim Loader 在 Secure Boot 中的角色與實踐\"></a>Linux：Shim Loader 在 Secure Boot 中的角色與實踐</h2><h3 id=\"1-Secure-Boot-簡介\"><a href=\"#1-Secure-Boot-簡介\" class=\"headerlink\" title=\"1. Secure Boot 簡介\"></a>1. Secure Boot 簡介</h3><p>UEFI Secure Boot 確保開機流程中執行的程式碼皆經由簽章驗證。韌體通常僅信任由微軟 UEFI CA 所簽署的開機元件。</p>\n<h3 id=\"2-Linux-為什麼需要-Shim？\"><a href=\"#2-Linux-為什麼需要-Shim？\" class=\"headerlink\" title=\"2. Linux 為什麼需要 Shim？\"></a>2. Linux 為什麼需要 Shim？</h3><p>Linux 發行版透過 shim 避免每次 kernel 或 bootloader 更新都需向微軟簽章。<br>Shim 自身由微軟簽署，而它內嵌的發行版公鑰可用來驗證 GRUB 與 Linux kernel。</p>\n<h3 id=\"3-運作流程：Shim-的三段式信任鏈-Three-stage-Trust-Chain\"><a href=\"#3-運作流程：Shim-的三段式信任鏈-Three-stage-Trust-Chain\" class=\"headerlink\" title=\"3. 運作流程：Shim 的三段式信任鏈 (Three-stage Trust Chain)\"></a>3. 運作流程：Shim 的三段式信任鏈 (Three-stage Trust Chain)</h3><p>三段式信任鏈是 Linux 在 UEFI Secure Boot 環境中，用以確保開機流程安全與完整性的核心架構。<br>其主要目的，是確保從 UEFI 韌體啟動開始，經由 GRUB，到最終載入 Linux 核心的每一個階段裡所執行的元件皆為經簽章驗證、未遭竄改可信的程式碼。</p>\n<p>整體信任鏈依序包含 Firmware、Shim、GRUB 與 Kernel 四個關鍵元件，其中每一階段的簽章與驗證機制，分別由不同單位負責：<br>Firmware 通常由硬體廠商提供，Shim 則由 Linux 發行版開發並交由微軟簽章，GRUB 和 Kernel 則由發行版簽署，並透過 Shim 或 MOK 機制進行驗證，共同構成一條完整且可追溯的信任路徑。</p>\n<p><img src=\"https://kevinchiu923.github.io/post/%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90-Shim%EF%BC%9AWindows-%E7%9B%B8%E5%AE%B9%E6%80%A7%E4%BF%AE%E6%AD%A3%E8%88%87-Linux-Secure-Boot-%E4%BF%A1%E4%BB%BB%E9%8F%88%E6%A0%B8%E5%BF%83/Three-stage-Trust-Chain.jpeg\"></p>\n<p>詳細流程如下：</p>\n<p><strong>Step 1：Firmware → shim(由微軟簽署)</strong></p>\n<table>\n<thead>\n<tr>\n<th>項目</th>\n<th>說明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>啟動元件</td>\n<td>UEFI 固件</td>\n</tr>\n<tr>\n<td>執行對象</td>\n<td>shimx64.efi (由 Linux 發行版提供，已由微軟簽章)</td>\n</tr>\n<tr>\n<td>驗證方式</td>\n<td>使用 Microsoft UEFI CA 簽章來驗證 Shim</td>\n</tr>\n<tr>\n<td>目標</td>\n<td>讓非微軟提供的 bootloader (如 GRUB)能在 Secure Boot 下被合法載入</td>\n</tr>\n</tbody></table>\n<p><strong>Step 2：shim → GRUB (或其他 bootloader)（由發行版簽署)</strong></p>\n<table>\n<thead>\n<tr>\n<th>項目</th>\n<th>說明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>啟動元件</td>\n<td>shimx64.efi</td>\n</tr>\n<tr>\n<td>執行對象</td>\n<td>grubx64.efi (由 Linux 發行版簽章)</td>\n</tr>\n<tr>\n<td>驗證方式</td>\n<td>使用內嵌在 Shim 中的公鑰，或從 MOK (Machine Owner Key) 資料庫驗證</td>\n</tr>\n<tr>\n<td>目標</td>\n<td>載入下一階段 bootloader (如 GRUB)，建立信任傳遞關係</td>\n</tr>\n</tbody></table>\n<p><strong>Step 3：GRUB → Kernel（使用 shim 提供之驗證功能）</strong></p>\n<table>\n<thead>\n<tr>\n<th>項目</th>\n<th>說明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>啟動元件</td>\n<td>GRUB</td>\n</tr>\n<tr>\n<td>執行對象</td>\n<td>vmlinux (Linuex kernel 映像檔)</td>\n</tr>\n<tr>\n<td>驗證方式</td>\n<td>使用 Shim 或 GRUB 的簽章驗證模組，驗證 kernel 簽章</td>\n</tr>\n<tr>\n<td>目標</td>\n<td>確保啟動的 kernel 也經過驗證</td>\n</tr>\n</tbody></table>\n<p>這三個階段分別由微軟、Linux 發行版與使用者管理，形成一條 <strong>「分層簽署、階段驗證」</strong> 的完整分層信任架構。</p>\n<h3 id=\"4-管理自簽金鑰：MOK（Machine-Owner-Key）\"><a href=\"#4-管理自簽金鑰：MOK（Machine-Owner-Key）\" class=\"headerlink\" title=\"4. 管理自簽金鑰：MOK（Machine Owner Key）\"></a>4. 管理自簽金鑰：MOK（Machine Owner Key）</h3><p>允許使用者手動註冊自定義簽名金鑰，然後可以使用這些金鑰來驗證第三方驅動程式或自定義編譯的 Linux 內核。<br>註冊后，相應的公鑰將儲存在 <a href=\"https://en.wikipedia.org/wiki/Non-volatile_memory\">NVRAM（非揮發記憶體）</a>中成為安全啟動驗證過程的一部分，並在 Secure Boot 流程中由 <a href=\"https://github.com/hakuna-m/wubiuefi/wiki/MOKManager\">MokManager</a> 處理。</p>\n<p>新增 MOK 流程（以 Ubuntu 為例）：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> mokutil --import my_key_pub.der</span><br><span class=\"line\"><span class=\"comment\"># 系統將提示設定密碼，重新開機後進入 MokManager 加入金鑰</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5-相關資安風險回顧\"><a href=\"#5-相關資安風險回顧\" class=\"headerlink\" title=\"5. 相關資安風險回顧\"></a>5. 相關資安風險回顧</h3><p>於 2020 年爆出的 <strong>BootHole (<a href=\"https://nvd.nist.gov/vuln/detail/cve-2020-10713\">CVE-2020-10713</a>)</strong> 漏洞，促使了整個 UEFI Secure Boot 生態系迎來一場大革新。<br>這個漏洞存在於 GRUB2 bootloader 的設定解析邏輯中，攻擊者可以藉由篡改 grub.cfg 來注入惡意程式碼，即使在 Secure Boot 啟用的情況下，也能繞過驗證機制、執行未經簽署的內容。<br>這不僅暴露了 Secure Boot 信任鏈的單點風險，更凸顯了傳統撤銷 (revocation) 機制（如 dbx）的侷限性。</p>\n<p>為了解決這類系統性風險，Linux 社群與多家 UEFI 相關廠商（如 Canonical、Red Hat 等）合作，設計出一套名為 <strong><a href=\"https://www.gnu.org/software/grub/manual/grub/html_node/Secure-Boot-Advanced-Targeting.html\">SBAT（Secure Boot Advanced Targeting）</a></strong> 的新機制。<br>SBAT 允許系統更精確的辨識和撤銷具有風險的開機元件版本，例如特定版本的 shim、GRUB 或 Linux kernel，避免因一次撤銷而連帶影響所有使用者與版本，提升了 Secure Boot 的彈性與可維運性。</p>\n<h2 id=\"結語：Shim-是一把雙面刃\"><a href=\"#結語：Shim-是一把雙面刃\" class=\"headerlink\" title=\"結語：Shim 是一把雙面刃\"></a>結語：Shim 是一把雙面刃</h2><p>Shim 在現代系統中扮演橋樑角色：</p>\n<ul>\n<li>Windows 的 Shim 強化了舊應用程式的生命週期</li>\n<li>Linux 的 Shim 維繫 Secure Boot 的完整性與信任鏈</li>\n</ul>\n<p>唯有深入理解其機制，才能有效運用其優勢、提早防範可能的安全風險。</p>\n<h3 id=\"為什麼說-Shim-是雙面刃？\"><a href=\"#為什麼說-Shim-是雙面刃？\" class=\"headerlink\" title=\"為什麼說 Shim 是雙面刃？\"></a>為什麼說 Shim 是雙面刃？</h3><h4 id=\"優點：\"><a href=\"#優點：\" class=\"headerlink\" title=\"優點：\"></a>優點：</h4><ul>\n<li><strong>維持相容與開放性</strong>：Shim 提供了強大的彈性與便利性，允許舊應用程式或自訂驅動在現代環境中繼續運作，降低維護與升級成本。</li>\n</ul>\n<h4 id=\"缺點：\"><a href=\"#缺點：\" class=\"headerlink\" title=\"缺點：\"></a>缺點：</h4><ul>\n<li><strong>潛在安全破口</strong>：同樣的機制若被濫用，可能成為惡意程式碼的載具，例如 Windows 中的 Shim injection 或 Linux 過期 shim 被攻擊者利用。</li>\n<li><strong>信任鏈單點風險</strong>：特別在 Secure Boot 環境中，shim 是信任鏈的起點，一旦 shim 本身有漏洞或被取代，整條信任機制將形同虛設。</li>\n<li><strong>維護成本與撤銷困難</strong>：Shim 一旦廣泛部署，若需進行更新（如 SBAT 撤銷）常會伴隨使用者無法開機等風險與操作複雜度。</li>\n</ul>\n<p>因此，在部署與使用 shim 時，應同時考慮便利性與安全性，並持續追蹤官方針對 shim 更新與安全通報。</p>\n<h3 id=\"因應對策與防護建議\"><a href=\"#因應對策與防護建議\" class=\"headerlink\" title=\"因應對策與防護建議\"></a>因應對策與防護建議</h3><p>在實際部署中，建議企業與開發人員落實版本控管、簽章政策與集中式管理機制，並持續關注 Shim 與 Secure Boot 的安全通報，以降低潛在攻擊風險。具體如下：</p>\n<ol>\n<li>維持相容與開放性<ul>\n<li>僅針對無可替代的關鍵應用程式使用 Shim，避免全面啟用造成過度依賴。</li>\n<li>導入完整的變更控管(Change Control &#x2F; Change Management) 與測試流程(如 <a href=\"https://www.iso.org/standard/27001\">ISO&#x2F;IEC 27001</a>、<a href=\"https://csrc.nist.gov/pubs/sp/800/53/r5/upd1/final\">NIST 800-53</a>)，針對每項 Shim 設定進行風險評估、功能驗證與版本記錄，以確保相容性需求與系統安全性之間的平衡。</li>\n<li>搭配應用程式白名單機制（如 <a href=\"https://learn.microsoft.com/en-us/windows/security/application-security/application-control/app-control-for-business/applocker/what-is-applocker\">AppLocker</a>、<a href=\"https://learn.microsoft.com/en-us/hololens/windows-defender-application-control-wdac\">WDAC</a>）限制執行來源。</li>\n</ul>\n</li>\n<li>潛在安全破口<ul>\n<li>建立監控機制，偵測如 sdbinst.exe 執行、異常的 Shim 資料庫變更等行為。</li>\n<li>僅授予系統管理員權限安裝 Shim，並限制使用者層級存取 Shim 管理工具。</li>\n<li>定期稽核 %WINDIR%\\AppPatch\\Custom\\ 和註冊機碼下的 Shim 記錄。</li>\n</ul>\n</li>\n<li>信任鏈單點風險<ul>\n<li>僅使用官方發行、由 Microsoft 簽署的 shim 映像檔。</li>\n<li>部署支援 SBAT 的 shim 版本，以便精確撤銷與進行版本管控。</li>\n<li>定期更新 shim、GRUB、Kernel 與 UEFI 韌體，以防範已知漏洞。</li>\n</ul>\n</li>\n<li>維護成本與撤銷困難<ul>\n<li>使用集中化管理工具（如 <a href=\"https://learn.microsoft.com/en-us/intune/intune-service/fundamentals/what-is-intune\">Intune</a>、<a href=\"https://www.redhat.com/en/ansible-collaborative\">Ansible</a>）統一佈署與監控 Shim 使用情形。</li>\n<li>規劃開機備援方案，例如 USB live 磁區、Recovery 分割區，以因應 Shim 更新後的開機失敗。</li>\n<li>建立版本記錄與 SHA256 雜湊校驗機制，以利驗證與回溯分析。</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"參考資料\"><a href=\"#參考資料\" class=\"headerlink\" title=\"參考資料\"></a>參考資料</h2><p>[1] Black Hat Europe 2015 Whitepaper -<a href=\"https://www.blackhat.com/docs/eu-15/materials/eu-15-Pierce-Defending-Against-Malicious-Application-Compatibility-Shims-wp.pdf\">《Defending Against Malicious Application Compatibility Shims》</a><br>[2] F-Secure Blog post - <a href=\"https://blog.f-secure.com/hunting-for-application-shim-databases/\">《Hunting for Application Shim Databases》</a><br>[3] Google Cloud - <a href=\"https://cloud.google.com/blog/topics/threat-intelligence/fin7-shim-databases-persistence/\">To SDB, Or Not To SDB: FIN7 Leveraging Shim Databases for Persistence</a></p>\n"},{"title":"淺談 IEC 60870-5-104：SCADA 通訊協定的實務與安全應用","date":"2025-03-27T12:00:00.000Z","cover_image":"https://kevinchiu923.github.io/post/%E6%B7%BA%E8%AB%87-IEC-60870-5-104%EF%BC%9ASCADA-%E9%80%9A%E8%A8%8A%E5%8D%94%E5%AE%9A%E7%9A%84%E5%AF%A6%E5%8B%99%E8%88%87%E5%AE%89%E5%85%A8%E6%87%89%E7%94%A8/cover_img.jpeg","_content":"\n![](淺談-IEC-60870-5-104：SCADA-通訊協定的實務與安全應用/cover_img.jpeg)\n<center>Source: https://www.dreamstime.com/</center>\n\n## 1. 專有名詞說明\n\n- **遙測 → Telemetry**\n    *定義：* 是指從遠端設備或系統收集資料並傳回主系統或控制中心的技術。這些資料通常是感測器或監控裝置所收集的，例如溫度、壓力、位置等\n    *舉例：* 太空探測器將自身的速度、溫度、位置等資料傳回地球，這些就是「遙測」數據\n\n- **遙信 → Tele-signaling / Remote Signaling**\n    *定義：* 指遠端設備或系統的狀態信號的傳送，主要是傳遞狀態或告警資訊（如開/關、正常/故障等），通常是離散型資料\n    *舉例：* 發電廠的控制中心收到某個變電站「開關已關閉」的狀態信號，這就是一種遙信\n\n- **遙控 → Telecontrol / Remote Control**\n    *定義：* 指從遠端對設備進行控制或操作，例如遠端開關機、設定參數、啟動程式等\n    *舉例：* 遠端控制工廠機械啟動運轉、開啟空調等，這些都屬於遙控\n\n- **DSP → Digital signal processor (數位訊號處理器)**\n    *定義：* 是一種專用於數位訊號處理的微處理器，被廣泛應用於電信、音訊處理、數位圖像處理、雷達、聲納等領域，以及消費電子產品中\n\n- **RTU → Remote terminal unit (遠端遙控裝置)**\n    *定義：* 微控制處理器，主要做為裝置介面的電子裝置，將資料引入 SCADA，通過傳輸遙測資料 (Remote sensing data) 到主系統，並且使用主監控系統的資料控制所連接的裝置\n\n- **IED → Intelligent Electronic Device (智慧電子設備)**\n    *定義：* 具備資料處理能力與通訊功能的電子裝置，常應用於電力系統、工業控制系統（ICS）等場景中，用於監測、控制、保護與通訊。它不只是「感測器」或「繼電器」，而是具有 微處理器、邏輯判斷、遠端通訊能力的智慧設備。\n\n- **COT → Cause of Transmission (傳送原因)**\n    *定義：* COT 是 IEC 60870-5 協定中 ASDU（應用服務資料單元）的一個重要欄位，用來說明這筆資料為什麼被傳送，也就是傳輸的「觸發原因」\n\n- **IOA → Information Object Address (資訊物件地址)**\n    *定義：* 用來標示該筆資料所屬的設備內部地址，也就是某個遙測點的「點號」。通常每個 RTU 或 IED 裝置裡會配置一張遙測點號表，IOA 就是用來定位這些點\n\n- **Frame → 訊框**\n    *定義：* 在工控通訊協定中，Frame 是一個用來封裝與傳輸資料的基本單位，就像是一個信封一樣，裡面包含了標頭 (header)、資料本體 (payload)、檢查碼 (CRC) 等資訊；其中標頭 (header) 主要由起始符 (Start of Frame, SOF) 、位址/識別位、功能碼 (表示讀、寫等指令) 組成\n\n- **SCADA → Supervisory Control And Data Acquisition (監控與資料採集系統)**\n    *定義：* 是一種用於遠端監控與控制大型工業系統的架構，它允許操作人員從中控室監控現場設備的運作狀態，並能發送控制命令。SCADA 可收集、儲存、分析和顯示來自現場感測器和控制設備的資料\n\n---\n\n## 2. 何謂 IEC 60870-5 協定\n\nIEC 60870 是一套是由 [國際電工委員會 (IEC)](https://www.iec.ch/homepage) 制定的國際通訊標準，旨在為在工業控制中心 (SCADA) 及遠端裝置 (如: RTU/IED) 間進行可靠的資料傳輸。現今廣泛應用在電力系統、智慧電網的監控/控制與工業自動化系統中。\nIEC 60870-5 則是整個家族中的第五部份，旗下包含多達 13 個子標準，主要針對電力系統的遠端控制、遠端保護和相關通信制定了協議標準。\n\n其中最常見的兩個子標準是：\n- **IEC 60870-5-101 (下稱 IEC 101)**：使用傳統串列 (RS-232/RS-485) 方式，適合本地端點對點傳輸應用。\n- **IEC 60870-5-104 (下稱 IEC 104)**：是針對現代網路環境 (如: TCP/IP) 設計的版本，針對遠端通訊的傳輸層與應用層設計，可在乙太網、VPN 等廣域網路上進行資料傳輸。\n\n簡單來說，IEC 104 就是把 IEC 101 的資料格式「搬到網路上」，讓它能走在 IP 網路上，而且支援雙向持續連線，讓資料可以即時交換，不用像老系統只能等 SCADA 輪詢。\n\n---\n\n## 3. IEC 104 與 OSI 七層模型的對應\nIEC 104 在網路通訊模型中，是應用層協定，透過 TCP 傳輸，預設使用 **Port 2404**。\n\n以下是它在 傳統網路 OSI 七層模型中的對應：\n- 應用層：IEC 104\n- 傳輸層：TCP\n- 網路層：IP\n- 資料鏈結層/實體層：Ethernet\n\n在 SCADA 系統中採用的是 Master-Slave 模式 (*註1*)，主站 (控制中心) 通常是 **Client (用戶端)** ，現場的 RTU、IED 是 **Server (伺服端)** ，兩者透過 TCP 建立持久性連線 (Persistent Connection) ，並進行資料交換與控制指令下達。\n當主站連線成功後，會送出 **StartDT** 指令開始資料傳送；若無動作太久，也會用 **TestFR** 做連線測試。\n\n###### *註1：自2020年起，美國科技界認為 Master-Slave 這樣的字眼可能反應了早期蓄奴制度而帶有潛在負面與歧視意涵，因而 Oracle、GitHub 等大廠倡議以 Source-Replica 、Conductor-Member 或是 Primary-Secondary 等新名詞取代之；<br>但由於 IEC 相關文件制定時間較早，為讀者們參照方便，此文仍使用 Master-Slave 說明。(參考資料：[MySQL Terminology Updates](https://dev.mysql.com/blog-archive/mysql-terminology-updates/))\n\n---\n\n## 4. 通訊格式與資料結構解說\nIEC 104 的資料單元叫做 **ASDU (Application Service Data Unit)** ，是主要的資料封裝格式。\n\n每個 ASDU 包含：\n- **類型 ID (Type ID)** ：表示這是什麼資料 (例如遙測、遙信、遙控)\n- **傳送原因 (COT)** ：表示為什麼送這筆資料 (定時、變化、指令、測試等)\n- **公共地址與資訊物件地址 (IOA)** ：標示資料屬於哪個裝置、哪一筆點位\n- **資料內容**：實際傳輸的值 (如 ON/OFF、電壓數值)\n\nIEC 104 使用三種 Frame 類型：\n1. **I-frame**：攜帶實際資料\n2. **S-frame**：確認對方資料已收到\n3. **U-frame**：連線管理指令，如 StartDT、StopDT、TestFR\n\n這些報文 (message) 內含控制編號與確認編號，確保資料正確送達，並支援流量控制與錯誤偵測。\n\n---\n\n## 5. 實際應用案例：如何與 SCADA 整合\n在現代 SCADA 系統中，IEC 104 是非常常見的通訊協定。\n舉例來說：\n- **西門子 (Siemens)** 的 RTU 裝置與 WinCC SCADA 系統可以透過 IEC 104 傳送資料。\n- **施耐德電機 (Schneider Electric)** 的 ClearSCADA (Geo SCADA) 也支援 IEC 104。\n- **艾波比 (ABB)** 的 MicroSCADA 及 RTU560 裝置內建 IEC 104 通訊模組。\n\n這些裝置通常會與 IED (如：智慧電表、保護裝置) 回傳的遙測訊息串接，例如：\n- 電壓/電流變化\n- 保護跳脫事件\n- 遙控指令執行成功與否\n\nSCADA 系統會設定對應的 Type ID、COT、IOA 等參數，來對應每一筆資料。\n在一些場景下，若現場設備只支援 IEC 101 (串列通訊) ，可使用 **協定轉換器** 或 **閘道器** (如：研華生產的轉換器 [ESRP-PCS-ICR3231](https://www.advantech.com/zh-tw/products/ac0bd5cd-093a-4f88-87f5-13edc68a5616/esrp-pcs-icr3231/mod_803b3db4-bd02-472c-8ad3-624aaaab2433) 及閘道器 [ECU-1051](https://www.advantech.com/zh-tw/products/7332cf9e-bf70-4a79-b0b6-fd8a2182cd72/ecu-1051/mod_0ea5f440-e270-436f-afa3-077df3acce5d)) 將其轉成 IEC 104 接入乙太網架構，實現舊系統升級。\n\n---\n\n## 6. 資安挑戰與 IEC 62351 的保護機制\n\nIEC 104 初始設計時並未考慮現代網路威脅，因此面臨以下問題：\n- 資料採用明文傳輸，容易有遭竊聽的風險\n- 缺乏身份驗證機制，攻擊者可偽裝成合法主站發送指令\n- 沒有加密與完整性驗證，易遭中間人攻擊\n\n為了解決這些問題，IEC 推出了 [**IEC 62351** 系列標準](https://www.iec.ch/blog/cyber-security-understanding-iec-62351)，加強電力通訊方面的資安保護：\n- [**IEC 62351-3**](https://webstore.iec.ch/en/publication/68410)：建議在 TCP 上使用 TLS (類似 HTTPS) 來加密資料\n- [**IEC 62351-5**](https://webstore.iec.ch/en/publication/65511)：對 IEC 104 應用層新增簽章與序號保護，避免重放攻擊 (replay attack) 與偽造\n- [**IEC 62351-8**](https://webstore.iec.ch/en/publication/61822) ＆ [IEC 62351-9](https://webstore.iec.ch/en/publication/66864)**：定義了裝置驗證和金鑰管理辦法\n\n若設備不支援這些功能，則可改用 VPN 或閘道器進行加密傳輸或封包轉發。\n\n---\n\n## 7. 實務建議：如何部署安全又穩定的系統\n即使已導入 IEC 62351，仍建議採用以下部署建議：\n1. **網路區隔**：SCADA、RTU 等工控網路要與一般企業網路隔離。\n2. **防火牆控制埠存取**：只允許授權的 IP 連接 Port 2404 。\n3. **入侵偵測系統 (IDS)** ：即時監測異常 IEC 104 封包與指令行為。\n4. **安全閘道器**：限制只能傳送特定 IOA/Type ID 的資料與指令。\n5. **VPN 加密傳輸**：遠端存取建議透過加密通道保護資料。\n6. **定期更新設備韌體**：修補既有已知漏洞。\n\n上述策略屬於縱深防禦，能大幅降低攻擊成功的機率。","source":"_posts/淺談-IEC-60870-5-104：SCADA-通訊協定的實務與安全應用.md","raw":"---\ntitle: >-\n    淺談 IEC 60870-5-104：SCADA 通訊協定的實務與安全應用\ndate: 2025-03-27 20:00:00\ntags:\n  - Traditional Chinese\n  - 工業控制系統\n  - 資訊安全\ncategories:\n  - Knowledge base\ncover_image: 'https://kevinchiu923.github.io/post/%E6%B7%BA%E8%AB%87-IEC-60870-5-104%EF%BC%9ASCADA-%E9%80%9A%E8%A8%8A%E5%8D%94%E5%AE%9A%E7%9A%84%E5%AF%A6%E5%8B%99%E8%88%87%E5%AE%89%E5%85%A8%E6%87%89%E7%94%A8/cover_img.jpeg'\n---\n\n![](淺談-IEC-60870-5-104：SCADA-通訊協定的實務與安全應用/cover_img.jpeg)\n<center>Source: https://www.dreamstime.com/</center>\n\n## 1. 專有名詞說明\n\n- **遙測 → Telemetry**\n    *定義：* 是指從遠端設備或系統收集資料並傳回主系統或控制中心的技術。這些資料通常是感測器或監控裝置所收集的，例如溫度、壓力、位置等\n    *舉例：* 太空探測器將自身的速度、溫度、位置等資料傳回地球，這些就是「遙測」數據\n\n- **遙信 → Tele-signaling / Remote Signaling**\n    *定義：* 指遠端設備或系統的狀態信號的傳送，主要是傳遞狀態或告警資訊（如開/關、正常/故障等），通常是離散型資料\n    *舉例：* 發電廠的控制中心收到某個變電站「開關已關閉」的狀態信號，這就是一種遙信\n\n- **遙控 → Telecontrol / Remote Control**\n    *定義：* 指從遠端對設備進行控制或操作，例如遠端開關機、設定參數、啟動程式等\n    *舉例：* 遠端控制工廠機械啟動運轉、開啟空調等，這些都屬於遙控\n\n- **DSP → Digital signal processor (數位訊號處理器)**\n    *定義：* 是一種專用於數位訊號處理的微處理器，被廣泛應用於電信、音訊處理、數位圖像處理、雷達、聲納等領域，以及消費電子產品中\n\n- **RTU → Remote terminal unit (遠端遙控裝置)**\n    *定義：* 微控制處理器，主要做為裝置介面的電子裝置，將資料引入 SCADA，通過傳輸遙測資料 (Remote sensing data) 到主系統，並且使用主監控系統的資料控制所連接的裝置\n\n- **IED → Intelligent Electronic Device (智慧電子設備)**\n    *定義：* 具備資料處理能力與通訊功能的電子裝置，常應用於電力系統、工業控制系統（ICS）等場景中，用於監測、控制、保護與通訊。它不只是「感測器」或「繼電器」，而是具有 微處理器、邏輯判斷、遠端通訊能力的智慧設備。\n\n- **COT → Cause of Transmission (傳送原因)**\n    *定義：* COT 是 IEC 60870-5 協定中 ASDU（應用服務資料單元）的一個重要欄位，用來說明這筆資料為什麼被傳送，也就是傳輸的「觸發原因」\n\n- **IOA → Information Object Address (資訊物件地址)**\n    *定義：* 用來標示該筆資料所屬的設備內部地址，也就是某個遙測點的「點號」。通常每個 RTU 或 IED 裝置裡會配置一張遙測點號表，IOA 就是用來定位這些點\n\n- **Frame → 訊框**\n    *定義：* 在工控通訊協定中，Frame 是一個用來封裝與傳輸資料的基本單位，就像是一個信封一樣，裡面包含了標頭 (header)、資料本體 (payload)、檢查碼 (CRC) 等資訊；其中標頭 (header) 主要由起始符 (Start of Frame, SOF) 、位址/識別位、功能碼 (表示讀、寫等指令) 組成\n\n- **SCADA → Supervisory Control And Data Acquisition (監控與資料採集系統)**\n    *定義：* 是一種用於遠端監控與控制大型工業系統的架構，它允許操作人員從中控室監控現場設備的運作狀態，並能發送控制命令。SCADA 可收集、儲存、分析和顯示來自現場感測器和控制設備的資料\n\n---\n\n## 2. 何謂 IEC 60870-5 協定\n\nIEC 60870 是一套是由 [國際電工委員會 (IEC)](https://www.iec.ch/homepage) 制定的國際通訊標準，旨在為在工業控制中心 (SCADA) 及遠端裝置 (如: RTU/IED) 間進行可靠的資料傳輸。現今廣泛應用在電力系統、智慧電網的監控/控制與工業自動化系統中。\nIEC 60870-5 則是整個家族中的第五部份，旗下包含多達 13 個子標準，主要針對電力系統的遠端控制、遠端保護和相關通信制定了協議標準。\n\n其中最常見的兩個子標準是：\n- **IEC 60870-5-101 (下稱 IEC 101)**：使用傳統串列 (RS-232/RS-485) 方式，適合本地端點對點傳輸應用。\n- **IEC 60870-5-104 (下稱 IEC 104)**：是針對現代網路環境 (如: TCP/IP) 設計的版本，針對遠端通訊的傳輸層與應用層設計，可在乙太網、VPN 等廣域網路上進行資料傳輸。\n\n簡單來說，IEC 104 就是把 IEC 101 的資料格式「搬到網路上」，讓它能走在 IP 網路上，而且支援雙向持續連線，讓資料可以即時交換，不用像老系統只能等 SCADA 輪詢。\n\n---\n\n## 3. IEC 104 與 OSI 七層模型的對應\nIEC 104 在網路通訊模型中，是應用層協定，透過 TCP 傳輸，預設使用 **Port 2404**。\n\n以下是它在 傳統網路 OSI 七層模型中的對應：\n- 應用層：IEC 104\n- 傳輸層：TCP\n- 網路層：IP\n- 資料鏈結層/實體層：Ethernet\n\n在 SCADA 系統中採用的是 Master-Slave 模式 (*註1*)，主站 (控制中心) 通常是 **Client (用戶端)** ，現場的 RTU、IED 是 **Server (伺服端)** ，兩者透過 TCP 建立持久性連線 (Persistent Connection) ，並進行資料交換與控制指令下達。\n當主站連線成功後，會送出 **StartDT** 指令開始資料傳送；若無動作太久，也會用 **TestFR** 做連線測試。\n\n###### *註1：自2020年起，美國科技界認為 Master-Slave 這樣的字眼可能反應了早期蓄奴制度而帶有潛在負面與歧視意涵，因而 Oracle、GitHub 等大廠倡議以 Source-Replica 、Conductor-Member 或是 Primary-Secondary 等新名詞取代之；<br>但由於 IEC 相關文件制定時間較早，為讀者們參照方便，此文仍使用 Master-Slave 說明。(參考資料：[MySQL Terminology Updates](https://dev.mysql.com/blog-archive/mysql-terminology-updates/))\n\n---\n\n## 4. 通訊格式與資料結構解說\nIEC 104 的資料單元叫做 **ASDU (Application Service Data Unit)** ，是主要的資料封裝格式。\n\n每個 ASDU 包含：\n- **類型 ID (Type ID)** ：表示這是什麼資料 (例如遙測、遙信、遙控)\n- **傳送原因 (COT)** ：表示為什麼送這筆資料 (定時、變化、指令、測試等)\n- **公共地址與資訊物件地址 (IOA)** ：標示資料屬於哪個裝置、哪一筆點位\n- **資料內容**：實際傳輸的值 (如 ON/OFF、電壓數值)\n\nIEC 104 使用三種 Frame 類型：\n1. **I-frame**：攜帶實際資料\n2. **S-frame**：確認對方資料已收到\n3. **U-frame**：連線管理指令，如 StartDT、StopDT、TestFR\n\n這些報文 (message) 內含控制編號與確認編號，確保資料正確送達，並支援流量控制與錯誤偵測。\n\n---\n\n## 5. 實際應用案例：如何與 SCADA 整合\n在現代 SCADA 系統中，IEC 104 是非常常見的通訊協定。\n舉例來說：\n- **西門子 (Siemens)** 的 RTU 裝置與 WinCC SCADA 系統可以透過 IEC 104 傳送資料。\n- **施耐德電機 (Schneider Electric)** 的 ClearSCADA (Geo SCADA) 也支援 IEC 104。\n- **艾波比 (ABB)** 的 MicroSCADA 及 RTU560 裝置內建 IEC 104 通訊模組。\n\n這些裝置通常會與 IED (如：智慧電表、保護裝置) 回傳的遙測訊息串接，例如：\n- 電壓/電流變化\n- 保護跳脫事件\n- 遙控指令執行成功與否\n\nSCADA 系統會設定對應的 Type ID、COT、IOA 等參數，來對應每一筆資料。\n在一些場景下，若現場設備只支援 IEC 101 (串列通訊) ，可使用 **協定轉換器** 或 **閘道器** (如：研華生產的轉換器 [ESRP-PCS-ICR3231](https://www.advantech.com/zh-tw/products/ac0bd5cd-093a-4f88-87f5-13edc68a5616/esrp-pcs-icr3231/mod_803b3db4-bd02-472c-8ad3-624aaaab2433) 及閘道器 [ECU-1051](https://www.advantech.com/zh-tw/products/7332cf9e-bf70-4a79-b0b6-fd8a2182cd72/ecu-1051/mod_0ea5f440-e270-436f-afa3-077df3acce5d)) 將其轉成 IEC 104 接入乙太網架構，實現舊系統升級。\n\n---\n\n## 6. 資安挑戰與 IEC 62351 的保護機制\n\nIEC 104 初始設計時並未考慮現代網路威脅，因此面臨以下問題：\n- 資料採用明文傳輸，容易有遭竊聽的風險\n- 缺乏身份驗證機制，攻擊者可偽裝成合法主站發送指令\n- 沒有加密與完整性驗證，易遭中間人攻擊\n\n為了解決這些問題，IEC 推出了 [**IEC 62351** 系列標準](https://www.iec.ch/blog/cyber-security-understanding-iec-62351)，加強電力通訊方面的資安保護：\n- [**IEC 62351-3**](https://webstore.iec.ch/en/publication/68410)：建議在 TCP 上使用 TLS (類似 HTTPS) 來加密資料\n- [**IEC 62351-5**](https://webstore.iec.ch/en/publication/65511)：對 IEC 104 應用層新增簽章與序號保護，避免重放攻擊 (replay attack) 與偽造\n- [**IEC 62351-8**](https://webstore.iec.ch/en/publication/61822) ＆ [IEC 62351-9](https://webstore.iec.ch/en/publication/66864)**：定義了裝置驗證和金鑰管理辦法\n\n若設備不支援這些功能，則可改用 VPN 或閘道器進行加密傳輸或封包轉發。\n\n---\n\n## 7. 實務建議：如何部署安全又穩定的系統\n即使已導入 IEC 62351，仍建議採用以下部署建議：\n1. **網路區隔**：SCADA、RTU 等工控網路要與一般企業網路隔離。\n2. **防火牆控制埠存取**：只允許授權的 IP 連接 Port 2404 。\n3. **入侵偵測系統 (IDS)** ：即時監測異常 IEC 104 封包與指令行為。\n4. **安全閘道器**：限制只能傳送特定 IOA/Type ID 的資料與指令。\n5. **VPN 加密傳輸**：遠端存取建議透過加密通道保護資料。\n6. **定期更新設備韌體**：修補既有已知漏洞。\n\n上述策略屬於縱深防禦，能大幅降低攻擊成功的機率。","slug":"淺談-IEC-60870-5-104：SCADA-通訊協定的實務與安全應用","published":1,"updated":"2025-04-03T06:41:36.337Z","comments":1,"layout":"post","photos":[],"_id":"cm9agcuc80013nc82bxobgziu","content":"<p><img src=\"/post/%E6%B7%BA%E8%AB%87-IEC-60870-5-104%EF%BC%9ASCADA-%E9%80%9A%E8%A8%8A%E5%8D%94%E5%AE%9A%E7%9A%84%E5%AF%A6%E5%8B%99%E8%88%87%E5%AE%89%E5%85%A8%E6%87%89%E7%94%A8/cover_img.jpeg\"></p>\n<center>Source: https://www.dreamstime.com/</center>\n\n<h2 id=\"1-專有名詞說明\"><a href=\"#1-專有名詞說明\" class=\"headerlink\" title=\"1. 專有名詞說明\"></a>1. 專有名詞說明</h2><ul>\n<li><p><strong>遙測 → Telemetry</strong><br>  <em>定義：</em> 是指從遠端設備或系統收集資料並傳回主系統或控制中心的技術。這些資料通常是感測器或監控裝置所收集的，例如溫度、壓力、位置等<br>  <em>舉例：</em> 太空探測器將自身的速度、溫度、位置等資料傳回地球，這些就是「遙測」數據</p>\n</li>\n<li><p><strong>遙信 → Tele-signaling &#x2F; Remote Signaling</strong><br>  <em>定義：</em> 指遠端設備或系統的狀態信號的傳送，主要是傳遞狀態或告警資訊（如開&#x2F;關、正常&#x2F;故障等），通常是離散型資料<br>  <em>舉例：</em> 發電廠的控制中心收到某個變電站「開關已關閉」的狀態信號，這就是一種遙信</p>\n</li>\n<li><p><strong>遙控 → Telecontrol &#x2F; Remote Control</strong><br>  <em>定義：</em> 指從遠端對設備進行控制或操作，例如遠端開關機、設定參數、啟動程式等<br>  <em>舉例：</em> 遠端控制工廠機械啟動運轉、開啟空調等，這些都屬於遙控</p>\n</li>\n<li><p><strong>DSP → Digital signal processor (數位訊號處理器)</strong><br>  <em>定義：</em> 是一種專用於數位訊號處理的微處理器，被廣泛應用於電信、音訊處理、數位圖像處理、雷達、聲納等領域，以及消費電子產品中</p>\n</li>\n<li><p><strong>RTU → Remote terminal unit (遠端遙控裝置)</strong><br>  <em>定義：</em> 微控制處理器，主要做為裝置介面的電子裝置，將資料引入 SCADA，通過傳輸遙測資料 (Remote sensing data) 到主系統，並且使用主監控系統的資料控制所連接的裝置</p>\n</li>\n<li><p><strong>IED → Intelligent Electronic Device (智慧電子設備)</strong><br>  <em>定義：</em> 具備資料處理能力與通訊功能的電子裝置，常應用於電力系統、工業控制系統（ICS）等場景中，用於監測、控制、保護與通訊。它不只是「感測器」或「繼電器」，而是具有 微處理器、邏輯判斷、遠端通訊能力的智慧設備。</p>\n</li>\n<li><p><strong>COT → Cause of Transmission (傳送原因)</strong><br>  <em>定義：</em> COT 是 IEC 60870-5 協定中 ASDU（應用服務資料單元）的一個重要欄位，用來說明這筆資料為什麼被傳送，也就是傳輸的「觸發原因」</p>\n</li>\n<li><p><strong>IOA → Information Object Address (資訊物件地址)</strong><br>  <em>定義：</em> 用來標示該筆資料所屬的設備內部地址，也就是某個遙測點的「點號」。通常每個 RTU 或 IED 裝置裡會配置一張遙測點號表，IOA 就是用來定位這些點</p>\n</li>\n<li><p><strong>Frame → 訊框</strong><br>  <em>定義：</em> 在工控通訊協定中，Frame 是一個用來封裝與傳輸資料的基本單位，就像是一個信封一樣，裡面包含了標頭 (header)、資料本體 (payload)、檢查碼 (CRC) 等資訊；其中標頭 (header) 主要由起始符 (Start of Frame, SOF) 、位址&#x2F;識別位、功能碼 (表示讀、寫等指令) 組成</p>\n</li>\n<li><p><strong>SCADA → Supervisory Control And Data Acquisition (監控與資料採集系統)</strong><br>  <em>定義：</em> 是一種用於遠端監控與控制大型工業系統的架構，它允許操作人員從中控室監控現場設備的運作狀態，並能發送控制命令。SCADA 可收集、儲存、分析和顯示來自現場感測器和控制設備的資料</p>\n</li>\n</ul>\n<hr>\n<h2 id=\"2-何謂-IEC-60870-5-協定\"><a href=\"#2-何謂-IEC-60870-5-協定\" class=\"headerlink\" title=\"2. 何謂 IEC 60870-5 協定\"></a>2. 何謂 IEC 60870-5 協定</h2><p>IEC 60870 是一套是由 <a href=\"https://www.iec.ch/homepage\">國際電工委員會 (IEC)</a> 制定的國際通訊標準，旨在為在工業控制中心 (SCADA) 及遠端裝置 (如: RTU&#x2F;IED) 間進行可靠的資料傳輸。現今廣泛應用在電力系統、智慧電網的監控&#x2F;控制與工業自動化系統中。<br>IEC 60870-5 則是整個家族中的第五部份，旗下包含多達 13 個子標準，主要針對電力系統的遠端控制、遠端保護和相關通信制定了協議標準。</p>\n<p>其中最常見的兩個子標準是：</p>\n<ul>\n<li><strong>IEC 60870-5-101 (下稱 IEC 101)</strong>：使用傳統串列 (RS-232&#x2F;RS-485) 方式，適合本地端點對點傳輸應用。</li>\n<li><strong>IEC 60870-5-104 (下稱 IEC 104)</strong>：是針對現代網路環境 (如: TCP&#x2F;IP) 設計的版本，針對遠端通訊的傳輸層與應用層設計，可在乙太網、VPN 等廣域網路上進行資料傳輸。</li>\n</ul>\n<p>簡單來說，IEC 104 就是把 IEC 101 的資料格式「搬到網路上」，讓它能走在 IP 網路上，而且支援雙向持續連線，讓資料可以即時交換，不用像老系統只能等 SCADA 輪詢。</p>\n<hr>\n<h2 id=\"3-IEC-104-與-OSI-七層模型的對應\"><a href=\"#3-IEC-104-與-OSI-七層模型的對應\" class=\"headerlink\" title=\"3. IEC 104 與 OSI 七層模型的對應\"></a>3. IEC 104 與 OSI 七層模型的對應</h2><p>IEC 104 在網路通訊模型中，是應用層協定，透過 TCP 傳輸，預設使用 <strong>Port 2404</strong>。</p>\n<p>以下是它在 傳統網路 OSI 七層模型中的對應：</p>\n<ul>\n<li>應用層：IEC 104</li>\n<li>傳輸層：TCP</li>\n<li>網路層：IP</li>\n<li>資料鏈結層&#x2F;實體層：Ethernet</li>\n</ul>\n<p>在 SCADA 系統中採用的是 Master-Slave 模式 (<em>註1</em>)，主站 (控制中心) 通常是 <strong>Client (用戶端)</strong> ，現場的 RTU、IED 是 <strong>Server (伺服端)</strong> ，兩者透過 TCP 建立持久性連線 (Persistent Connection) ，並進行資料交換與控制指令下達。<br>當主站連線成功後，會送出 <strong>StartDT</strong> 指令開始資料傳送；若無動作太久，也會用 <strong>TestFR</strong> 做連線測試。</p>\n<h6 id=\"註1：自2020年起，美國科技界認為-Master-Slave-這樣的字眼可能反應了早期蓄奴制度而帶有潛在負面與歧視意涵，因而-Oracle、GitHub-等大廠倡議以-Source-Replica-、Conductor-Member-或是-Primary-Secondary-等新名詞取代之；但由於-IEC-相關文件制定時間較早，為讀者們參照方便，此文仍使用-Master-Slave-說明。-參考資料：MySQL-Terminology-Updates\"><a href=\"#註1：自2020年起，美國科技界認為-Master-Slave-這樣的字眼可能反應了早期蓄奴制度而帶有潛在負面與歧視意涵，因而-Oracle、GitHub-等大廠倡議以-Source-Replica-、Conductor-Member-或是-Primary-Secondary-等新名詞取代之；但由於-IEC-相關文件制定時間較早，為讀者們參照方便，此文仍使用-Master-Slave-說明。-參考資料：MySQL-Terminology-Updates\" class=\"headerlink\" title=\"*註1：自2020年起，美國科技界認為 Master-Slave 這樣的字眼可能反應了早期蓄奴制度而帶有潛在負面與歧視意涵，因而 Oracle、GitHub 等大廠倡議以 Source-Replica 、Conductor-Member 或是 Primary-Secondary 等新名詞取代之；但由於 IEC 相關文件制定時間較早，為讀者們參照方便，此文仍使用 Master-Slave 說明。(參考資料：MySQL Terminology Updates)\"></a>*註1：自2020年起，美國科技界認為 Master-Slave 這樣的字眼可能反應了早期蓄奴制度而帶有潛在負面與歧視意涵，因而 Oracle、GitHub 等大廠倡議以 Source-Replica 、Conductor-Member 或是 Primary-Secondary 等新名詞取代之；<br>但由於 IEC 相關文件制定時間較早，為讀者們參照方便，此文仍使用 Master-Slave 說明。(參考資料：<a href=\"https://dev.mysql.com/blog-archive/mysql-terminology-updates/\">MySQL Terminology Updates</a>)</h6><hr>\n<h2 id=\"4-通訊格式與資料結構解說\"><a href=\"#4-通訊格式與資料結構解說\" class=\"headerlink\" title=\"4. 通訊格式與資料結構解說\"></a>4. 通訊格式與資料結構解說</h2><p>IEC 104 的資料單元叫做 <strong>ASDU (Application Service Data Unit)</strong> ，是主要的資料封裝格式。</p>\n<p>每個 ASDU 包含：</p>\n<ul>\n<li><strong>類型 ID (Type ID)</strong> ：表示這是什麼資料 (例如遙測、遙信、遙控)</li>\n<li><strong>傳送原因 (COT)</strong> ：表示為什麼送這筆資料 (定時、變化、指令、測試等)</li>\n<li><strong>公共地址與資訊物件地址 (IOA)</strong> ：標示資料屬於哪個裝置、哪一筆點位</li>\n<li><strong>資料內容</strong>：實際傳輸的值 (如 ON&#x2F;OFF、電壓數值)</li>\n</ul>\n<p>IEC 104 使用三種 Frame 類型：</p>\n<ol>\n<li><strong>I-frame</strong>：攜帶實際資料</li>\n<li><strong>S-frame</strong>：確認對方資料已收到</li>\n<li><strong>U-frame</strong>：連線管理指令，如 StartDT、StopDT、TestFR</li>\n</ol>\n<p>這些報文 (message) 內含控制編號與確認編號，確保資料正確送達，並支援流量控制與錯誤偵測。</p>\n<hr>\n<h2 id=\"5-實際應用案例：如何與-SCADA-整合\"><a href=\"#5-實際應用案例：如何與-SCADA-整合\" class=\"headerlink\" title=\"5. 實際應用案例：如何與 SCADA 整合\"></a>5. 實際應用案例：如何與 SCADA 整合</h2><p>在現代 SCADA 系統中，IEC 104 是非常常見的通訊協定。<br>舉例來說：</p>\n<ul>\n<li><strong>西門子 (Siemens)</strong> 的 RTU 裝置與 WinCC SCADA 系統可以透過 IEC 104 傳送資料。</li>\n<li><strong>施耐德電機 (Schneider Electric)</strong> 的 ClearSCADA (Geo SCADA) 也支援 IEC 104。</li>\n<li><strong>艾波比 (ABB)</strong> 的 MicroSCADA 及 RTU560 裝置內建 IEC 104 通訊模組。</li>\n</ul>\n<p>這些裝置通常會與 IED (如：智慧電表、保護裝置) 回傳的遙測訊息串接，例如：</p>\n<ul>\n<li>電壓&#x2F;電流變化</li>\n<li>保護跳脫事件</li>\n<li>遙控指令執行成功與否</li>\n</ul>\n<p>SCADA 系統會設定對應的 Type ID、COT、IOA 等參數，來對應每一筆資料。<br>在一些場景下，若現場設備只支援 IEC 101 (串列通訊) ，可使用 <strong>協定轉換器</strong> 或 <strong>閘道器</strong> (如：研華生產的轉換器 <a href=\"https://www.advantech.com/zh-tw/products/ac0bd5cd-093a-4f88-87f5-13edc68a5616/esrp-pcs-icr3231/mod_803b3db4-bd02-472c-8ad3-624aaaab2433\">ESRP-PCS-ICR3231</a> 及閘道器 <a href=\"https://www.advantech.com/zh-tw/products/7332cf9e-bf70-4a79-b0b6-fd8a2182cd72/ecu-1051/mod_0ea5f440-e270-436f-afa3-077df3acce5d\">ECU-1051</a>) 將其轉成 IEC 104 接入乙太網架構，實現舊系統升級。</p>\n<hr>\n<h2 id=\"6-資安挑戰與-IEC-62351-的保護機制\"><a href=\"#6-資安挑戰與-IEC-62351-的保護機制\" class=\"headerlink\" title=\"6. 資安挑戰與 IEC 62351 的保護機制\"></a>6. 資安挑戰與 IEC 62351 的保護機制</h2><p>IEC 104 初始設計時並未考慮現代網路威脅，因此面臨以下問題：</p>\n<ul>\n<li>資料採用明文傳輸，容易有遭竊聽的風險</li>\n<li>缺乏身份驗證機制，攻擊者可偽裝成合法主站發送指令</li>\n<li>沒有加密與完整性驗證，易遭中間人攻擊</li>\n</ul>\n<p>為了解決這些問題，IEC 推出了 <a href=\"https://www.iec.ch/blog/cyber-security-understanding-iec-62351\"><strong>IEC 62351</strong> 系列標準</a>，加強電力通訊方面的資安保護：</p>\n<ul>\n<li><a href=\"https://webstore.iec.ch/en/publication/68410\"><strong>IEC 62351-3</strong></a>：建議在 TCP 上使用 TLS (類似 HTTPS) 來加密資料</li>\n<li><a href=\"https://webstore.iec.ch/en/publication/65511\"><strong>IEC 62351-5</strong></a>：對 IEC 104 應用層新增簽章與序號保護，避免重放攻擊 (replay attack) 與偽造</li>\n<li><a href=\"https://webstore.iec.ch/en/publication/61822\"><strong>IEC 62351-8</strong></a> ＆ <a href=\"https://webstore.iec.ch/en/publication/66864\">IEC 62351-9</a>**：定義了裝置驗證和金鑰管理辦法</li>\n</ul>\n<p>若設備不支援這些功能，則可改用 VPN 或閘道器進行加密傳輸或封包轉發。</p>\n<hr>\n<h2 id=\"7-實務建議：如何部署安全又穩定的系統\"><a href=\"#7-實務建議：如何部署安全又穩定的系統\" class=\"headerlink\" title=\"7. 實務建議：如何部署安全又穩定的系統\"></a>7. 實務建議：如何部署安全又穩定的系統</h2><p>即使已導入 IEC 62351，仍建議採用以下部署建議：</p>\n<ol>\n<li><strong>網路區隔</strong>：SCADA、RTU 等工控網路要與一般企業網路隔離。</li>\n<li><strong>防火牆控制埠存取</strong>：只允許授權的 IP 連接 Port 2404 。</li>\n<li><strong>入侵偵測系統 (IDS)</strong> ：即時監測異常 IEC 104 封包與指令行為。</li>\n<li><strong>安全閘道器</strong>：限制只能傳送特定 IOA&#x2F;Type ID 的資料與指令。</li>\n<li><strong>VPN 加密傳輸</strong>：遠端存取建議透過加密通道保護資料。</li>\n<li><strong>定期更新設備韌體</strong>：修補既有已知漏洞。</li>\n</ol>\n<p>上述策略屬於縱深防禦，能大幅降低攻擊成功的機率。</p>\n","excerpt":"","more":"<p><img src=\"/post/%E6%B7%BA%E8%AB%87-IEC-60870-5-104%EF%BC%9ASCADA-%E9%80%9A%E8%A8%8A%E5%8D%94%E5%AE%9A%E7%9A%84%E5%AF%A6%E5%8B%99%E8%88%87%E5%AE%89%E5%85%A8%E6%87%89%E7%94%A8/cover_img.jpeg\"></p>\n<center>Source: https://www.dreamstime.com/</center>\n\n<h2 id=\"1-專有名詞說明\"><a href=\"#1-專有名詞說明\" class=\"headerlink\" title=\"1. 專有名詞說明\"></a>1. 專有名詞說明</h2><ul>\n<li><p><strong>遙測 → Telemetry</strong><br>  <em>定義：</em> 是指從遠端設備或系統收集資料並傳回主系統或控制中心的技術。這些資料通常是感測器或監控裝置所收集的，例如溫度、壓力、位置等<br>  <em>舉例：</em> 太空探測器將自身的速度、溫度、位置等資料傳回地球，這些就是「遙測」數據</p>\n</li>\n<li><p><strong>遙信 → Tele-signaling &#x2F; Remote Signaling</strong><br>  <em>定義：</em> 指遠端設備或系統的狀態信號的傳送，主要是傳遞狀態或告警資訊（如開&#x2F;關、正常&#x2F;故障等），通常是離散型資料<br>  <em>舉例：</em> 發電廠的控制中心收到某個變電站「開關已關閉」的狀態信號，這就是一種遙信</p>\n</li>\n<li><p><strong>遙控 → Telecontrol &#x2F; Remote Control</strong><br>  <em>定義：</em> 指從遠端對設備進行控制或操作，例如遠端開關機、設定參數、啟動程式等<br>  <em>舉例：</em> 遠端控制工廠機械啟動運轉、開啟空調等，這些都屬於遙控</p>\n</li>\n<li><p><strong>DSP → Digital signal processor (數位訊號處理器)</strong><br>  <em>定義：</em> 是一種專用於數位訊號處理的微處理器，被廣泛應用於電信、音訊處理、數位圖像處理、雷達、聲納等領域，以及消費電子產品中</p>\n</li>\n<li><p><strong>RTU → Remote terminal unit (遠端遙控裝置)</strong><br>  <em>定義：</em> 微控制處理器，主要做為裝置介面的電子裝置，將資料引入 SCADA，通過傳輸遙測資料 (Remote sensing data) 到主系統，並且使用主監控系統的資料控制所連接的裝置</p>\n</li>\n<li><p><strong>IED → Intelligent Electronic Device (智慧電子設備)</strong><br>  <em>定義：</em> 具備資料處理能力與通訊功能的電子裝置，常應用於電力系統、工業控制系統（ICS）等場景中，用於監測、控制、保護與通訊。它不只是「感測器」或「繼電器」，而是具有 微處理器、邏輯判斷、遠端通訊能力的智慧設備。</p>\n</li>\n<li><p><strong>COT → Cause of Transmission (傳送原因)</strong><br>  <em>定義：</em> COT 是 IEC 60870-5 協定中 ASDU（應用服務資料單元）的一個重要欄位，用來說明這筆資料為什麼被傳送，也就是傳輸的「觸發原因」</p>\n</li>\n<li><p><strong>IOA → Information Object Address (資訊物件地址)</strong><br>  <em>定義：</em> 用來標示該筆資料所屬的設備內部地址，也就是某個遙測點的「點號」。通常每個 RTU 或 IED 裝置裡會配置一張遙測點號表，IOA 就是用來定位這些點</p>\n</li>\n<li><p><strong>Frame → 訊框</strong><br>  <em>定義：</em> 在工控通訊協定中，Frame 是一個用來封裝與傳輸資料的基本單位，就像是一個信封一樣，裡面包含了標頭 (header)、資料本體 (payload)、檢查碼 (CRC) 等資訊；其中標頭 (header) 主要由起始符 (Start of Frame, SOF) 、位址&#x2F;識別位、功能碼 (表示讀、寫等指令) 組成</p>\n</li>\n<li><p><strong>SCADA → Supervisory Control And Data Acquisition (監控與資料採集系統)</strong><br>  <em>定義：</em> 是一種用於遠端監控與控制大型工業系統的架構，它允許操作人員從中控室監控現場設備的運作狀態，並能發送控制命令。SCADA 可收集、儲存、分析和顯示來自現場感測器和控制設備的資料</p>\n</li>\n</ul>\n<hr>\n<h2 id=\"2-何謂-IEC-60870-5-協定\"><a href=\"#2-何謂-IEC-60870-5-協定\" class=\"headerlink\" title=\"2. 何謂 IEC 60870-5 協定\"></a>2. 何謂 IEC 60870-5 協定</h2><p>IEC 60870 是一套是由 <a href=\"https://www.iec.ch/homepage\">國際電工委員會 (IEC)</a> 制定的國際通訊標準，旨在為在工業控制中心 (SCADA) 及遠端裝置 (如: RTU&#x2F;IED) 間進行可靠的資料傳輸。現今廣泛應用在電力系統、智慧電網的監控&#x2F;控制與工業自動化系統中。<br>IEC 60870-5 則是整個家族中的第五部份，旗下包含多達 13 個子標準，主要針對電力系統的遠端控制、遠端保護和相關通信制定了協議標準。</p>\n<p>其中最常見的兩個子標準是：</p>\n<ul>\n<li><strong>IEC 60870-5-101 (下稱 IEC 101)</strong>：使用傳統串列 (RS-232&#x2F;RS-485) 方式，適合本地端點對點傳輸應用。</li>\n<li><strong>IEC 60870-5-104 (下稱 IEC 104)</strong>：是針對現代網路環境 (如: TCP&#x2F;IP) 設計的版本，針對遠端通訊的傳輸層與應用層設計，可在乙太網、VPN 等廣域網路上進行資料傳輸。</li>\n</ul>\n<p>簡單來說，IEC 104 就是把 IEC 101 的資料格式「搬到網路上」，讓它能走在 IP 網路上，而且支援雙向持續連線，讓資料可以即時交換，不用像老系統只能等 SCADA 輪詢。</p>\n<hr>\n<h2 id=\"3-IEC-104-與-OSI-七層模型的對應\"><a href=\"#3-IEC-104-與-OSI-七層模型的對應\" class=\"headerlink\" title=\"3. IEC 104 與 OSI 七層模型的對應\"></a>3. IEC 104 與 OSI 七層模型的對應</h2><p>IEC 104 在網路通訊模型中，是應用層協定，透過 TCP 傳輸，預設使用 <strong>Port 2404</strong>。</p>\n<p>以下是它在 傳統網路 OSI 七層模型中的對應：</p>\n<ul>\n<li>應用層：IEC 104</li>\n<li>傳輸層：TCP</li>\n<li>網路層：IP</li>\n<li>資料鏈結層&#x2F;實體層：Ethernet</li>\n</ul>\n<p>在 SCADA 系統中採用的是 Master-Slave 模式 (<em>註1</em>)，主站 (控制中心) 通常是 <strong>Client (用戶端)</strong> ，現場的 RTU、IED 是 <strong>Server (伺服端)</strong> ，兩者透過 TCP 建立持久性連線 (Persistent Connection) ，並進行資料交換與控制指令下達。<br>當主站連線成功後，會送出 <strong>StartDT</strong> 指令開始資料傳送；若無動作太久，也會用 <strong>TestFR</strong> 做連線測試。</p>\n<h6 id=\"註1：自2020年起，美國科技界認為-Master-Slave-這樣的字眼可能反應了早期蓄奴制度而帶有潛在負面與歧視意涵，因而-Oracle、GitHub-等大廠倡議以-Source-Replica-、Conductor-Member-或是-Primary-Secondary-等新名詞取代之；但由於-IEC-相關文件制定時間較早，為讀者們參照方便，此文仍使用-Master-Slave-說明。-參考資料：MySQL-Terminology-Updates\"><a href=\"#註1：自2020年起，美國科技界認為-Master-Slave-這樣的字眼可能反應了早期蓄奴制度而帶有潛在負面與歧視意涵，因而-Oracle、GitHub-等大廠倡議以-Source-Replica-、Conductor-Member-或是-Primary-Secondary-等新名詞取代之；但由於-IEC-相關文件制定時間較早，為讀者們參照方便，此文仍使用-Master-Slave-說明。-參考資料：MySQL-Terminology-Updates\" class=\"headerlink\" title=\"*註1：自2020年起，美國科技界認為 Master-Slave 這樣的字眼可能反應了早期蓄奴制度而帶有潛在負面與歧視意涵，因而 Oracle、GitHub 等大廠倡議以 Source-Replica 、Conductor-Member 或是 Primary-Secondary 等新名詞取代之；但由於 IEC 相關文件制定時間較早，為讀者們參照方便，此文仍使用 Master-Slave 說明。(參考資料：MySQL Terminology Updates)\"></a>*註1：自2020年起，美國科技界認為 Master-Slave 這樣的字眼可能反應了早期蓄奴制度而帶有潛在負面與歧視意涵，因而 Oracle、GitHub 等大廠倡議以 Source-Replica 、Conductor-Member 或是 Primary-Secondary 等新名詞取代之；<br>但由於 IEC 相關文件制定時間較早，為讀者們參照方便，此文仍使用 Master-Slave 說明。(參考資料：<a href=\"https://dev.mysql.com/blog-archive/mysql-terminology-updates/\">MySQL Terminology Updates</a>)</h6><hr>\n<h2 id=\"4-通訊格式與資料結構解說\"><a href=\"#4-通訊格式與資料結構解說\" class=\"headerlink\" title=\"4. 通訊格式與資料結構解說\"></a>4. 通訊格式與資料結構解說</h2><p>IEC 104 的資料單元叫做 <strong>ASDU (Application Service Data Unit)</strong> ，是主要的資料封裝格式。</p>\n<p>每個 ASDU 包含：</p>\n<ul>\n<li><strong>類型 ID (Type ID)</strong> ：表示這是什麼資料 (例如遙測、遙信、遙控)</li>\n<li><strong>傳送原因 (COT)</strong> ：表示為什麼送這筆資料 (定時、變化、指令、測試等)</li>\n<li><strong>公共地址與資訊物件地址 (IOA)</strong> ：標示資料屬於哪個裝置、哪一筆點位</li>\n<li><strong>資料內容</strong>：實際傳輸的值 (如 ON&#x2F;OFF、電壓數值)</li>\n</ul>\n<p>IEC 104 使用三種 Frame 類型：</p>\n<ol>\n<li><strong>I-frame</strong>：攜帶實際資料</li>\n<li><strong>S-frame</strong>：確認對方資料已收到</li>\n<li><strong>U-frame</strong>：連線管理指令，如 StartDT、StopDT、TestFR</li>\n</ol>\n<p>這些報文 (message) 內含控制編號與確認編號，確保資料正確送達，並支援流量控制與錯誤偵測。</p>\n<hr>\n<h2 id=\"5-實際應用案例：如何與-SCADA-整合\"><a href=\"#5-實際應用案例：如何與-SCADA-整合\" class=\"headerlink\" title=\"5. 實際應用案例：如何與 SCADA 整合\"></a>5. 實際應用案例：如何與 SCADA 整合</h2><p>在現代 SCADA 系統中，IEC 104 是非常常見的通訊協定。<br>舉例來說：</p>\n<ul>\n<li><strong>西門子 (Siemens)</strong> 的 RTU 裝置與 WinCC SCADA 系統可以透過 IEC 104 傳送資料。</li>\n<li><strong>施耐德電機 (Schneider Electric)</strong> 的 ClearSCADA (Geo SCADA) 也支援 IEC 104。</li>\n<li><strong>艾波比 (ABB)</strong> 的 MicroSCADA 及 RTU560 裝置內建 IEC 104 通訊模組。</li>\n</ul>\n<p>這些裝置通常會與 IED (如：智慧電表、保護裝置) 回傳的遙測訊息串接，例如：</p>\n<ul>\n<li>電壓&#x2F;電流變化</li>\n<li>保護跳脫事件</li>\n<li>遙控指令執行成功與否</li>\n</ul>\n<p>SCADA 系統會設定對應的 Type ID、COT、IOA 等參數，來對應每一筆資料。<br>在一些場景下，若現場設備只支援 IEC 101 (串列通訊) ，可使用 <strong>協定轉換器</strong> 或 <strong>閘道器</strong> (如：研華生產的轉換器 <a href=\"https://www.advantech.com/zh-tw/products/ac0bd5cd-093a-4f88-87f5-13edc68a5616/esrp-pcs-icr3231/mod_803b3db4-bd02-472c-8ad3-624aaaab2433\">ESRP-PCS-ICR3231</a> 及閘道器 <a href=\"https://www.advantech.com/zh-tw/products/7332cf9e-bf70-4a79-b0b6-fd8a2182cd72/ecu-1051/mod_0ea5f440-e270-436f-afa3-077df3acce5d\">ECU-1051</a>) 將其轉成 IEC 104 接入乙太網架構，實現舊系統升級。</p>\n<hr>\n<h2 id=\"6-資安挑戰與-IEC-62351-的保護機制\"><a href=\"#6-資安挑戰與-IEC-62351-的保護機制\" class=\"headerlink\" title=\"6. 資安挑戰與 IEC 62351 的保護機制\"></a>6. 資安挑戰與 IEC 62351 的保護機制</h2><p>IEC 104 初始設計時並未考慮現代網路威脅，因此面臨以下問題：</p>\n<ul>\n<li>資料採用明文傳輸，容易有遭竊聽的風險</li>\n<li>缺乏身份驗證機制，攻擊者可偽裝成合法主站發送指令</li>\n<li>沒有加密與完整性驗證，易遭中間人攻擊</li>\n</ul>\n<p>為了解決這些問題，IEC 推出了 <a href=\"https://www.iec.ch/blog/cyber-security-understanding-iec-62351\"><strong>IEC 62351</strong> 系列標準</a>，加強電力通訊方面的資安保護：</p>\n<ul>\n<li><a href=\"https://webstore.iec.ch/en/publication/68410\"><strong>IEC 62351-3</strong></a>：建議在 TCP 上使用 TLS (類似 HTTPS) 來加密資料</li>\n<li><a href=\"https://webstore.iec.ch/en/publication/65511\"><strong>IEC 62351-5</strong></a>：對 IEC 104 應用層新增簽章與序號保護，避免重放攻擊 (replay attack) 與偽造</li>\n<li><a href=\"https://webstore.iec.ch/en/publication/61822\"><strong>IEC 62351-8</strong></a> ＆ <a href=\"https://webstore.iec.ch/en/publication/66864\">IEC 62351-9</a>**：定義了裝置驗證和金鑰管理辦法</li>\n</ul>\n<p>若設備不支援這些功能，則可改用 VPN 或閘道器進行加密傳輸或封包轉發。</p>\n<hr>\n<h2 id=\"7-實務建議：如何部署安全又穩定的系統\"><a href=\"#7-實務建議：如何部署安全又穩定的系統\" class=\"headerlink\" title=\"7. 實務建議：如何部署安全又穩定的系統\"></a>7. 實務建議：如何部署安全又穩定的系統</h2><p>即使已導入 IEC 62351，仍建議採用以下部署建議：</p>\n<ol>\n<li><strong>網路區隔</strong>：SCADA、RTU 等工控網路要與一般企業網路隔離。</li>\n<li><strong>防火牆控制埠存取</strong>：只允許授權的 IP 連接 Port 2404 。</li>\n<li><strong>入侵偵測系統 (IDS)</strong> ：即時監測異常 IEC 104 封包與指令行為。</li>\n<li><strong>安全閘道器</strong>：限制只能傳送特定 IOA&#x2F;Type ID 的資料與指令。</li>\n<li><strong>VPN 加密傳輸</strong>：遠端存取建議透過加密通道保護資料。</li>\n<li><strong>定期更新設備韌體</strong>：修補既有已知漏洞。</li>\n</ol>\n<p>上述策略屬於縱深防禦，能大幅降低攻擊成功的機率。</p>\n"}],"PostAsset":[{"_id":"source/_posts/Secure-by-Demand-Driving-OT-Security-Transformation-Through-Strategic-Procurement/cover_img.jpeg","post":"cm9agcuc30003nc829si42dva","slug":"cover_img.jpeg","modified":1,"renderable":0},{"_id":"source/_posts/An-Overview-of-IEC-60870-5-104-Practical-and-Security-Applications-of-the-SCADA-Communication-Protocol/cover_img.jpeg","post":"cm9agcuc20001nc82hzfnalab","slug":"cover_img.jpeg","modified":1,"renderable":0},{"_id":"source/_posts/Secure-by-Demand：以採購驅動-OT-系統安全轉型/cover_img.jpeg","post":"cm9agcuc40007nc827xhxapf3","slug":"cover_img.jpeg","modified":1,"renderable":0},{"_id":"source/_posts/The-Hidden-Power-of-Shim-How-Windows-and-Linux-Use-It—and-Why-You-Should-Care/Three-stage-Trust-Chain.jpeg","post":"cm9agcuc70010nc82e2bvcpym","slug":"Three-stage-Trust-Chain.jpeg","modified":1,"renderable":0},{"_id":"source/_posts/The-Hidden-Power-of-Shim-How-Windows-and-Linux-Use-It—and-Why-You-Should-Care/en_cover_img.png","post":"cm9agcuc70010nc82e2bvcpym","slug":"en_cover_img.png","modified":1,"renderable":0},{"_id":"source/_posts/深入解析-Shim：Windows-相容性修正與-Linux-Secure-Boot-信任鏈核心/Three-stage-Trust-Chain.jpeg","post":"cm9agcuc70011nc827cqh4zhi","slug":"Three-stage-Trust-Chain.jpeg","modified":1,"renderable":0},{"_id":"source/_posts/深入解析-Shim：Windows-相容性修正與-Linux-Secure-Boot-信任鏈核心/zhtw_cover_img.png","post":"cm9agcuc70011nc827cqh4zhi","slug":"zhtw_cover_img.png","modified":1,"renderable":0},{"_id":"source/_posts/淺談-IEC-60870-5-104：SCADA-通訊協定的實務與安全應用/cover_img.jpeg","post":"cm9agcuc80013nc82bxobgziu","slug":"cover_img.jpeg","modified":1,"renderable":0}],"PostCategory":[{"post_id":"cm9agcuc20001nc82hzfnalab","category_id":"cm9agcuc40004nc8251851o6y","_id":"cm9agcuc6000dnc8251l21nsx"},{"post_id":"cm9agcuc30003nc829si42dva","category_id":"cm9agcuc40004nc8251851o6y","_id":"cm9agcuc6000fnc822689eva5"},{"post_id":"cm9agcuc40007nc827xhxapf3","category_id":"cm9agcuc40004nc8251851o6y","_id":"cm9agcuc6000inc82bi7gd1hm"},{"post_id":"cm9agcuc70010nc82e2bvcpym","category_id":"cm9agcuc40004nc8251851o6y","_id":"cm9agcuc80014nc820vfiedio"},{"post_id":"cm9agcuc70011nc827cqh4zhi","category_id":"cm9agcuc40004nc8251851o6y","_id":"cm9agcuc80015nc824ztb51g6"},{"post_id":"cm9agcuc80013nc82bxobgziu","category_id":"cm9agcuc40004nc8251851o6y","_id":"cm9agcuc80017nc822f2y3vvy"}],"PostTag":[{"post_id":"cm9agcuc20001nc82hzfnalab","tag_id":"cm9agcuc40005nc82ai1xbtlc","_id":"cm9agcuc6000hnc8289651pfi"},{"post_id":"cm9agcuc20001nc82hzfnalab","tag_id":"cm9agcuc6000bnc8252ou6ozf","_id":"cm9agcuc6000jnc828515ghvi"},{"post_id":"cm9agcuc20001nc82hzfnalab","tag_id":"cm9agcuc6000enc82fdtj3bc5","_id":"cm9agcuc6000lnc82du5m5tiz"},{"post_id":"cm9agcuc30003nc829si42dva","tag_id":"cm9agcuc40005nc82ai1xbtlc","_id":"cm9agcuc7000pnc82dmlh2kec"},{"post_id":"cm9agcuc30003nc829si42dva","tag_id":"cm9agcuc6000knc82b8mu6a6s","_id":"cm9agcuc7000qnc820b77501v"},{"post_id":"cm9agcuc30003nc829si42dva","tag_id":"cm9agcuc6000mnc822c9g30pf","_id":"cm9agcuc7000snc82eb6kay3h"},{"post_id":"cm9agcuc30003nc829si42dva","tag_id":"cm9agcuc6000nnc82bc8kdpzi","_id":"cm9agcuc7000tnc826x5r2ohd"},{"post_id":"cm9agcuc40007nc827xhxapf3","tag_id":"cm9agcuc6000onc82dli1b5om","_id":"cm9agcuc7000wnc82faav0x4p"},{"post_id":"cm9agcuc40007nc827xhxapf3","tag_id":"cm9agcuc7000rnc82bgeuf9tn","_id":"cm9agcuc7000xnc822ona6b7x"},{"post_id":"cm9agcuc40007nc827xhxapf3","tag_id":"cm9agcuc7000unc820cp8dd72","_id":"cm9agcuc7000ync820tmqbk6q"},{"post_id":"cm9agcuc40007nc827xhxapf3","tag_id":"cm9agcuc7000vnc82fov53ssy","_id":"cm9agcuc7000znc820lpch5wz"},{"post_id":"cm9agcuc70010nc82e2bvcpym","tag_id":"cm9agcuc40005nc82ai1xbtlc","_id":"cm9agcuc80019nc820xmh5sfv"},{"post_id":"cm9agcuc70010nc82e2bvcpym","tag_id":"cm9agcuc80012nc826tevaw05","_id":"cm9agcuc8001anc82bw3o04bf"},{"post_id":"cm9agcuc70010nc82e2bvcpym","tag_id":"cm9agcuc80016nc82cmgu9no5","_id":"cm9agcuc8001cnc823i7a0uj5"},{"post_id":"cm9agcuc70010nc82e2bvcpym","tag_id":"cm9agcuc6000enc82fdtj3bc5","_id":"cm9agcuc8001dnc823bu6cnhs"},{"post_id":"cm9agcuc70011nc827cqh4zhi","tag_id":"cm9agcuc6000onc82dli1b5om","_id":"cm9agcuc8001gnc82402qaxuj"},{"post_id":"cm9agcuc70011nc827cqh4zhi","tag_id":"cm9agcuc80012nc826tevaw05","_id":"cm9agcuc8001hnc82ciysbjb2"},{"post_id":"cm9agcuc70011nc827cqh4zhi","tag_id":"cm9agcuc80016nc82cmgu9no5","_id":"cm9agcuc8001jnc822rq048cy"},{"post_id":"cm9agcuc70011nc827cqh4zhi","tag_id":"cm9agcuc8001enc82ftnofd56","_id":"cm9agcuc8001knc822mcv2aou"},{"post_id":"cm9agcuc80013nc82bxobgziu","tag_id":"cm9agcuc6000onc82dli1b5om","_id":"cm9agcuc8001lnc822uas2p87"},{"post_id":"cm9agcuc80013nc82bxobgziu","tag_id":"cm9agcuc8001fnc82a066deud","_id":"cm9agcuc8001mnc823gpp0ak4"},{"post_id":"cm9agcuc80013nc82bxobgziu","tag_id":"cm9agcuc8001enc82ftnofd56","_id":"cm9agcuc8001nnc82fcx4cdq2"}],"Tag":[{"name":"English","_id":"cm9agcuc40005nc82ai1xbtlc"},{"name":"Industrial Control System","_id":"cm9agcuc6000bnc8252ou6ozf"},{"name":"Cyber security","_id":"cm9agcuc6000enc82fdtj3bc5"},{"name":"Operational technology","_id":"cm9agcuc6000knc82b8mu6a6s"},{"name":"Critical Infrastructure Security and Resilience","_id":"cm9agcuc6000mnc822c9g30pf"},{"name":"Cybersecurity Best Practices","_id":"cm9agcuc6000nnc82bc8kdpzi"},{"name":"Traditional Chinese","_id":"cm9agcuc6000onc82dli1b5om"},{"name":"運營技術","_id":"cm9agcuc7000rnc82bgeuf9tn"},{"name":"關鍵基礎設施安全與韌性","_id":"cm9agcuc7000unc820cp8dd72"},{"name":"網路安全最佳實踐","_id":"cm9agcuc7000vnc82fov53ssy"},{"name":"Windows","_id":"cm9agcuc80012nc826tevaw05"},{"name":"Linux","_id":"cm9agcuc80016nc82cmgu9no5"},{"name":"資訊安全","_id":"cm9agcuc8001enc82ftnofd56"},{"name":"工業控制系統","_id":"cm9agcuc8001fnc82a066deud"}]}}